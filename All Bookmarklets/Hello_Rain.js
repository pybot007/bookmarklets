javascript:var geometry,material,mesh,meshContainer,container,stats,camera,scene,renderer,THREE=THREE||{};window.Int32Array||(window.Int32Array=Array,window.Float32Array=Array),THREE.Color=function(e){return void 0!==e&&this.setHex(e),this},THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},setRGB:function(e,t,n){return this.r=e,this.g=t,this.b=n,this},setHSV:function(e,t,n){var o,h,c;if(0==n)this.r=this.g=this.b=0;else switch(o=Math.floor(6*e),h=6*e-o,e=n*(1-t),c=n*(1-t*h),t=n*(1-t*(1-h)),o){case 1:this.r=c,this.g=n,this.b=e;break;case 2:this.r=e,this.g=n,this.b=t;break;case 3:this.r=e,this.g=c,this.b=n;break;case 4:this.r=t,this.g=e,this.b=n;break;case 5:this.r=n,this.g=e,this.b=c;break;case 6:case 0:this.r=n,this.g=t,this.b=e}return this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},getHex:function(){return~~(255*this.r)<<16^~~(255*this.g)<<8^~~(255*this.b)},getContextStyle:function(){return"rgb("+Math.floor(255*this.r)+","+Math.floor(255*this.g)+","+Math.floor(255*this.b)+")"},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}},THREE.Vector2=function(e,t){this.set(e||0,t||0)},THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(e,t){return this.x=e,this.y=t,this},copy:function(e){return this.x=e.x,this.y=e.y,this},clone:function(){return new THREE.Vector2(this.x,this.y)},add:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addSelf:function(e){return this.x+=e.x,this.y+=e.y,this},sub:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},subSelf:function(e){return this.x-=e.x,this.y-=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divideScalar:function(e){return e?(this.x/=e,this.y/=e):this.set(0,0),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,e=this.y-e.y;return t*t+e*e},setLength:function(e){return this.normalize().multiplyScalar(e)},unit:function(){return this.normalize()},equals:function(e){return e.x==this.x&&e.y==this.y}},THREE.Vector3=function(e,t,n){this.set(e||0,t||0,n||0)},THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)},add:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addSelf:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},sub:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},subSelf:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},multiply:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},multiplySelf:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},divideSelf:function(e){return this.divide(this,e)},divideScalar:function(e){return e?(this.x/=e,this.y/=e,this.z/=e):this.set(0,0,0),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSq())},lengthManhattan:function(){return this.x+this.y+this.z},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.normalize().multiplyScalar(e)},cross:function(e,t){return this.x=e.y*t.z-e.z*t.y,this.y=e.z*t.x-e.x*t.z,this.z=e.x*t.y-e.y*t.x,this},crossSelf:function(e){return this.set(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){return(new THREE.Vector3).sub(this,e).lengthSq()},setPositionFromMatrix:function(e){this.x=e.n14,this.y=e.n24,this.z=e.n34},setRotationFromMatrix:function(e){var t=Math.cos(this.y);this.y=Math.asin(e.n13),Math.abs(t)>1e-5?(this.x=Math.atan2(-e.n23/t,e.n33/t),this.z=Math.atan2(-e.n12/t,e.n11/t)):(this.x=0,this.z=Math.atan2(e.n21,e.n22))},isZero:function(){return 1e-4>this.lengthSq()}},THREE.Vector4=function(e,t,n,o){this.set(e||0,t||0,n||0,o||1)},THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(e,t,n,o){return this.x=e,this.y=t,this.z=n,this.w=o,this},copy:function(e){return this.set(e.x,e.y,e.z,e.w||1)},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)},add:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addSelf:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},sub:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},subSelf:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},divideScalar:function(e){return e?(this.x/=e,this.y/=e,this.z/=e,this.w/=e):this.set(0,0,0,1),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.dot(this)},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.normalize().multiplyScalar(e)},lerpSelf:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}},THREE.Ray=function(e,t){this.origin=e||new THREE.Vector3,this.direction=t||new THREE.Vector3},THREE.Ray.prototype={constructor:THREE.Ray,intersectScene:function(e){return this.intersectObjects(e.objects)},intersectObjects:function(e){var t,n,o=[];for(t=0,n=e.length;t<n;t++)o=o.concat(this.intersectObject(e[t]));return o.sort(function(e,t){return e.distance-t.distance}),o},intersectObject:function(e){function t(e,t,n){var o,n=n.matrixWorld.getPosition();return o=n.clone().subSelf(e).dot(t),e=e.clone().addSelf(t.clone().multiplyScalar(o)),n.distanceTo(e)}function n(e,t,n,o){var o=o.clone().subSelf(t),n=n.clone().subSelf(t),h=e.clone().subSelf(t),e=o.dot(o),t=o.dot(n),o=o.dot(h),c=n.dot(n),n=n.dot(h),h=1/(e*c-t*t),c=(c*o-t*n)*h,e=(e*n-t*o)*h;return c>0&&e>0&&c+e<1}if(e instanceof THREE.Particle){var o=t(this.origin,this.direction,e);return!o||o>e.scale.x?[]:[{distance:o,point:e.position,face:null,object:e}]}if(!(e instanceof THREE.Mesh)||!(o=t(this.origin,this.direction,e))||o>e.geometry.boundingSphere.radius*Math.max(e.scale.x,Math.max(e.scale.y,e.scale.z)))return[];var h,c,_,E,f,p,u,m,$,g,v=e.geometry,T=v.vertices,y=[],o=0;for(h=v.faces.length;o<h;o++)c=v.faces[o],$=this.origin.clone(),g=this.direction.clone(),_=(p=e.matrixWorld).multiplyVector3(T[c.a].position.clone()),E=p.multiplyVector3(T[c.b].position.clone()),f=p.multiplyVector3(T[c.c].position.clone()),p=c instanceof THREE.Face4?p.multiplyVector3(T[c.d].position.clone()):null,u=e.matrixRotationWorld.multiplyVector3(c.normal.clone()),m=g.dot(u),(e.doubleSided||(e.flipSided?m>0:m<0))&&((u=u.dot((new THREE.Vector3).sub(_,$))/m,$=$.addSelf(g.multiplyScalar(u)),c instanceof THREE.Face3)?n($,_,E,f)&&y.push(c={distance:this.origin.distanceTo($),point:$,face:c,object:e}):c instanceof THREE.Face4&&(n($,_,E,p)||n($,E,f,p))&&y.push(c={distance:this.origin.distanceTo($),point:$,face:c,object:e}));return y}},THREE.Rectangle=function(){function e(){c=o-t,_=h-n}var t,n,o,h,c,_,E=!0;this.getX=function(){return t},this.getY=function(){return n},this.getWidth=function(){return c},this.getHeight=function(){return _},this.getLeft=function(){return t},this.getTop=function(){return n},this.getRight=function(){return o},this.getBottom=function(){return h},this.set=function(c,_,f,p){E=!1,t=c,n=_,o=f,h=p,e()},this.addPoint=function(c,_){E?(E=!1,t=c,n=_,o=c,h=_):(t=t<c?t:c,n=n<_?n:_,o=o>c?o:c,h=h>_?h:_),e()},this.add3Points=function(c,_,f,p,u,m){E?(E=!1,t=c<f?c<u?c:u:f<u?f:u,n=_<p?_<m?_:m:p<m?p:m,o=c>f?c>u?c:u:f>u?f:u,h=_>p?_>m?_:m:p>m?p:m):(t=c<f?c<u?c<t?c:t:u<t?u:t:f<u?f<t?f:t:u<t?u:t,n=_<p?_<m?_<n?_:n:m<n?m:n:p<m?p<n?p:n:m<n?m:n,o=c>f?c>u?c>o?c:o:u>o?u:o:f>u?f>o?f:o:u>o?u:o,h=_>p?_>m?_>h?_:h:m>h?m:h:p>m?p>h?p:h:m>h?m:h),e()},this.addRectangle=function(c){E?(E=!1,t=c.getLeft(),n=c.getTop(),o=c.getRight(),h=c.getBottom()):(t=t<c.getLeft()?t:c.getLeft(),n=n<c.getTop()?n:c.getTop(),o=o>c.getRight()?o:c.getRight(),h=h>c.getBottom()?h:c.getBottom()),e()},this.inflate=function(c){t-=c,n-=c,o+=c,h+=c,e()},this.minSelf=function(c){t=t>c.getLeft()?t:c.getLeft(),n=n>c.getTop()?n:c.getTop(),o=o<c.getRight()?o:c.getRight(),h=h<c.getBottom()?h:c.getBottom(),e()},this.instersects=function(e){return Math.min(o,e.getRight())-Math.max(t,e.getLeft())>=0&&Math.min(h,e.getBottom())-Math.max(n,e.getTop())>=0},this.empty=function(){E=!0,h=o=n=t=0,e()},this.isEmpty=function(){return E}},THREE.Matrix3=function(){this.m=[]},THREE.Matrix3.prototype={constructor:THREE.Matrix3,transpose:function(){var e,t=this.m;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},transposeIntoArray:function(e){var t=this.m;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}},THREE.Matrix4=function(e,t,n,o,h,c,_,E,f,p,u,m,$,g,v,T){this.set(e||1,t||0,n||0,o||0,h||0,c||1,_||0,E||0,f||0,p||0,u||1,m||0,$||0,g||0,v||0,T||1),this.flat=Array(16),this.m33=new THREE.Matrix3},THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(e,t,n,o,h,c,_,E,f,p,u,m,$,g,v,T){return this.n11=e,this.n12=t,this.n13=n,this.n14=o,this.n21=h,this.n22=c,this.n23=_,this.n24=E,this.n31=f,this.n32=p,this.n33=u,this.n34=m,this.n41=$,this.n42=g,this.n43=v,this.n44=T,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return this.set(e.n11,e.n12,e.n13,e.n14,e.n21,e.n22,e.n23,e.n24,e.n31,e.n32,e.n33,e.n34,e.n41,e.n42,e.n43,e.n44),this},lookAt:function(e,t,n){var o=THREE.Matrix4.__v1,h=THREE.Matrix4.__v2,c=THREE.Matrix4.__v3;return c.sub(e,t).normalize(),0===c.length()&&(c.z=1),o.cross(n,c).normalize(),0===o.length()&&(c.x+=1e-4,o.cross(n,c).normalize()),h.cross(c,o).normalize(),this.n11=o.x,this.n12=h.x,this.n13=c.x,this.n21=o.y,this.n22=h.y,this.n23=c.y,this.n31=o.z,this.n32=h.z,this.n33=c.z,this},multiplyVector3:function(e){var t=e.x,n=e.y,o=e.z,h=1/(this.n41*t+this.n42*n+this.n43*o+this.n44);return e.x=(this.n11*t+this.n12*n+this.n13*o+this.n14)*h,e.y=(this.n21*t+this.n22*n+this.n23*o+this.n24)*h,e.z=(this.n31*t+this.n32*n+this.n33*o+this.n34)*h,e},multiplyVector4:function(e){var t=e.x,n=e.y,o=e.z,h=e.w;return e.x=this.n11*t+this.n12*n+this.n13*o+this.n14*h,e.y=this.n21*t+this.n22*n+this.n23*o+this.n24*h,e.z=this.n31*t+this.n32*n+this.n33*o+this.n34*h,e.w=this.n41*t+this.n42*n+this.n43*o+this.n44*h,e},rotateAxis:function(e){var t=e.x,n=e.y,o=e.z;return e.x=t*this.n11+n*this.n12+o*this.n13,e.y=t*this.n21+n*this.n22+o*this.n23,e.z=t*this.n31+n*this.n32+o*this.n33,e.normalize(),e},crossVector:function(e){var t=new THREE.Vector4;return t.x=this.n11*e.x+this.n12*e.y+this.n13*e.z+this.n14*e.w,t.y=this.n21*e.x+this.n22*e.y+this.n23*e.z+this.n24*e.w,t.z=this.n31*e.x+this.n32*e.y+this.n33*e.z+this.n34*e.w,t.w=e.w?this.n41*e.x+this.n42*e.y+this.n43*e.z+this.n44*e.w:1,t},multiply:function(e,t){var n=e.n11,o=e.n12,h=e.n13,c=e.n14,_=e.n21,E=e.n22,f=e.n23,p=e.n24,u=e.n31,m=e.n32,$=e.n33,g=e.n34,v=e.n41,T=e.n42,y=e.n43,R=e.n44,x=t.n11,H=t.n12,b=t.n13,w=t.n14,S=t.n21,C=t.n22,M=t.n23,A=t.n24,L=t.n31,P=t.n32,V=t.n33,z=t.n34,F=t.n41,U=t.n42,k=t.n43,B=t.n44;return this.n11=n*x+o*S+h*L+c*F,this.n12=n*H+o*C+h*P+c*U,this.n13=n*b+o*M+h*V+c*k,this.n14=n*w+o*A+h*z+c*B,this.n21=_*x+E*S+f*L+p*F,this.n22=_*H+E*C+f*P+p*U,this.n23=_*b+E*M+f*V+p*k,this.n24=_*w+E*A+f*z+p*B,this.n31=u*x+m*S+$*L+g*F,this.n32=u*H+m*C+$*P+g*U,this.n33=u*b+m*M+$*V+g*k,this.n34=u*w+m*A+$*z+g*B,this.n41=v*x+T*S+y*L+R*F,this.n42=v*H+T*C+y*P+R*U,this.n43=v*b+T*M+y*V+R*k,this.n44=v*w+T*A+y*z+R*B,this},multiplyToArray:function(e,t,n){return this.multiply(e,t),n[0]=this.n11,n[1]=this.n21,n[2]=this.n31,n[3]=this.n41,n[4]=this.n12,n[5]=this.n22,n[6]=this.n32,n[7]=this.n42,n[8]=this.n13,n[9]=this.n23,n[10]=this.n33,n[11]=this.n43,n[12]=this.n14,n[13]=this.n24,n[14]=this.n34,n[15]=this.n44,this},multiplySelf:function(e){return this.multiply(this,e),this},multiplyScalar:function(e){return this.n11*=e,this.n12*=e,this.n13*=e,this.n14*=e,this.n21*=e,this.n22*=e,this.n23*=e,this.n24*=e,this.n31*=e,this.n32*=e,this.n33*=e,this.n34*=e,this.n41*=e,this.n42*=e,this.n43*=e,this.n44*=e,this},determinant:function(){var e=this.n11,t=this.n12,n=this.n13,o=this.n14,h=this.n21,c=this.n22,_=this.n23,E=this.n24,f=this.n31,p=this.n32,u=this.n33,m=this.n34,$=this.n41,g=this.n42,v=this.n43,T=this.n44;return o*_*p*$-n*E*p*$-o*c*u*$+t*E*u*$+n*c*m*$-t*_*m*$-o*_*f*g+n*E*f*g+o*h*u*g-e*E*u*g-n*h*m*g+e*_*m*g+o*c*f*v-t*E*f*v-o*h*p*v+e*E*p*v+t*h*m*v-e*c*m*v-n*c*f*T+t*_*f*T+n*h*p*T-e*_*p*T-t*h*u*T+e*c*u*T},transpose:function(){var e;return e=this.n21,this.n21=this.n12,this.n12=e,e=this.n31,this.n31=this.n13,this.n13=e,e=this.n32,this.n32=this.n23,this.n23=e,e=this.n41,this.n41=this.n14,this.n14=e,e=this.n42,this.n42=this.n24,this.n24=e,e=this.n43,this.n43=this.n34,this.n43=e,this},clone:function(){var e=new THREE.Matrix4;return e.n11=this.n11,e.n12=this.n12,e.n13=this.n13,e.n14=this.n14,e.n21=this.n21,e.n22=this.n22,e.n23=this.n23,e.n24=this.n24,e.n31=this.n31,e.n32=this.n32,e.n33=this.n33,e.n34=this.n34,e.n41=this.n41,e.n42=this.n42,e.n43=this.n43,e.n44=this.n44,e},flatten:function(){return this.flat[0]=this.n11,this.flat[1]=this.n21,this.flat[2]=this.n31,this.flat[3]=this.n41,this.flat[4]=this.n12,this.flat[5]=this.n22,this.flat[6]=this.n32,this.flat[7]=this.n42,this.flat[8]=this.n13,this.flat[9]=this.n23,this.flat[10]=this.n33,this.flat[11]=this.n43,this.flat[12]=this.n14,this.flat[13]=this.n24,this.flat[14]=this.n34,this.flat[15]=this.n44,this.flat},flattenToArray:function(e){return e[0]=this.n11,e[1]=this.n21,e[2]=this.n31,e[3]=this.n41,e[4]=this.n12,e[5]=this.n22,e[6]=this.n32,e[7]=this.n42,e[8]=this.n13,e[9]=this.n23,e[10]=this.n33,e[11]=this.n43,e[12]=this.n14,e[13]=this.n24,e[14]=this.n34,e[15]=this.n44,e},flattenToArrayOffset:function(e,t){return e[t]=this.n11,e[t+1]=this.n21,e[t+2]=this.n31,e[t+3]=this.n41,e[t+4]=this.n12,e[t+5]=this.n22,e[t+6]=this.n32,e[t+7]=this.n42,e[t+8]=this.n13,e[t+9]=this.n23,e[t+10]=this.n33,e[t+11]=this.n43,e[t+12]=this.n14,e[t+13]=this.n24,e[t+14]=this.n34,e[t+15]=this.n44,e},setTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},setScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},setRotationX:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1),this},setRotationY:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1),this},setRotationZ:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1),this},setRotationAxis:function(e,t){var n=Math.cos(t),o=Math.sin(t),h=1-n,c=e.x,_=e.y,E=e.z,f=h*c,p=h*_;return this.set(f*c+n,f*_-o*E,f*E+o*_,0,f*_+o*E,p*_+n,p*E-o*c,0,f*E-o*_,p*E+o*c,h*E*E+n,0,0,0,0,1),this},setPosition:function(e){return this.n14=e.x,this.n24=e.y,this.n34=e.z,this},getPosition:function(){return this.position||(this.position=new THREE.Vector3),this.position.set(this.n14,this.n24,this.n34),this.position},getColumnX:function(){return this.columnX||(this.columnX=new THREE.Vector3),this.columnX.set(this.n11,this.n21,this.n31),this.columnX},getColumnY:function(){return this.columnY||(this.columnY=new THREE.Vector3),this.columnY.set(this.n12,this.n22,this.n32),this.columnY},getColumnZ:function(){return this.columnZ||(this.columnZ=new THREE.Vector3),this.columnZ.set(this.n13,this.n23,this.n33),this.columnZ},setRotationFromEuler:function(e,t){var n=e.x,o=e.y,h=e.z,c=Math.cos(n),n=Math.sin(n),_=Math.cos(o),o=Math.sin(o),E=Math.cos(h),h=Math.sin(h);switch(t){case"YXZ":var f=_*E,p=_*h,u=o*E,m=o*h;this.n11=f+m*n,this.n12=u*n-p,this.n13=c*o,this.n21=c*h,this.n22=c*E,this.n23=-n,this.n31=p*n-u,this.n32=m+f*n,this.n33=c*_;break;case"ZXY":f=_*E,p=_*h,u=o*E,m=o*h,this.n11=f-m*n,this.n12=-c*h,this.n13=u+p*n,this.n21=p+u*n,this.n22=c*E,this.n23=m-f*n,this.n31=-c*o,this.n32=n,this.n33=c*_;break;case"ZYX":f=c*E,p=c*h,u=n*E,m=n*h,this.n11=_*E,this.n12=u*o-p,this.n13=f*o+m,this.n21=_*h,this.n22=m*o+f,this.n23=p*o-u,this.n31=-o,this.n32=n*_,this.n33=c*_;break;case"YZX":f=c*_,p=c*o,u=n*_,m=n*o,this.n11=_*E,this.n12=m-f*h,this.n13=u*h+p,this.n21=h,this.n22=c*E,this.n23=-n*E,this.n31=-o*E,this.n32=p*h+u,this.n33=f-m*h;break;case"XZY":f=c*_,p=c*o,u=n*_,m=n*o,this.n11=_*E,this.n12=-h,this.n13=o*E,this.n21=f*h+m,this.n22=c*E,this.n23=p*h-u,this.n31=u*h-p,this.n32=n*E,this.n33=m*h+f;break;default:f=c*E,p=c*h,u=n*E,m=n*h,this.n11=_*E,this.n12=-_*h,this.n13=o,this.n21=p+u*o,this.n22=f-m*o,this.n23=-n*_,this.n31=m-f*o,this.n32=u+p*o,this.n33=c*_}return this},setRotationFromQuaternion:function(e){var t=e.x,n=e.y,o=e.z,h=e.w,c=t+t,_=n+n,E=o+o,e=t*c,f=t*_;t*=E;var p=n*_;return n*=E,o*=E,c*=h,_*=h,h*=E,this.n11=1-(p+o),this.n12=f-h,this.n13=t+_,this.n21=f+h,this.n22=1-(e+o),this.n23=n-c,this.n31=t-_,this.n32=n+c,this.n33=1-(e+p),this},scale:function(e){var t=e.x,n=e.y,e=e.z;return this.n11*=t,this.n12*=n,this.n13*=e,this.n21*=t,this.n22*=n,this.n23*=e,this.n31*=t,this.n32*=n,this.n33*=e,this.n41*=t,this.n42*=n,this.n43*=e,this},extractPosition:function(e){this.n14=e.n14,this.n24=e.n24,this.n34=e.n34},extractRotation:function(e,t){var n=1/t.x,o=1/t.y,h=1/t.z;this.n11=e.n11*n,this.n21=e.n21*n,this.n31=e.n31*n,this.n12=e.n12*o,this.n22=e.n22*o,this.n32=e.n32*o,this.n13=e.n13*h,this.n23=e.n23*h,this.n33=e.n33*h}},THREE.Matrix4.makeInvert=function(e,t){var n=e.n11,o=e.n12,h=e.n13,c=e.n14,_=e.n21,E=e.n22,f=e.n23,p=e.n24,u=e.n31,m=e.n32,$=e.n33,g=e.n34,v=e.n41,T=e.n42,y=e.n43,R=e.n44;return void 0===t&&(t=new THREE.Matrix4),t.n11=f*g*T-p*$*T+p*m*y-E*g*y-f*m*R+E*$*R,t.n12=c*$*T-h*g*T-c*m*y+o*g*y+h*m*R-o*$*R,t.n13=h*p*T-c*f*T+c*E*y-o*p*y-h*E*R+o*f*R,t.n14=c*f*m-h*p*m-c*E*$+o*p*$+h*E*g-o*f*g,t.n21=p*$*v-f*g*v-p*u*y+_*g*y+f*u*R-_*$*R,t.n22=h*g*v-c*$*v+c*u*y-n*g*y-h*u*R+n*$*R,t.n23=c*f*v-h*p*v-c*_*y+n*p*y+h*_*R-n*f*R,t.n24=h*p*u-c*f*u+c*_*$-n*p*$-h*_*g+n*f*g,t.n31=E*g*v-p*m*v+p*u*T-_*g*T-E*u*R+_*m*R,t.n32=c*m*v-o*g*v-c*u*T+n*g*T+o*u*R-n*m*R,t.n33=h*p*v-c*E*v+c*_*T-n*p*T-o*_*R+n*E*R,t.n34=c*E*u-o*p*u-c*_*m+n*p*m+o*_*g-n*E*g,t.n41=f*m*v-E*$*v-f*u*T+_*$*T+E*u*y-_*m*y,t.n42=o*$*v-h*m*v+h*u*T-n*$*T-o*u*y+n*m*y,t.n43=h*E*v-o*f*v-h*_*T+n*f*T+o*_*y-n*E*y,t.n44=o*f*u-h*E*u+h*_*m-n*f*m-o*_*$+n*E*$,t.multiplyScalar(1/e.determinant()),t},THREE.Matrix4.makeInvert3x3=function(e){var t=e.m33,n=t.m,o=e.n33*e.n22-e.n32*e.n23,h=-e.n33*e.n21+e.n31*e.n23,c=e.n32*e.n21-e.n31*e.n22,_=-e.n33*e.n12+e.n32*e.n13,E=e.n33*e.n11-e.n31*e.n13,f=-e.n32*e.n11+e.n31*e.n12,p=e.n23*e.n12-e.n22*e.n13,u=-e.n23*e.n11+e.n21*e.n13,m=e.n22*e.n11-e.n21*e.n12,e=e.n11*o+e.n21*_+e.n31*p;return 0==e&&console.error("THREE.Matrix4.makeInvert3x3: Matrix not invertible."),e=1/e,n[0]=e*o,n[1]=e*h,n[2]=e*c,n[3]=e*_,n[4]=e*E,n[5]=e*f,n[6]=e*p,n[7]=e*u,n[8]=e*m,t},THREE.Matrix4.makeFrustum=function(e,t,n,o,h,c){var _;return(_=new THREE.Matrix4).n11=2*h/(t-e),_.n12=0,_.n13=(t+e)/(t-e),_.n14=0,_.n21=0,_.n22=2*h/(o-n),_.n23=(o+n)/(o-n),_.n24=0,_.n31=0,_.n32=0,_.n33=-(c+h)/(c-h),_.n34=-2*c*h/(c-h),_.n41=0,_.n42=0,_.n43=-1,_.n44=0,_},THREE.Matrix4.makePerspective=function(e,t,n,o){var h,e=n*Math.tan(e*Math.PI/360);return h=-e,THREE.Matrix4.makeFrustum(h*t,e*t,h,e,n,o)},THREE.Matrix4.makeOrtho=function(e,t,n,o,h,c){var _,E,f,p;return _=new THREE.Matrix4,E=t-e,f=n-o,p=c-h,_.n11=2/E,_.n12=0,_.n13=0,_.n14=-((t+e)/E),_.n21=0,_.n22=2/f,_.n23=0,_.n24=-((n+o)/f),_.n31=0,_.n32=0,_.n33=-2/p,_.n34=-((c+h)/p),_.n41=0,_.n42=0,_.n43=0,_.n44=1,_},THREE.Matrix4.__v1=new THREE.Vector3,THREE.Matrix4.__v2=new THREE.Vector3,THREE.Matrix4.__v3=new THREE.Vector3,THREE.Object3D=function(){this.parent=void 0,this.children=[],this.up=new THREE.Vector3(0,1,0),this.position=new THREE.Vector3,this.rotation=new THREE.Vector3,this.eulerOrder="XYZ",this.scale=new THREE.Vector3(1,1,1),this.flipSided=this.doubleSided=this.dynamic=!1,this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new THREE.Matrix4,this.matrixWorld=new THREE.Matrix4,this.matrixRotationWorld=new THREE.Matrix4,this.matrixWorldNeedsUpdate=this.matrixAutoUpdate=!0,this.quaternion=new THREE.Quaternion,this.useQuaternion=!1,this.boundRadius=0,this.boundRadiusScale=1,this.visible=!0,this.receiveShadow=this.castShadow=!1,this._vector=new THREE.Vector3,this.name=""},THREE.Object3D.prototype={constructor:THREE.Object3D,translate:function(e,t){this.matrix.rotateAxis(t),this.position.addSelf(t.multiplyScalar(e))},translateX:function(e){this.translate(e,this._vector.set(1,0,0))},translateY:function(e){this.translate(e,this._vector.set(0,1,0))},translateZ:function(e){this.translate(e,this._vector.set(0,0,1))},lookAt:function(e){this.matrix.lookAt(e,this.position,this.up),this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)},addChild:function(e){if(-1===this.children.indexOf(e)){void 0!==e.parent&&e.parent.removeChild(e),e.parent=this,this.children.push(e);for(var t=this;void 0!==t.parent;)t=t.parent;void 0!==t&&t instanceof THREE.Scene&&t.addChildRecurse(e)}},removeChild:function(e){var t=this.children.indexOf(e);-1!==t&&(e.parent=void 0,this.children.splice(t,1))},getChildByName:function(e,t){var n,o,h;for(n=0,o=this.children.length;n<o;n++)if((h=this.children[n]).name===e||t&&void 0!==(h=h.getChildByName(e,t)))return h},updateMatrix:function(){this.matrix.setPosition(this.position),this.useQuaternion?this.matrix.setRotationFromQuaternion(this.quaternion):this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder),(1!==this.scale.x||1!==this.scale.y||1!==this.scale.z)&&(this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z))),this.matrixWorldNeedsUpdate=!0},update:function(e,t,n){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(e?this.matrixWorld.multiply(e,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixRotationWorld.extractRotation(this.matrixWorld,this.scale),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=0,o=this.children.length;e<o;e++)this.children[e].update(this.matrixWorld,t,n)}},THREE.Quaternion=function(e,t,n,o){this.set(e||0,t||0,n||0,void 0!==o?o:1)},THREE.Quaternion.prototype={constructor:THREE.Quaternion,set:function(e,t,n,o){return this.x=e,this.y=t,this.z=n,this.w=o,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},setFromEuler:function(e){var t=.5*Math.PI/360,n=e.x*t,o=e.y*t,h=e.z*t,e=Math.cos(o),o=Math.sin(o),t=Math.cos(-h),h=Math.sin(-h),c=Math.cos(n),n=Math.sin(n),_=e*t,E=o*h;return this.w=_*c-E*n,this.x=_*n+E*c,this.y=o*t*c+e*h*n,this.z=e*h*c-o*t*n,this},setFromAxisAngle:function(e,t){var n=t/2,o=Math.sin(n);return this.x=e.x*o,this.y=e.y*o,this.z=e.z*o,this.w=Math.cos(n),this},calculateW:function(){return this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z)),this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0==e?this.w=this.z=this.y=this.x=0:(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this},multiplySelf:function(e){var t=this.x,n=this.y,o=this.z,h=this.w,c=e.x,_=e.y,E=e.z,e=e.w;return this.x=t*e+h*c+n*E-o*_,this.y=n*e+h*_+o*c-t*E,this.z=o*e+h*E+t*_-n*c,this.w=h*e-t*c-n*_-o*E,this},multiply:function(e,t){return this.x=e.x*t.w+e.y*t.z-e.z*t.y+e.w*t.x,this.y=-e.x*t.z+e.y*t.w+e.z*t.x+e.w*t.y,this.z=e.x*t.y-e.y*t.x+e.z*t.w+e.w*t.z,this.w=-e.x*t.x-e.y*t.y-e.z*t.z+e.w*t.w,this},multiplyVector3:function(e,t){t||(t=e);var n=e.x,o=e.y,h=e.z,c=this.x,_=this.y,E=this.z,f=this.w,p=f*n+_*h-E*o,u=f*o+E*n-c*h,m=f*h+c*o-_*n,n=-c*n-_*o-E*h;return t.x=p*f+-(n*c)+-(u*E)- -(m*_),t.y=u*f+-(n*_)+-(m*c)- -(p*E),t.z=m*f+-(n*E)+-(p*_)- -(u*c),t}},THREE.Quaternion.slerp=function(e,t,n,o){var h=e.w*t.w+e.x*t.x+e.y*t.y+e.z*t.z;if(Math.abs(h)>=1)return n.w=e.w,n.x=e.x,n.y=e.y,n.z=e.z,n;var c=Math.acos(h),_=Math.sqrt(1-h*h);return .001>Math.abs(_)?(n.w=.5*(e.w+t.w),n.x=.5*(e.x+t.x),n.y=.5*(e.y+t.y),n.z=.5*(e.z+t.z),n):(h=Math.sin((1-o)*c)/_,o=Math.sin(o*c)/_,n.w=e.w*h+t.w*o,n.x=e.x*h+t.x*o,n.y=e.y*h+t.y*o,n.z=e.z*h+t.z*o,n)},THREE.Vertex=function(e){this.position=e||new THREE.Vector3},THREE.Face3=function(e,t,n,o,h,c){this.a=e,this.b=t,this.c=n,this.normal=o instanceof THREE.Vector3?o:new THREE.Vector3,this.vertexNormals=o instanceof Array?o:[],this.color=h instanceof THREE.Color?h:new THREE.Color,this.vertexColors=h instanceof Array?h:[],this.vertexTangents=[],this.materials=c instanceof Array?c:[c],this.centroid=new THREE.Vector3},THREE.Face4=function(e,t,n,o,h,c,_){this.a=e,this.b=t,this.c=n,this.d=o,this.normal=h instanceof THREE.Vector3?h:new THREE.Vector3,this.vertexNormals=h instanceof Array?h:[],this.color=c instanceof THREE.Color?c:new THREE.Color,this.vertexColors=c instanceof Array?c:[],this.vertexTangents=[],this.materials=_ instanceof Array?_:[_],this.centroid=new THREE.Vector3},THREE.UV=function(e,t){this.set(e||0,t||0)},THREE.UV.prototype={constructor:THREE.UV,set:function(e,t){return this.u=e,this.v=t,this},copy:function(e){return this.set(e.u,e.v),this}},THREE.Geometry=function(){this.id="Geometry"+THREE.GeometryIdCounter++,this.vertices=[],this.colors=[],this.faces=[],this.edges=[],this.faceUvs=[[]],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.skinWeights=[],this.skinIndices=[],this.boundingSphere=this.boundingBox=null,this.dynamic=this.hasTangents=!1},THREE.Geometry.prototype={constructor:THREE.Geometry,computeCentroids:function(){var e,t,n;for(e=0,t=this.faces.length;e<t;e++)(n=this.faces[e]).centroid.set(0,0,0),n instanceof THREE.Face3?(n.centroid.addSelf(this.vertices[n.a].position),n.centroid.addSelf(this.vertices[n.b].position),n.centroid.addSelf(this.vertices[n.c].position),n.centroid.divideScalar(3)):n instanceof THREE.Face4&&(n.centroid.addSelf(this.vertices[n.a].position),n.centroid.addSelf(this.vertices[n.b].position),n.centroid.addSelf(this.vertices[n.c].position),n.centroid.addSelf(this.vertices[n.d].position),n.centroid.divideScalar(4))},computeFaceNormals:function(e){var t,n,o,h,c,_,E=new THREE.Vector3,f=new THREE.Vector3;for(o=0,h=this.faces.length;o<h;o++){if(c=this.faces[o],e&&c.vertexNormals.length){for(E.set(0,0,0),t=0,n=c.vertexNormals.length;t<n;t++)E.addSelf(c.vertexNormals[t]);E.divideScalar(3)}else t=this.vertices[c.a],n=this.vertices[c.b],_=this.vertices[c.c],E.sub(_.position,n.position),f.sub(t.position,n.position),E.crossSelf(f);E.isZero()||E.normalize(),c.normal.copy(E)}},computeVertexNormals:function(){var e,t,n,o;if(void 0==this.__tmpVertices){for(o=this.__tmpVertices=Array(this.vertices.length),e=0,t=this.vertices.length;e<t;e++)o[e]=new THREE.Vector3;for(e=0,t=this.faces.length;e<t;e++)(n=this.faces[e])instanceof THREE.Face3?n.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]:n instanceof THREE.Face4&&(n.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3])}else for(o=this.__tmpVertices,e=0,t=this.vertices.length;e<t;e++)o[e].set(0,0,0);for(e=0,t=this.faces.length;e<t;e++)(n=this.faces[e])instanceof THREE.Face3?(o[n.a].addSelf(n.normal),o[n.b].addSelf(n.normal),o[n.c].addSelf(n.normal)):n instanceof THREE.Face4&&(o[n.a].addSelf(n.normal),o[n.b].addSelf(n.normal),o[n.c].addSelf(n.normal),o[n.d].addSelf(n.normal));for(e=0,t=this.vertices.length;e<t;e++)o[e].normalize();for(e=0,t=this.faces.length;e<t;e++)(n=this.faces[e])instanceof THREE.Face3?(n.vertexNormals[0].copy(o[n.a]),n.vertexNormals[1].copy(o[n.b]),n.vertexNormals[2].copy(o[n.c])):n instanceof THREE.Face4&&(n.vertexNormals[0].copy(o[n.a]),n.vertexNormals[1].copy(o[n.b]),n.vertexNormals[2].copy(o[n.c]),n.vertexNormals[3].copy(o[n.d]))},computeTangents:function(){function e(e,t,n,o,h,c,M){E=e.vertices[t].position,f=e.vertices[n].position,p=e.vertices[o].position,u=_[h],m=_[c],$=_[M],g=f.x-E.x,v=p.x-E.x,T=f.y-E.y,y=p.y-E.y,R=f.z-E.z,x=p.z-E.z,H=m.u-u.u,b=$.u-u.u,w=m.v-u.v,C=1/(H*(S=$.v-u.v)-b*w),P.set((S*g-w*v)*C,(S*T-w*y)*C,(S*R-w*x)*C),V.set((H*v-b*g)*C,(H*y-b*T)*C,(H*x-b*R)*C),A[t].addSelf(P),A[n].addSelf(P),A[o].addSelf(P),L[t].addSelf(V),L[n].addSelf(V),L[o].addSelf(V)}var t,n,o,h,c,_,E,f,p,u,m,$,g,v,T,y,R,x,H,b,w,S,C,M,A=[],L=[],P=new THREE.Vector3,V=new THREE.Vector3,z=new THREE.Vector3,F=new THREE.Vector3,U=new THREE.Vector3;for(t=0,n=this.vertices.length;t<n;t++)A[t]=new THREE.Vector3,L[t]=new THREE.Vector3;for(t=0,n=this.faces.length;t<n;t++)c=this.faces[t],_=this.faceVertexUvs[0][t],c instanceof THREE.Face3?e(this,c.a,c.b,c.c,0,1,2):c instanceof THREE.Face4&&(e(this,c.a,c.b,c.c,0,1,2),e(this,c.a,c.b,c.d,0,1,3));var k=["a","b","c","d"];for(t=0,n=this.faces.length;t<n;t++)for(o=0,c=this.faces[t];o<c.vertexNormals.length;o++)U.copy(c.vertexNormals[o]),M=A[h=c[k[o]]],z.copy(M),z.subSelf(U.multiplyScalar(U.dot(M))).normalize(),F.cross(c.vertexNormals[o],M),h=(h=F.dot(L[h]))<0?-1:1,c.vertexTangents[o]=new THREE.Vector4(z.x,z.y,z.z,h);this.hasTangents=!0},computeBoundingBox:function(){var e;if(this.vertices.length>0){this.boundingBox={x:[this.vertices[0].position.x,this.vertices[0].position.x],y:[this.vertices[0].position.y,this.vertices[0].position.y],z:[this.vertices[0].position.z,this.vertices[0].position.z]};for(var t=1,n=this.vertices.length;t<n;t++)(e=this.vertices[t]).position.x<this.boundingBox.x[0]?this.boundingBox.x[0]=e.position.x:e.position.x>this.boundingBox.x[1]&&(this.boundingBox.x[1]=e.position.x),e.position.y<this.boundingBox.y[0]?this.boundingBox.y[0]=e.position.y:e.position.y>this.boundingBox.y[1]&&(this.boundingBox.y[1]=e.position.y),e.position.z<this.boundingBox.z[0]?this.boundingBox.z[0]=e.position.z:e.position.z>this.boundingBox.z[1]&&(this.boundingBox.z[1]=e.position.z)}},computeBoundingSphere:function(){for(var e=0,t=0,n=this.vertices.length;t<n;t++)e=Math.max(e,this.vertices[t].position.length());this.boundingSphere={radius:e}},computeEdgeFaces:function(){function e(e,t){return Math.min(e,t)+"_"+Math.max(e,t)}function t(e,t,n){void 0===e[t]?(e[t]={set:{},array:[]},e[t].set[n]=1,e[t].array.push(n)):void 0===e[t].set[n]&&(e[t].set[n]=1,e[t].array.push(n))}var n,o,h,c,_,E={};for(n=0,o=this.faces.length;n<o;n++)(_=this.faces[n])instanceof THREE.Face3?(t(E,h=e(_.a,_.b),n),t(E,h=e(_.b,_.c),n),t(E,h=e(_.a,_.c),n)):_ instanceof THREE.Face4&&(t(E,h=e(_.b,_.d),n),t(E,h=e(_.a,_.b),n),t(E,h=e(_.a,_.d),n),t(E,h=e(_.b,_.c),n),t(E,h=e(_.c,_.d),n));for(n=0,o=this.edges.length;n<o;n++)for(h=(_=this.edges[n]).vertexIndices[0],c=_.vertexIndices[1],_.faceIndices=E[e(h,c)].array,h=0;h<_.faceIndices.length;h++)c=_.faceIndices[h],_.faces.push(this.faces[c])}},THREE.GeometryIdCounter=0,THREE.Spline=function(e){function t(e,t,n,o,h,c,_){return e=(n-e)*.5,o=(o-t)*.5,(2*(t-n)+e+o)*_+(-3*(t-n)-2*e-o)*c+e*h+t}this.points=e;var n,o,h,c,_,E,f,p,u,m=[],$={x:0,y:0,z:0};this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return o=Math.floor(n=(this.points.length-1)*e),h=n-o,m[0]=0==o?o:o-1,m[1]=o,m[2]=o>this.points.length-2?o:o+1,m[3]=o>this.points.length-3?o:o+2,E=this.points[m[0]],f=this.points[m[1]],p=this.points[m[2]],u=this.points[m[3]],c=h*h,_=h*c,$.x=t(E.x,f.x,p.x,u.x,h,c,_),$.y=t(E.y,f.y,p.y,u.y,h,c,_),$.z=t(E.z,f.z,p.z,u.z,h,c,_),$},this.getControlPointsArray=function(){var e,t,n=this.points.length,o=[];for(e=0;e<n;e++)t=this.points[e],o[e]=[t.x,t.y,t.z];return o},this.getLength=function(e){var t,n,o=t=t=0,h=new THREE.Vector3,c=new THREE.Vector3,_=[],E=0;for(_[0]=0,e||(e=100),n=this.points.length*e,h.copy(this.points[0]),e=1;e<n;e++)t=e/n,position=this.getPoint(t),c.copy(position),E+=c.distanceTo(h),h.copy(position),t*=this.points.length-1,(t=Math.floor(t))!=o&&(_[t]=E,o=t);return _[_.length]=E,{chunks:_,total:E}},this.reparametrizeByArcLength=function(e){var t,n,o,h,c,_,E=[],f=new THREE.Vector3,p=this.getLength();for(E.push(f.copy(this.points[0]).clone()),t=1;t<this.points.length;t++){for(_=Math.ceil(e*(n=p.chunks[t]-p.chunks[t-1])/p.total),h=(t-1)/(this.points.length-1),c=t/(this.points.length-1),n=1;n<_-1;n++)o=h+n*(1/_)*(c-h),position=this.getPoint(o),E.push(f.copy(position).clone());E.push(f.copy(this.points[t]).clone())}this.points=E}},THREE.Edge=function(e,t,n,o){this.vertices=[e,t],this.vertexIndices=[n,o],this.faces=[],this.faceIndices=[]},THREE.Camera=function(e,t,n,o,h){THREE.Object3D.call(this),this.fov=e||50,this.aspect=t||1,this.near=n||.1,this.far=o||2e3,this.target=h||new THREE.Object3D,this.useTarget=!0,this.matrixWorldInverse=new THREE.Matrix4,this.projectionMatrix=null,this.updateProjectionMatrix()},THREE.Camera.prototype=new THREE.Object3D,THREE.Camera.prototype.constructor=THREE.Camera,THREE.Camera.prototype.supr=THREE.Object3D.prototype,THREE.Camera.prototype.translate=function(e,t){this.matrix.rotateAxis(t),t.multiplyScalar(e),this.position.addSelf(t),this.target.position.addSelf(t)},THREE.Camera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var e=this.fullWidth/this.fullHeight,t=Math.tan(this.fov*Math.PI/360)*this.near,n=-t,o=e*n,e=Math.abs(e*t-o),n=Math.abs(t-n);this.projectionMatrix=THREE.Matrix4.makeFrustum(o+this.x*e/this.fullWidth,o+(this.x+this.width)*e/this.fullWidth,t-(this.y+this.height)*n/this.fullHeight,t-this.y*n/this.fullHeight,this.near,this.far)}else this.projectionMatrix=THREE.Matrix4.makePerspective(this.fov,this.aspect,this.near,this.far)},THREE.Camera.prototype.setViewOffset=function(e,t,n,o,h,c){this.fullWidth=e,this.fullHeight=t,this.x=n,this.y=o,this.width=h,this.height=c,this.updateProjectionMatrix()},THREE.Camera.prototype.update=function(e,t,n){for(this.useTarget?(this.matrix.lookAt(this.position,this.target.position,this.up),this.matrix.setPosition(this.position),e?this.matrixWorld.multiply(e,this.matrix):this.matrixWorld.copy(this.matrix),THREE.Matrix4.makeInvert(this.matrixWorld,this.matrixWorldInverse),t=!0):(this.matrixAutoUpdate&&this.updateMatrix(),(t||this.matrixWorldNeedsUpdate)&&(e?this.matrixWorld.multiply(e,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0,THREE.Matrix4.makeInvert(this.matrixWorld,this.matrixWorldInverse))),e=0;e<this.children.length;e++)this.children[e].update(this.matrixWorld,t,n)},THREE.Light=function(e){THREE.Object3D.call(this),this.color=new THREE.Color(e)},THREE.Light.prototype=new THREE.Object3D,THREE.Light.prototype.constructor=THREE.Light,THREE.Light.prototype.supr=THREE.Object3D.prototype,THREE.AmbientLight=function(e){THREE.Light.call(this,e)},THREE.AmbientLight.prototype=new THREE.Light,THREE.AmbientLight.prototype.constructor=THREE.AmbientLight,THREE.DirectionalLight=function(e,t,n,o){THREE.Light.call(this,e),this.position=new THREE.Vector3(0,1,0),this.intensity=t||1,this.distance=n||0,this.castShadow=void 0!==o&&o},THREE.DirectionalLight.prototype=new THREE.Light,THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight,THREE.PointLight=function(e,t,n){THREE.Light.call(this,e),this.position=new THREE.Vector3,this.intensity=t||1,this.distance=n||0},THREE.PointLight.prototype=new THREE.Light,THREE.PointLight.prototype.constructor=THREE.PointLight,THREE.SpotLight=function(e,t,n,o){THREE.Light.call(this,e),this.position=new THREE.Vector3(0,1,0),this.target=new THREE.Object3D,this.intensity=t||1,this.distance=n||0,this.castShadow=void 0!==o&&o},THREE.SpotLight.prototype=new THREE.Light,THREE.SpotLight.prototype.constructor=THREE.SpotLight,THREE.Material=function(e){this.id=THREE.MaterialCount++,e=e||{},this.opacity=void 0!==e.opacity?e.opacity:1,this.transparent=void 0!==e.transparent&&e.transparent,this.blending=void 0!==e.blending?e.blending:THREE.NormalBlending,this.depthTest=void 0===e.depthTest||e.depthTest,this.polygonOffset=void 0!==e.polygonOffset&&e.polygonOffset,this.polygonOffsetFactor=void 0!==e.polygonOffsetFactor?e.polygonOffsetFactor:0,this.polygonOffsetUnits=void 0!==e.polygonOffsetUnits?e.polygonOffsetUnits:0,this.alphaTest=void 0!==e.alphaTest?e.alphaTest:0},THREE.MaterialCount=0,THREE.NoShading=0,THREE.FlatShading=1,THREE.SmoothShading=2,THREE.NoColors=0,THREE.FaceColors=1,THREE.VertexColors=2,THREE.NormalBlending=0,THREE.AdditiveBlending=1,THREE.SubtractiveBlending=2,THREE.MultiplyBlending=3,THREE.AdditiveAlphaBlending=4,THREE.CubeReflectionMapping=function(){},THREE.CubeRefractionMapping=function(){},THREE.LatitudeReflectionMapping=function(){},THREE.LatitudeRefractionMapping=function(){},THREE.SphericalReflectionMapping=function(){},THREE.SphericalRefractionMapping=function(){},THREE.UVMapping=function(){},THREE.LineBasicMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=new THREE.Color(void 0!==e.color?e.color:16777215),this.linewidth=void 0!==e.linewidth?e.linewidth:1,this.linecap=void 0!==e.linecap?e.linecap:"round",this.linejoin=void 0!==e.linejoin?e.linejoin:"round",this.vertexColors=!!e.vertexColors&&e.vertexColors},THREE.LineBasicMaterial.prototype=new THREE.Material,THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial,THREE.MeshBasicMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=new THREE.Color(void 0!==e.color?e.color:16777215),this.map=void 0!==e.map?e.map:null,this.lightMap=void 0!==e.lightMap?e.lightMap:null,this.envMap=void 0!==e.envMap?e.envMap:null,this.combine=void 0!==e.combine?e.combine:THREE.MultiplyOperation,this.reflectivity=void 0!==e.reflectivity?e.reflectivity:1,this.refractionRatio=void 0!==e.refractionRatio?e.refractionRatio:.98,this.shading=void 0!==e.shading?e.shading:THREE.SmoothShading,this.wireframe=void 0!==e.wireframe&&e.wireframe,this.wireframeLinewidth=void 0!==e.wireframeLinewidth?e.wireframeLinewidth:1,this.wireframeLinecap=void 0!==e.wireframeLinecap?e.wireframeLinecap:"round",this.wireframeLinejoin=void 0!==e.wireframeLinejoin?e.wireframeLinejoin:"round",this.vertexColors=void 0!==e.vertexColors&&e.vertexColors,this.skinning=void 0!==e.skinning&&e.skinning,this.morphTargets=void 0!==e.morphTargets&&e.morphTargets},THREE.MeshBasicMaterial.prototype=new THREE.Material,THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial,THREE.MeshLambertMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=new THREE.Color(void 0!==e.color?e.color:16777215),this.map=void 0!==e.map?e.map:null,this.lightMap=void 0!==e.lightMap?e.lightMap:null,this.envMap=void 0!==e.envMap?e.envMap:null,this.combine=void 0!==e.combine?e.combine:THREE.MultiplyOperation,this.reflectivity=void 0!==e.reflectivity?e.reflectivity:1,this.refractionRatio=void 0!==e.refractionRatio?e.refractionRatio:.98,this.shading=void 0!==e.shading?e.shading:THREE.SmoothShading,this.wireframe=void 0!==e.wireframe&&e.wireframe,this.wireframeLinewidth=void 0!==e.wireframeLinewidth?e.wireframeLinewidth:1,this.wireframeLinecap=void 0!==e.wireframeLinecap?e.wireframeLinecap:"round",this.wireframeLinejoin=void 0!==e.wireframeLinejoin?e.wireframeLinejoin:"round",this.vertexColors=void 0!==e.vertexColors&&e.vertexColors,this.skinning=void 0!==e.skinning&&e.skinning,this.morphTargets=void 0!==e.morphTargets&&e.morphTargets},THREE.MeshLambertMaterial.prototype=new THREE.Material,THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial,THREE.MeshPhongMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=new THREE.Color(void 0!==e.color?e.color:16777215),this.ambient=new THREE.Color(void 0!==e.ambient?e.ambient:328965),this.specular=new THREE.Color(void 0!==e.specular?e.specular:1118481),this.shininess=void 0!==e.shininess?e.shininess:30,this.map=void 0!==e.map?e.map:null,this.lightMap=void 0!==e.lightMap?e.lightMap:null,this.envMap=void 0!==e.envMap?e.envMap:null,this.combine=void 0!==e.combine?e.combine:THREE.MultiplyOperation,this.reflectivity=void 0!==e.reflectivity?e.reflectivity:1,this.refractionRatio=void 0!==e.refractionRatio?e.refractionRatio:.98,this.shading=void 0!==e.shading?e.shading:THREE.SmoothShading,this.wireframe=void 0!==e.wireframe&&e.wireframe,this.wireframeLinewidth=void 0!==e.wireframeLinewidth?e.wireframeLinewidth:1,this.wireframeLinecap=void 0!==e.wireframeLinecap?e.wireframeLinecap:"round",this.wireframeLinejoin=void 0!==e.wireframeLinejoin?e.wireframeLinejoin:"round",this.vertexColors=void 0!==e.vertexColors&&e.vertexColors,this.skinning=void 0!==e.skinning&&e.skinning,this.morphTargets=void 0!==e.morphTargets&&e.morphTargets},THREE.MeshPhongMaterial.prototype=new THREE.Material,THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial,THREE.MeshDepthMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.shading=void 0!==e.shading?e.shading:THREE.SmoothShading,this.wireframe=void 0!==e.wireframe&&e.wireframe,this.wireframeLinewidth=void 0!==e.wireframeLinewidth?e.wireframeLinewidth:1},THREE.MeshDepthMaterial.prototype=new THREE.Material,THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial,THREE.MeshNormalMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.shading=e.shading?e.shading:THREE.FlatShading,this.wireframe=!!e.wireframe&&e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth?e.wireframeLinewidth:1},THREE.MeshNormalMaterial.prototype=new THREE.Material,THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial,THREE.MeshFaceMaterial=function(){},THREE.MeshShaderMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.fragmentShader=void 0!==e.fragmentShader?e.fragmentShader:"void main() {}",this.vertexShader=void 0!==e.vertexShader?e.vertexShader:"void main() {}",this.uniforms=void 0!==e.uniforms?e.uniforms:{},this.attributes=e.attributes,this.shading=void 0!==e.shading?e.shading:THREE.SmoothShading,this.wireframe=void 0!==e.wireframe&&e.wireframe,this.wireframeLinewidth=void 0!==e.wireframeLinewidth?e.wireframeLinewidth:1,this.fog=void 0!==e.fog&&e.fog,this.lights=void 0!==e.lights&&e.lights,this.vertexColors=void 0!==e.vertexColors&&e.vertexColors,this.skinning=void 0!==e.skinning&&e.skinning,this.morphTargets=void 0!==e.morphTargets&&e.morphTargets},THREE.MeshShaderMaterial.prototype=new THREE.Material,THREE.MeshShaderMaterial.prototype.constructor=THREE.MeshShaderMaterial,THREE.ParticleBasicMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=new THREE.Color(void 0!==e.color?e.color:16777215),this.map=void 0!==e.map?e.map:null,this.size=void 0!==e.size?e.size:1,this.sizeAttenuation=void 0===e.sizeAttenuation||e.sizeAttenuation,this.vertexColors=void 0!==e.vertexColors&&e.vertexColors},THREE.ParticleBasicMaterial.prototype=new THREE.Material,THREE.ParticleBasicMaterial.prototype.constructor=THREE.ParticleBasicMaterial,THREE.ParticleCanvasMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=new THREE.Color(void 0!==e.color?e.color:16777215),this.program=void 0!==e.program?e.program:function(){}},THREE.ParticleCanvasMaterial.prototype=new THREE.Material,THREE.ParticleCanvasMaterial.prototype.constructor=THREE.ParticleCanvasMaterial,THREE.ParticleDOMMaterial=function(e){THREE.Material.call(this),this.domElement=e},THREE.Texture=function(e,t,n,o,h,c){this.id=THREE.TextureCount++,this.image=e,this.mapping=void 0!==t?t:new THREE.UVMapping,this.wrapS=void 0!==n?n:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==o?o:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==h?h:THREE.LinearFilter,this.minFilter=void 0!==c?c:THREE.LinearMipMapLinearFilter,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.needsUpdate=!1},THREE.Texture.prototype={constructor:THREE.Texture,clone:function(){var e=new THREE.Texture(this.image,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);return e.offset.copy(this.offset),e.repeat.copy(this.repeat),e}},THREE.TextureCount=0,THREE.MultiplyOperation=0,THREE.MixOperation=1,THREE.RepeatWrapping=0,THREE.ClampToEdgeWrapping=1,THREE.MirroredRepeatWrapping=2,THREE.NearestFilter=3,THREE.NearestMipMapNearestFilter=4,THREE.NearestMipMapLinearFilter=5,THREE.LinearFilter=6,THREE.LinearMipMapNearestFilter=7,THREE.LinearMipMapLinearFilter=8,THREE.ByteType=9,THREE.UnsignedByteType=10,THREE.ShortType=11,THREE.UnsignedShortType=12,THREE.IntType=13,THREE.UnsignedIntType=14,THREE.FloatType=15,THREE.AlphaFormat=16,THREE.RGBFormat=17,THREE.RGBAFormat=18,THREE.LuminanceFormat=19,THREE.LuminanceAlphaFormat=20,THREE.DataTexture=function(e,t,n,o,h,c,_,E,f){THREE.Texture.call(this,null,h,c,_,E,f),this.image={data:e,width:t,height:n},this.format=void 0!==o?o:THREE.RGBAFormat},THREE.DataTexture.prototype=new THREE.Texture,THREE.DataTexture.prototype.constructor=THREE.DataTexture,THREE.DataTexture.prototype={clone:function(){var e=new THREE.DataTexture(this.data.slice(0),this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);return e.offset.copy(this.offset),e.repeat.copy(this.repeat),e}},THREE.Particle=function(e){THREE.Object3D.call(this),this.materials=e instanceof Array?e:[e]},THREE.Particle.prototype=new THREE.Object3D,THREE.Particle.prototype.constructor=THREE.Particle,THREE.ParticleSystem=function(e,t){THREE.Object3D.call(this),this.geometry=e,this.materials=t instanceof Array?t:[t],this.sortParticles=!1},THREE.ParticleSystem.prototype=new THREE.Object3D,THREE.ParticleSystem.prototype.constructor=THREE.ParticleSystem,THREE.Line=function(e,t,n){THREE.Object3D.call(this),this.geometry=e,this.materials=t instanceof Array?t:[t],this.type=void 0!=n?n:THREE.LineStrip},THREE.LineStrip=0,THREE.LinePieces=1,THREE.Line.prototype=new THREE.Object3D,THREE.Line.prototype.constructor=THREE.Line,THREE.Mesh=function(e,t){if(THREE.Object3D.call(this),this.geometry=e,this.materials=t&&t.length?t:[t],this.overdraw=!1,this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere(),this.boundRadius=e.boundingSphere.radius,this.geometry.morphTargets.length)){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var n=0;n<this.geometry.morphTargets.length;n++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[n].name]=n}},THREE.Mesh.prototype=new THREE.Object3D,THREE.Mesh.prototype.constructor=THREE.Mesh,THREE.Mesh.prototype.supr=THREE.Object3D.prototype,THREE.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},THREE.Bone=function(e){THREE.Object3D.call(this),this.skin=e,this.skinMatrix=new THREE.Matrix4,this.hasNoneBoneChildren=!1},THREE.Bone.prototype=new THREE.Object3D,THREE.Bone.prototype.constructor=THREE.Bone,THREE.Bone.prototype.supr=THREE.Object3D.prototype,THREE.Bone.prototype.update=function(e,t,n){this.matrixAutoUpdate&&(t|=this.updateMatrix()),(t||this.matrixWorldNeedsUpdate)&&(e?this.skinMatrix.multiply(e,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);var o,h=this.children.length;if(this.hasNoneBoneChildren)for(this.matrixWorld.multiply(this.skin.matrixWorld,this.skinMatrix),o=0;o<h;o++)(e=this.children[o])instanceof THREE.Bone?e.update(this.skinMatrix,t,n):e.update(this.matrixWorld,!0,n);else for(o=0;o<h;o++)this.children[o].update(this.skinMatrix,t,n)},THREE.Bone.prototype.addChild=function(e){-1!==this.children.indexOf(e)||(void 0!==e.parent&&e.parent.removeChild(e),e.parent=this,this.children.push(e),e instanceof THREE.Bone)||(this.hasNoneBoneChildren=!0)},THREE.SkinnedMesh=function(e,t){var n,o,h,c,_,E;if(THREE.Mesh.call(this,e,t),this.identityMatrix=new THREE.Matrix4,this.bones=[],this.boneMatrices=[],void 0!==this.geometry.bones){for(n=0;n<this.geometry.bones.length;n++)c=(h=this.geometry.bones[n]).pos,_=h.rotq,E=h.scl,(o=this.addBone()).name=h.name,o.position.set(c[0],c[1],c[2]),o.quaternion.set(_[0],_[1],_[2],_[3]),o.useQuaternion=!0,void 0!==E?o.scale.set(E[0],E[1],E[2]):o.scale.set(1,1,1);for(n=0;n<this.bones.length;n++)h=this.geometry.bones[n],o=this.bones[n],-1===h.parent?this.addChild(o):this.bones[h.parent].addChild(o);this.boneMatrices=new Float32Array(16*this.bones.length),this.pose()}},THREE.SkinnedMesh.prototype=new THREE.Mesh,THREE.SkinnedMesh.prototype.constructor=THREE.SkinnedMesh,THREE.SkinnedMesh.prototype.update=function(e,t,n){if(this.visible){this.matrixAutoUpdate&&(t|=this.updateMatrix()),(t||this.matrixWorldNeedsUpdate)&&(e?this.matrixWorld.multiply(e,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);var o,h=this.children.length;for(o=0;o<h;o++)(e=this.children[o])instanceof THREE.Bone?e.update(this.identityMatrix,!1,n):e.update(this.matrixWorld,t,n);for(t=0,n=this.bones.length,ba=this.bones,bm=this.boneMatrices;t<n;t++)ba[t].skinMatrix.flattenToArrayOffset(bm,16*t)}},THREE.SkinnedMesh.prototype.addBone=function(e){return void 0===e&&(e=new THREE.Bone(this)),this.bones.push(e),e},THREE.SkinnedMesh.prototype.pose=function(){this.update(void 0,!0);for(var e,t=[],n=0;n<this.bones.length;n++)e=this.bones[n],t.push(THREE.Matrix4.makeInvert(e.skinMatrix)),e.skinMatrix.flattenToArrayOffset(this.boneMatrices,16*n);if(void 0===this.geometry.skinVerticesA)for(e=0,this.geometry.skinVerticesA=[],this.geometry.skinVerticesB=[];e<this.geometry.skinIndices.length;e++){var o,n=this.geometry.vertices[e].position,h=this.geometry.skinIndices[e].x,c=this.geometry.skinIndices[e].y;o=new THREE.Vector3(n.x,n.y,n.z),this.geometry.skinVerticesA.push(t[h].multiplyVector3(o)),o=new THREE.Vector3(n.x,n.y,n.z),this.geometry.skinVerticesB.push(t[c].multiplyVector3(o)),this.geometry.skinWeights[e].x+this.geometry.skinWeights[e].y!==1&&(n=(1-(this.geometry.skinWeights[e].x+this.geometry.skinWeights[e].y))*.5,this.geometry.skinWeights[e].x+=n,this.geometry.skinWeights[e].y+=n)}},THREE.Ribbon=function(e,t){THREE.Object3D.call(this),this.geometry=e,this.materials=t instanceof Array?t:[t]},THREE.Ribbon.prototype=new THREE.Object3D,THREE.Ribbon.prototype.constructor=THREE.Ribbon,THREE.LOD=function(){THREE.Object3D.call(this),this.LODs=[]},THREE.LOD.prototype=new THREE.Object3D,THREE.LOD.prototype.constructor=THREE.LOD,THREE.LOD.prototype.supr=THREE.Object3D.prototype,THREE.LOD.prototype.add=function(e,t){void 0===t&&(t=0);for(var t=Math.abs(t),n=0;n<this.LODs.length&&!(t<this.LODs[n].visibleAtDistance);n++);this.LODs.splice(n,0,{visibleAtDistance:t,object3D:e}),this.addChild(e)},THREE.LOD.prototype.update=function(e,t,n){if(this.matrixAutoUpdate&&(t|=this.updateMatrix()),(t||this.matrixWorldNeedsUpdate)&&(e?this.matrixWorld.multiply(e,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0),this.LODs.length>1){e=-((e=n.matrixWorldInverse).n31*this.position.x+e.n32*this.position.y+e.n33*this.position.z+e.n34),this.LODs[0].object3D.visible=!0;for(var o=1;o<this.LODs.length;o++)if(e>=this.LODs[o].visibleAtDistance)this.LODs[o-1].object3D.visible=!1,this.LODs[o].object3D.visible=!0;else break;for(;o<this.LODs.length;o++)this.LODs[o].object3D.visible=!1}for(e=0;e<this.children.length;e++)this.children[e].update(this.matrixWorld,t,n)},THREE.Sprite=function(e){THREE.Object3D.call(this),void 0!==e.material?(this.material=e.material,this.map=void 0,this.blending=material.blending):void 0!==e.map&&(this.map=e.map instanceof THREE.Texture?e.map:THREE.ImageUtils.loadTexture(e.map),this.material=void 0,this.blending=void 0!==e.blending?e.blending:THREE.NormalBlending),this.useScreenCoordinates=void 0===e.useScreenCoordinates||e.useScreenCoordinates,this.mergeWith3D=void 0!==e.mergeWith3D?e.mergeWith3D:!this.useScreenCoordinates,this.affectedByDistance=void 0!==e.affectedByDistance?e.affectedByDistance:!this.useScreenCoordinates,this.scaleByViewport=void 0!==e.scaleByViewport?e.scaleByViewport:!this.affectedByDistance,this.alignment=e.alignment instanceof THREE.Vector2?e.alignment:THREE.SpriteAlignment.center,this.rotation3d=this.rotation,this.rotation=0,this.opacity=1,this.uvOffset=new THREE.Vector2(0,0),this.uvScale=new THREE.Vector2(1,1)},THREE.Sprite.prototype=new THREE.Object3D,THREE.Sprite.prototype.constructor=THREE.Sprite,THREE.Sprite.prototype.supr=THREE.Object3D.prototype,THREE.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position),this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d),(1!==this.scale.x||1!==this.scale.y)&&(this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,this.scale.y)),this.matrixWorldNeedsUpdate=!0},THREE.SpriteAlignment={},THREE.SpriteAlignment.topLeft=new THREE.Vector2(1,-1),THREE.SpriteAlignment.topCenter=new THREE.Vector2(0,-1),THREE.SpriteAlignment.topRight=new THREE.Vector2(-1,-1),THREE.SpriteAlignment.centerLeft=new THREE.Vector2(1,0),THREE.SpriteAlignment.center=new THREE.Vector2(0,0),THREE.SpriteAlignment.centerRight=new THREE.Vector2(-1,0),THREE.SpriteAlignment.bottomLeft=new THREE.Vector2(1,1),THREE.SpriteAlignment.bottomCenter=new THREE.Vector2(0,1),THREE.SpriteAlignment.bottomRight=new THREE.Vector2(-1,1),THREE.Scene=function(){THREE.Object3D.call(this),this.matrixAutoUpdate=!1,this.collisions=this.overrideMaterial=this.fog=null,this.objects=[],this.lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},THREE.Scene.prototype=new THREE.Object3D,THREE.Scene.prototype.constructor=THREE.Scene,THREE.Scene.prototype.supr=THREE.Object3D.prototype,THREE.Scene.prototype.addChild=function(e){this.supr.addChild.call(this,e),this.addChildRecurse(e)},THREE.Scene.prototype.addChildRecurse=function(e){e instanceof THREE.Light?-1===this.lights.indexOf(e)&&this.lights.push(e):e instanceof THREE.Camera||e instanceof THREE.Bone||-1!==this.objects.indexOf(e)||(this.objects.push(e),this.__objectsAdded.push(e));for(var t=0;t<e.children.length;t++)this.addChildRecurse(e.children[t])},THREE.Scene.prototype.removeChild=function(e){this.supr.removeChild.call(this,e),this.removeChildRecurse(e)},THREE.Scene.prototype.removeChildRecurse=function(e){if(e instanceof THREE.Light){var t=this.lights.indexOf(e);-1!==t&&this.lights.splice(t,1)}else e instanceof THREE.Camera||-1!==(t=this.objects.indexOf(e))&&(this.objects.splice(t,1),this.__objectsRemoved.push(e));for(t=0;t<e.children.length;t++)this.removeChildRecurse(e.children[t])},THREE.Scene.prototype.addObject=THREE.Scene.prototype.addChild,THREE.Scene.prototype.removeObject=THREE.Scene.prototype.removeChild,THREE.Scene.prototype.addLight=THREE.Scene.prototype.addChild,THREE.Scene.prototype.removeLight=THREE.Scene.prototype.removeChild,THREE.Fog=function(e,t,n){this.color=new THREE.Color(e),this.near=t||1,this.far=n||1e3},THREE.FogExp2=function(e,t){this.color=new THREE.Color(e),this.density=void 0!==t?t:25e-5},THREE.Projector=function(){function e(){var e=T[_]=T[_]||new THREE.RenderableVertex;return _++,e}function t(e,t){return t.z-e.z}function n(e,t){var n=0,o=1,h=e.z+e.w,c=t.z+t.w,_=-e.z+e.w,E=-t.z+t.w;return h>=0&&c>=0&&_>=0&&E>=0||(!(h<0)||!(c<0))&&(!(_<0)||!(E<0))&&(h<0?n=Math.max(n,h/(h-c)):c<0&&(o=Math.min(o,h/(h-c))),_<0?n=Math.max(n,_/(_-E)):E<0&&(o=Math.min(o,_/(_-E))),!(o<n)&&(e.lerpSelf(t,n),t.lerpSelf(e,1-o),!0))}var o,h,c,_,E,f,p,u,m,$,g,v=[],T=[],y=[],R=[],x=[],H=[],b=new THREE.Vector4,w=new THREE.Vector4,S=new THREE.Matrix4,C=new THREE.Matrix4,M=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],A=new THREE.Vector4,L=new THREE.Vector4;this.projectVector=function(e,t){return S.multiply(t.projectionMatrix,t.matrixWorldInverse),S.multiplyVector3(e),e},this.unprojectVector=function(e,t){return S.multiply(t.matrixWorld,THREE.Matrix4.makeInvert(t.projectionMatrix)),S.multiplyVector3(e),e},this.projectObjects=function(e,n,c){var _,E,f,n=[];for(h=0,E=e.objects,e=0,_=E.length;e<_;e++){if(!(p=!(f=E[e]).visible)&&(p=f instanceof THREE.Mesh)){a:{p=void 0;for(var p,u=f.matrixWorld,m=-f.geometry.boundingSphere.radius*Math.max(f.scale.x,Math.max(f.scale.y,f.scale.z)),$=0;$<6;$++)if((p=M[$].x*u.n14+M[$].y*u.n24+M[$].z*u.n34+M[$].w)<=m){p=!1;break a}p=!0}p=!p}p||(p=v[h]=v[h]||new THREE.RenderableObject,h++,o=p,b.copy(f.position),S.multiplyVector3(b),o.object=f,o.z=b.z,n.push(o))}return c&&n.sort(t),n},this.projectScene=function(o,h,v){var b,P,V,z,F,U,k,B,D,N,I,O,W,G,j,X,Y,Z=[],Q=h.near,K=h.far;for(g=m=p=f=0,h.matrixAutoUpdate&&h.update(void 0,!0),o.update(void 0,!1,h),S.multiply(h.projectionMatrix,h.matrixWorldInverse),M[0].set(S.n41-S.n11,S.n42-S.n12,S.n43-S.n13,S.n44-S.n14),M[1].set(S.n41+S.n11,S.n42+S.n12,S.n43+S.n13,S.n44+S.n14),M[2].set(S.n41+S.n21,S.n42+S.n22,S.n43+S.n23,S.n44+S.n24),M[3].set(S.n41-S.n21,S.n42-S.n22,S.n43-S.n23,S.n44-S.n24),M[4].set(S.n41-S.n31,S.n42-S.n32,S.n43-S.n33,S.n44-S.n34),M[5].set(S.n41+S.n31,S.n42+S.n32,S.n43+S.n33,S.n44+S.n34),b=0;b<6;b++)(D=M[b]).divideScalar(Math.sqrt(D.x*D.x+D.y*D.y+D.z*D.z));for(D=this.projectObjects(o,h,!0),o=0,b=D.length;o<b;o++)if((N=D[o].object).visible){if(I=N.matrixWorld,O=N.matrixRotationWorld,W=N.materials,G=N.overdraw,_=0,N instanceof THREE.Mesh){for(z=(j=N.geometry).vertices,X=j.faces,j=j.faceVertexUvs,P=0,V=z.length;P<V;P++)(c=e()).positionWorld.copy(z[P].position),I.multiplyVector3(c.positionWorld),c.positionScreen.copy(c.positionWorld),S.multiplyVector4(c.positionScreen),c.positionScreen.x/=c.positionScreen.w,c.positionScreen.y/=c.positionScreen.w,c.visible=c.positionScreen.z>Q&&c.positionScreen.z<K;for(z=0,P=X.length;z<P;z++){if((V=X[z])instanceof THREE.Face3){if(F=T[V.a],U=T[V.b],k=T[V.c],!F.visible||!U.visible||!k.visible||!N.doubleSided&&N.flipSided==(k.positionScreen.x-F.positionScreen.x)*(U.positionScreen.y-F.positionScreen.y)-(k.positionScreen.y-F.positionScreen.y)*(U.positionScreen.x-F.positionScreen.x)<0)continue;B=y[f]=y[f]||new THREE.RenderableFace3,f++,(E=B).v1.copy(F),E.v2.copy(U),E.v3.copy(k)}else if(V instanceof THREE.Face4){if(F=T[V.a],U=T[V.b],k=T[V.c],B=T[V.d],!F.visible||!U.visible||!k.visible||!B.visible||!N.doubleSided&&N.flipSided==((B.positionScreen.x-F.positionScreen.x)*(U.positionScreen.y-F.positionScreen.y)-(B.positionScreen.y-F.positionScreen.y)*(U.positionScreen.x-F.positionScreen.x)<0||(U.positionScreen.x-k.positionScreen.x)*(B.positionScreen.y-k.positionScreen.y)-(U.positionScreen.y-k.positionScreen.y)*(B.positionScreen.x-k.positionScreen.x)<0))continue;Y=R[p]=R[p]||new THREE.RenderableFace4,p++,(E=Y).v1.copy(F),E.v2.copy(U),E.v3.copy(k),E.v4.copy(B)}for(E.normalWorld.copy(V.normal),O.multiplyVector3(E.normalWorld),E.centroidWorld.copy(V.centroid),I.multiplyVector3(E.centroidWorld),E.centroidScreen.copy(E.centroidWorld),S.multiplyVector3(E.centroidScreen),k=V.vertexNormals,F=0,U=k.length;F<U;F++)(B=E.vertexNormalsWorld[F]).copy(k[F]),O.multiplyVector3(B);for(F=0,U=j.length;F<U;F++)if(Y=j[F][z])for(k=0,B=Y.length;k<B;k++)E.uvs[F][k]=Y[k];E.meshMaterials=W,E.faceMaterials=V.materials,E.overdraw=G,E.z=E.centroidScreen.z,Z.push(E)}}else if(N instanceof THREE.Line)for(C.multiply(S,I),z=N.geometry.vertices,(F=e()).positionScreen.copy(z[0].position),C.multiplyVector4(F.positionScreen),P=1,V=z.length;P<V;P++)(F=e()).positionScreen.copy(z[P].position),C.multiplyVector4(F.positionScreen),U=T[_-2],A.copy(F.positionScreen),L.copy(U.positionScreen),n(A,L)&&(A.multiplyScalar(1/A.w),L.multiplyScalar(1/L.w),I=x[m]=x[m]||new THREE.RenderableLine,m++,(u=I).v1.positionScreen.copy(A),u.v2.positionScreen.copy(L),u.z=Math.max(A.z,L.z),u.materials=N.materials,Z.push(u));else N instanceof THREE.Particle&&(w.set(N.matrixWorld.n14,N.matrixWorld.n24,N.matrixWorld.n34,1),S.multiplyVector4(w),w.z/=w.w,w.z>0&&w.z<1)&&(I=H[g]=H[g]||new THREE.RenderableParticle,g++,($=I).x=w.x/w.w,$.y=w.y/w.w,$.z=w.z,$.rotation=N.rotation.z,$.scale.x=N.scale.x*Math.abs($.x-(w.x+h.projectionMatrix.n11)/(w.w+h.projectionMatrix.n14)),$.scale.y=N.scale.y*Math.abs($.y-(w.y+h.projectionMatrix.n22)/(w.w+h.projectionMatrix.n24)),$.materials=N.materials,Z.push($))}return v&&Z.sort(t),Z}},THREE.DOMRenderer=function(){THREE.Renderer.call(this);var e,t,n,o,h=null,c=new THREE.Projector;this.domElement=document.createElement("div"),this.setSize=function(h,c){e=h,t=c,n=e/2,o=t/2},this.render=function(e,t){var _,E,f,p,u,m,$,g;for(h=c.projectScene(e,t),_=0,E=h.length;_<E;_++)if((u=h[_])instanceof THREE.RenderableParticle)for($=u.x*n+n,g=u.y*o+o,f=0,p=u.material.length;f<p;f++)(m=u.material[f])instanceof THREE.ParticleDOMMaterial&&((m=m.domElement).style.left=$+"px",m.style.top=g+"px")}},THREE.CanvasRenderer=function(e){function t(e){et!=e&&(K.globalAlpha=et=e)}function n(e){if(ei!=e){switch(e){case THREE.NormalBlending:K.globalCompositeOperation="source-over";break;case THREE.AdditiveBlending:K.globalCompositeOperation="lighter";break;case THREE.SubtractiveBlending:K.globalCompositeOperation="darker"}ei=e}}function o(e){er!=e&&(K.strokeStyle=er=e)}function h(e){en!=e&&(K.fillStyle=en=e)}var c,_,E,f,p,u,m,$,g,v,T,y,R,x,H,b,w,S,C,M,A,L,P,V,z,F,U,k,B,D,N,I,O,W,G,j,X=this,Y=null,Z=new THREE.Projector,e=e||{},Q=void 0!==e.canvas?e.canvas:document.createElement("canvas"),K=Q.getContext("2d"),J=new THREE.Color(0),ee=0,et=1,ei=0,er=null,en=null,eo=null,ea=null,es=null,eh=new THREE.RenderableVertex,el=new THREE.RenderableVertex,ec=new THREE.Color(0),e_=new THREE.Color(0),eE=new THREE.Color(0),ef=new THREE.Color(0),ep=new THREE.Color(0),eu=[],ed=new THREE.Rectangle,em=new THREE.Rectangle,e$=new THREE.Rectangle,eg=!1,ev=new THREE.Color,eT=new THREE.Color,ey=new THREE.Color,eR=new THREE.Color,ex=new THREE.Vector3,e=16;(N=document.createElement("canvas")).width=N.height=2,(I=N.getContext("2d")).fillStyle="rgba(0,0,0,1)",I.fillRect(0,0,2,2),W=(O=I.getImageData(0,0,2,2)).data,(G=document.createElement("canvas")).width=G.height=e,(j=G.getContext("2d")).translate(-e/2,-e/2),j.scale(e,e),e--,this.domElement=Q,this.sortElements=this.sortObjects=this.autoClear=!0,this.data={vertices:0,faces:0},this.setSize=function(e,t){c=e,_=t,E=Math.floor(c/2),f=Math.floor(_/2),Q.width=c,Q.height=_,ed.set(-E,-f,E,f),em.set(-E,-f,E,f),et=1,ei=0,es=ea=eo=en=er=null},this.setClearColor=function(e,t){J.copy(e),ee=t,em.set(-E,-f,E,f)},this.setClearColorHex=function(e,t){J.setHex(e),ee=t,em.set(-E,-f,E,f)},this.clear=function(){K.setTransform(1,0,0,-1,E,f),em.isEmpty()||(em.minSelf(ed),em.inflate(2),ee<1&&K.clearRect(Math.floor(em.getX()),Math.floor(em.getY()),Math.floor(em.getWidth()),Math.floor(em.getHeight())),ee>0&&(n(THREE.NormalBlending),t(1),h("rgba("+Math.floor(255*J.r)+","+Math.floor(255*J.g)+","+Math.floor(255*J.b)+","+ee+")"),K.fillRect(Math.floor(em.getX()),Math.floor(em.getY()),Math.floor(em.getWidth()),Math.floor(em.getHeight()))),em.empty())},this.render=function(e,c){var _,Q,J,ee,et,ei,er,en;function eH(e,t,n,o){var h,c,_,E,f=e.lights,e=0;for(h=f.length;e<h;e++)_=(c=f[e]).color,c instanceof THREE.DirectionalLight?(E=n.dot(c.position))<=0||(E*=c.intensity,o.r+=_.r*E,o.g+=_.g*E,o.b+=_.b*E):c instanceof THREE.PointLight&&((E=n.dot(ex.sub(c.position,t).normalize()))<=0||0!=(E*=0==c.distance?1:1-Math.min(t.distanceTo(c.position)/c.distance,1))&&(E*=c.intensity,o.r+=_.r*E,o.g+=_.g*E,o.b+=_.b*E))}function eb(e,c,_){var p,u,m,$,g,v;t(_.opacity),n(_.blending),_ instanceof THREE.ParticleBasicMaterial?_.map&&(g=($=_.map.image).width>>1,v=$.height>>1,_=c.scale.x*E,m=c.scale.y*f,p=_*g,u=m*v,e$.set(e.x-p,e.y-u,e.x+p,e.y+u),ed.instersects(e$)&&(K.save(),K.translate(e.x,e.y),K.rotate(-c.rotation),K.scale(_,-m),K.translate(-g,-v),K.drawImage($,0,0),K.restore())):_ instanceof THREE.ParticleCanvasMaterial&&(p=c.scale.x*E,u=c.scale.y*f,e$.set(e.x-p,e.y-u,e.x+p,e.y+u),ed.instersects(e$)&&(o(_.color.getContextStyle()),h(_.color.getContextStyle()),K.save(),K.translate(e.x,e.y),K.rotate(-c.rotation),K.scale(p,u),_.program(K),K.restore()))}function e0(e,h,c,_){t(_.opacity),n(_.blending),K.beginPath(),K.moveTo(e.positionScreen.x,e.positionScreen.y),K.lineTo(h.positionScreen.x,h.positionScreen.y),K.closePath(),_ instanceof THREE.LineBasicMaterial&&(eo!=(e=_.linewidth)&&(K.lineWidth=eo=e),ea!=(e=_.linecap)&&(K.lineCap=ea=e),es!=(e=_.linejoin)&&(K.lineJoin=es=e),o(_.color.getContextStyle()),K.stroke(),e$.inflate(2*_.linewidth))}function e8(e,o,h,_,E,f,p,u,m){X.data.vertices+=3,X.data.faces++,t(u.opacity),n(u.blending),g=e.positionScreen.x,v=e.positionScreen.y,T=o.positionScreen.x,y=o.positionScreen.y,ew(g,v,T,y,R=h.positionScreen.x,x=h.positionScreen.y),u instanceof THREE.MeshBasicMaterial?u.map?u.map.mapping instanceof THREE.UVMapping&&e2(g,v,T,y,R,x,(V=p.uvs[0])[_].u,V[_].v,V[E].u,V[E].v,V[f].u,V[f].v,u.map):u.envMap?u.envMap.mapping instanceof THREE.SphericalReflectionMapping&&(e=c.matrixWorldInverse,ex.copy(p.vertexNormalsWorld[0]),z=(ex.x*e.n11+ex.y*e.n12+ex.z*e.n13)*.5+.5,F=-(.5*(ex.x*e.n21+ex.y*e.n22+ex.z*e.n23))+.5,ex.copy(p.vertexNormalsWorld[1]),U=(ex.x*e.n11+ex.y*e.n12+ex.z*e.n13)*.5+.5,k=-(.5*(ex.x*e.n21+ex.y*e.n22+ex.z*e.n23))+.5,ex.copy(p.vertexNormalsWorld[2]),e2(g,v,T,y,R,x,z,F,U,k,B=(ex.x*e.n11+ex.y*e.n12+ex.z*e.n13)*.5+.5,D=-(.5*(ex.x*e.n21+ex.y*e.n22+ex.z*e.n23))+.5,u.envMap)):u.wireframe?eC(u.color,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):eM(u.color):u instanceof THREE.MeshLambertMaterial?(u.map&&!u.wireframe&&(u.map.mapping instanceof THREE.UVMapping&&e2(g,v,T,y,R,x,(V=p.uvs[0])[_].u,V[_].v,V[E].u,V[E].v,V[f].u,V[f].v,u.map),n(THREE.SubtractiveBlending)),eg?u.wireframe||u.shading!=THREE.SmoothShading||3!=p.vertexNormalsWorld.length?(ev.r=eT.r,ev.g=eT.g,ev.b=eT.b,eH(m,p.centroidWorld,p.normalWorld,ev),ec.r=Math.max(0,Math.min(u.color.r*ev.r,1)),ec.g=Math.max(0,Math.min(u.color.g*ev.g,1)),ec.b=Math.max(0,Math.min(u.color.b*ev.b,1)),u.wireframe?eC(ec,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):eM(ec)):(e_.r=eE.r=ef.r=eT.r,e_.g=eE.g=ef.g=eT.g,e_.b=eE.b=ef.b=eT.b,eH(m,p.v1.positionWorld,p.vertexNormalsWorld[0],e_),eH(m,p.v2.positionWorld,p.vertexNormalsWorld[1],eE),eH(m,p.v3.positionWorld,p.vertexNormalsWorld[2],ef),ep.r=(eE.r+ef.r)*.5,ep.g=(eE.g+ef.g)*.5,ep.b=(eE.b+ef.b)*.5,eA(g,v,T,y,R,x,0,0,1,0,0,1,P=eL(e_,eE,ef,ep))):u.wireframe?eC(u.color,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):eM(u.color)):u instanceof THREE.MeshDepthMaterial?(A=c.near,L=c.far,e_.r=e_.g=e_.b=1-eP(e.positionScreen.z,A,L),eE.r=eE.g=eE.b=1-eP(o.positionScreen.z,A,L),ef.r=ef.g=ef.b=1-eP(h.positionScreen.z,A,L),ep.r=(eE.r+ef.r)*.5,ep.g=(eE.g+ef.g)*.5,ep.b=(eE.b+ef.b)*.5,eA(g,v,T,y,R,x,0,0,1,0,0,1,P=eL(e_,eE,ef,ep))):u instanceof THREE.MeshNormalMaterial&&(ec.r=eV(p.normalWorld.x),ec.g=eV(p.normalWorld.y),ec.b=eV(p.normalWorld.z),u.wireframe?eC(ec,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):eM(ec))}function e1(e,o,h,_,E,f,p,u,m){X.data.vertices+=4,X.data.faces++,t(u.opacity),n(u.blending),u.map||u.envMap?(e8(e,o,_,0,1,3,p,u,m),e8(E,h,f,1,2,3,p,u,m)):(g=e.positionScreen.x,v=e.positionScreen.y,T=o.positionScreen.x,y=o.positionScreen.y,R=h.positionScreen.x,x=h.positionScreen.y,H=_.positionScreen.x,b=_.positionScreen.y,w=E.positionScreen.x,S=E.positionScreen.y,C=f.positionScreen.x,M=f.positionScreen.y,u instanceof THREE.MeshBasicMaterial)?(eS(g,v,T,y,R,x,H,b),u.wireframe?eC(u.color,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):eM(u.color)):u instanceof THREE.MeshLambertMaterial?eg?u.wireframe||u.shading!=THREE.SmoothShading||4!=p.vertexNormalsWorld.length?(ev.r=eT.r,ev.g=eT.g,ev.b=eT.b,eH(m,p.centroidWorld,p.normalWorld,ev),ec.r=Math.max(0,Math.min(u.color.r*ev.r,1)),ec.g=Math.max(0,Math.min(u.color.g*ev.g,1)),ec.b=Math.max(0,Math.min(u.color.b*ev.b,1)),eS(g,v,T,y,R,x,H,b),u.wireframe?eC(ec,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):eM(ec)):(e_.r=eE.r=ef.r=ep.r=eT.r,e_.g=eE.g=ef.g=ep.g=eT.g,e_.b=eE.b=ef.b=ep.b=eT.b,eH(m,p.v1.positionWorld,p.vertexNormalsWorld[0],e_),eH(m,p.v2.positionWorld,p.vertexNormalsWorld[1],eE),eH(m,p.v4.positionWorld,p.vertexNormalsWorld[3],ef),eH(m,p.v3.positionWorld,p.vertexNormalsWorld[2],ep),P=eL(e_,eE,ef,ep),ew(g,v,T,y,H,b),eA(g,v,T,y,H,b,0,0,1,0,0,1,P),ew(w,S,R,x,C,M),eA(w,S,R,x,C,M,1,0,1,1,0,1,P)):(eS(g,v,T,y,R,x,H,b),u.wireframe?eC(u.color,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):eM(u.color)):u instanceof THREE.MeshNormalMaterial?(ec.r=eV(p.normalWorld.x),ec.g=eV(p.normalWorld.y),ec.b=eV(p.normalWorld.z),eS(g,v,T,y,R,x,H,b),u.wireframe?eC(ec,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):eM(ec)):u instanceof THREE.MeshDepthMaterial&&(A=c.near,L=c.far,e_.r=e_.g=e_.b=1-eP(e.positionScreen.z,A,L),eE.r=eE.g=eE.b=1-eP(o.positionScreen.z,A,L),ef.r=ef.g=ef.b=1-eP(_.positionScreen.z,A,L),ep.r=ep.g=ep.b=1-eP(h.positionScreen.z,A,L),P=eL(e_,eE,ef,ep),ew(g,v,T,y,H,b),eA(g,v,T,y,H,b,0,0,1,0,0,1,P),ew(w,S,R,x,C,M),eA(w,S,R,x,C,M,1,0,1,1,0,1,P))}function ew(e,t,n,o,h,c){K.beginPath(),K.moveTo(e,t),K.lineTo(n,o),K.lineTo(h,c),K.lineTo(e,t),K.closePath()}function eS(e,t,n,o,h,c,_,E){K.beginPath(),K.moveTo(e,t),K.lineTo(n,o),K.lineTo(h,c),K.lineTo(_,E),K.lineTo(e,t),K.closePath()}function eC(e,t,n,h){eo!=t&&(K.lineWidth=eo=t),ea!=n&&(K.lineCap=ea=n),es!=h&&(K.lineJoin=es=h),o(e.getContextStyle()),K.stroke(),e$.inflate(2*t)}function eM(e){h(e.getContextStyle()),K.fill()}function e2(e,t,n,o,c,_,E,f,p,u,m,$,g){if(0!=g.image.width){if(!0==g.needsUpdate||void 0==eu[g.id]){var v=g.wrapS==THREE.RepeatWrapping,T=g.wrapT==THREE.RepeatWrapping;eu[g.id]=K.createPattern(g.image,v&&T?"repeat":v&&!T?"repeat-x":!v&&T?"repeat-y":"no-repeat"),g.needsUpdate=!1}h(eu[g.id]);var v=g.offset.x/g.repeat.x,T=g.offset.y/g.repeat.y,y=(g.image.width-1)*g.repeat.x,g=(g.image.height-1)*g.repeat.y,E=(E+v)*y,f=(f+T)*g,p=(p+v)*y,u=(u+T)*g,m=(m+v)*y,$=($+T)*g;n-=e,o-=t,c-=e,_-=t,p-=E,u-=f,m-=E,$-=f,v=1/(p*$-m*u),g=($*n-u*c)*v,u=($*o-u*_)*v,n=(p*c-m*n)*v,o=(p*_-m*o)*v,e=e-g*E-n*f,t=t-u*E-o*f,K.save(),K.transform(g,u,n,o,e,t),K.fill(),K.restore()}}function eA(e,t,n,o,h,c,_,E,f,p,u,m,$){var g,v;g=$.width-1,v=$.height-1,_*=g,E*=v,f*=g,p*=v,u*=g,m*=v,n-=e,o-=t,h-=e,c-=t,f-=_,p-=E,u-=_,m-=E,v=1/(f*m-u*p),g=(m*n-p*h)*v,p=(m*o-p*c)*v,n=(f*h-u*n)*v,o=(f*c-u*o)*v,e=e-g*_-n*E,t=t-p*_-o*E,K.save(),K.transform(g,p,n,o,e,t),K.clip(),K.drawImage($,0,0),K.restore()}function eL(e,t,n,o){var h=~~(255*e.r),c=~~(255*e.g),e=~~(255*e.b),_=~~(255*t.r),E=~~(255*t.g),t=~~(255*t.b),f=~~(255*n.r),p=~~(255*n.g),n=~~(255*n.b),u=~~(255*o.r),m=~~(255*o.g),o=~~(255*o.b);return W[0]=h<0?0:h>255?255:h,W[1]=c<0?0:c>255?255:c,W[2]=e<0?0:e>255?255:e,W[4]=_<0?0:_>255?255:_,W[5]=E<0?0:E>255?255:E,W[6]=t<0?0:t>255?255:t,W[8]=f<0?0:f>255?255:f,W[9]=p<0?0:p>255?255:p,W[10]=n<0?0:n>255?255:n,W[12]=u<0?0:u>255?255:u,W[13]=m<0?0:m>255?255:m,W[14]=o<0?0:o>255?255:o,I.putImageData(O,0,0),j.drawImage(N,0,0),G}function eP(e,t,n){return(e=(e-t)/(n-t))*e*(3-2*e)}function eV(e){return(e=(e+1)*.5)<0?0:e>1?1:e}function e3(e,t){var n=t.x-e.x,o=t.y-e.y,h=n*n+o*o;0!=h&&(n*=h=1/Math.sqrt(h),o*=h,t.x+=n,t.y+=o,e.x-=n,e.y-=o)}for(this.autoClear?this.clear():K.setTransform(1,0,0,-1,E,f),X.data.vertices=0,X.data.faces=0,Y=Z.projectScene(e,c,this.sortElements),(eg=e.lights.length>0)&&function e(t){var n,o,h,c=t.lights;for(eT.setRGB(0,0,0),ey.setRGB(0,0,0),eR.setRGB(0,0,0),t=0,n=c.length;t<n;t++)h=(o=c[t]).color,o instanceof THREE.AmbientLight?(eT.r+=h.r,eT.g+=h.g,eT.b+=h.b):o instanceof THREE.DirectionalLight?(ey.r+=h.r,ey.g+=h.g,ey.b+=h.b):o instanceof THREE.PointLight&&(eR.r+=h.r,eR.g+=h.g,eR.b+=h.b)}(e),_=0,Q=Y.length;_<Q;_++){if(J=Y[_],e$.empty(),J instanceof THREE.RenderableParticle)for(p=J,p.x*=E,p.y*=f,ee=0,et=J.materials.length;ee<et;)0!=(en=J.materials[ee++]).opacity&&eb(p,J,en,e);else if(J instanceof THREE.RenderableLine){if(p=J.v1,u=J.v2,p.positionScreen.x*=E,p.positionScreen.y*=f,u.positionScreen.x*=E,u.positionScreen.y*=f,e$.addPoint(p.positionScreen.x,p.positionScreen.y),e$.addPoint(u.positionScreen.x,u.positionScreen.y),ed.instersects(e$))for(ee=0,et=J.materials.length;ee<et;)0!=(en=J.materials[ee++]).opacity&&e0(p,u,J,en,e)}else if(J instanceof THREE.RenderableFace3){if(p=J.v1,u=J.v2,m=J.v3,p.positionScreen.x*=E,p.positionScreen.y*=f,u.positionScreen.x*=E,u.positionScreen.y*=f,m.positionScreen.x*=E,m.positionScreen.y*=f,J.overdraw&&(e3(p.positionScreen,u.positionScreen),e3(u.positionScreen,m.positionScreen),e3(m.positionScreen,p.positionScreen)),e$.add3Points(p.positionScreen.x,p.positionScreen.y,u.positionScreen.x,u.positionScreen.y,m.positionScreen.x,m.positionScreen.y),ed.instersects(e$))for(ee=0,et=J.meshMaterials.length;ee<et;)if((en=J.meshMaterials[ee++])instanceof THREE.MeshFaceMaterial)for(ei=0,er=J.faceMaterials.length;ei<er;)(en=J.faceMaterials[ei++])&&0!=en.opacity&&e8(p,u,m,0,1,2,J,en,e);else 0!=en.opacity&&e8(p,u,m,0,1,2,J,en,e)}else if(J instanceof THREE.RenderableFace4&&(p=J.v1,u=J.v2,m=J.v3,$=J.v4,p.positionScreen.x*=E,p.positionScreen.y*=f,u.positionScreen.x*=E,u.positionScreen.y*=f,m.positionScreen.x*=E,m.positionScreen.y*=f,$.positionScreen.x*=E,$.positionScreen.y*=f,eh.positionScreen.copy(u.positionScreen),el.positionScreen.copy($.positionScreen),J.overdraw&&(e3(p.positionScreen,u.positionScreen),e3(u.positionScreen,$.positionScreen),e3($.positionScreen,p.positionScreen),e3(m.positionScreen,eh.positionScreen),e3(m.positionScreen,el.positionScreen)),e$.addPoint(p.positionScreen.x,p.positionScreen.y),e$.addPoint(u.positionScreen.x,u.positionScreen.y),e$.addPoint(m.positionScreen.x,m.positionScreen.y),e$.addPoint($.positionScreen.x,$.positionScreen.y),ed.instersects(e$)))for(ee=0,et=J.meshMaterials.length;ee<et;)if((en=J.meshMaterials[ee++])instanceof THREE.MeshFaceMaterial)for(ei=0,er=J.faceMaterials.length;ei<er;)(en=J.faceMaterials[ei++])&&0!=en.opacity&&e1(p,u,m,$,eh,el,J,en,e);else 0!=en.opacity&&e1(p,u,m,$,eh,el,J,en,e);em.addRectangle(e$)}K.setTransform(1,0,0,1,0,0)}},THREE.SVGRenderer=function(){function e(e,t,n){var o,h,c,_;for(o=0,h=e.lights.length;o<h;o++)(c=e.lights[o])instanceof THREE.DirectionalLight?(_=t.normalWorld.dot(c.position)*c.intensity)>0&&(n.r+=c.color.r*_,n.g+=c.color.g*_,n.b+=c.color.b*_):c instanceof THREE.PointLight&&(z.sub(c.position,t.centroidWorld),z.normalize(),(_=t.normalWorld.dot(z)*c.intensity)>0&&(n.r+=c.color.r*_,n.g+=c.color.g*_,n.b+=c.color.b*_))}function t(t,n,c,_,E,f){R.data.vertices+=3,R.data.faces++,(v=o(T++)).setAttribute("d","M "+t.positionScreen.x+" "+t.positionScreen.y+" L "+n.positionScreen.x+" "+n.positionScreen.y+" L "+c.positionScreen.x+","+c.positionScreen.y+"z"),E instanceof THREE.MeshBasicMaterial?M.copy(E.color):E instanceof THREE.MeshLambertMaterial?C?(A.r=L.r,A.g=L.g,A.b=L.b,e(f,_,A),M.r=Math.max(0,Math.min(E.color.r*A.r,1)),M.g=Math.max(0,Math.min(E.color.g*A.g,1)),M.b=Math.max(0,Math.min(E.color.b*A.b,1))):M.copy(E.color):E instanceof THREE.MeshDepthMaterial?(g=1-E.__2near/(E.__farPlusNear-_.z*E.__farMinusNear),M.setRGB(g,g,g)):E instanceof THREE.MeshNormalMaterial&&M.setRGB(h(_.normalWorld.x),h(_.normalWorld.y),h(_.normalWorld.z)),E.wireframe?v.setAttribute("style","fill: none; stroke: "+M.getContextStyle()+"; stroke-width: "+E.wireframeLinewidth+"; stroke-opacity: "+E.opacity+"; stroke-linecap: "+E.wireframeLinecap+"; stroke-linejoin: "+E.wireframeLinejoin):v.setAttribute("style","fill: "+M.getContextStyle()+"; fill-opacity: "+E.opacity),b.appendChild(v)}function n(t,n,c,_,E,f,p){R.data.vertices+=4,R.data.faces++,(v=o(T++)).setAttribute("d","M "+t.positionScreen.x+" "+t.positionScreen.y+" L "+n.positionScreen.x+" "+n.positionScreen.y+" L "+c.positionScreen.x+","+c.positionScreen.y+" L "+_.positionScreen.x+","+_.positionScreen.y+"z"),f instanceof THREE.MeshBasicMaterial?M.copy(f.color):f instanceof THREE.MeshLambertMaterial?C?(A.r=L.r,A.g=L.g,A.b=L.b,e(p,E,A),M.r=Math.max(0,Math.min(f.color.r*A.r,1)),M.g=Math.max(0,Math.min(f.color.g*A.g,1)),M.b=Math.max(0,Math.min(f.color.b*A.b,1))):M.copy(f.color):f instanceof THREE.MeshDepthMaterial?(g=1-f.__2near/(f.__farPlusNear-E.z*f.__farMinusNear),M.setRGB(g,g,g)):f instanceof THREE.MeshNormalMaterial&&M.setRGB(h(E.normalWorld.x),h(E.normalWorld.y),h(E.normalWorld.z)),f.wireframe?v.setAttribute("style","fill: none; stroke: "+M.getContextStyle()+"; stroke-width: "+f.wireframeLinewidth+"; stroke-opacity: "+f.opacity+"; stroke-linecap: "+f.wireframeLinecap+"; stroke-linejoin: "+f.wireframeLinejoin):v.setAttribute("style","fill: "+M.getContextStyle()+"; fill-opacity: "+f.opacity),b.appendChild(v)}function o(e){return null==F[e]&&(F[e]=document.createElementNS("http://www.w3.org/2000/svg","path"),0==k&&F[e].setAttribute("shape-rendering","crispEdges")),F[e]}function h(e){return(e=(e+1)*.5)<0?0:e>1?1:e}var c,_,E,f,p,u,m,$,g,v,T,y,R=this,x=null,H=new THREE.Projector,b=document.createElementNS("http://www.w3.org/2000/svg","svg"),w=new THREE.Rectangle,S=new THREE.Rectangle,C=!1,M=new THREE.Color(16777215),A=new THREE.Color(16777215),L=new THREE.Color(0),P=new THREE.Color(0),V=new THREE.Color(0),z=new THREE.Vector3,F=[],U=[],k=1;this.domElement=b,this.sortElements=this.sortObjects=this.autoClear=!0,this.data={vertices:0,faces:0},this.setQuality=function(e){switch(e){case"high":k=1;break;case"low":k=0}},this.setSize=function(e,t){c=e,_=t,E=c/2,f=_/2,b.setAttribute("viewBox",-E+" "+-f+" "+c+" "+_),b.setAttribute("width",c),b.setAttribute("height",_),w.set(-E,-f,E,f)},this.clear=function(){for(;b.childNodes.length>0;)b.removeChild(b.childNodes[0])},this.render=function(e,o){var h,c,_,g,M,A,z,F;if(this.autoClear&&this.clear(),R.data.vertices=0,R.data.faces=0,x=H.projectScene(e,o,this.sortElements),y=T=0,C=e.lights.length>0)for(z=e.lights,L.setRGB(0,0,0),P.setRGB(0,0,0),V.setRGB(0,0,0),h=0,c=z.length;h<c;h++)g=(_=z[h]).color,_ instanceof THREE.AmbientLight?(L.r+=g.r,L.g+=g.g,L.b+=g.b):_ instanceof THREE.DirectionalLight?(P.r+=g.r,P.g+=g.g,P.b+=g.b):_ instanceof THREE.PointLight&&(V.r+=g.r,V.g+=g.g,V.b+=g.b);for(h=0,c=x.length;h<c;h++)if(z=x[h],S.empty(),z instanceof THREE.RenderableParticle)for(p=z,p.x*=E,p.y*=-f,_=0,g=z.materials.length;_<g;)_++;else if(z instanceof THREE.RenderableLine){if(p=z.v1,u=z.v2,p.positionScreen.x*=E,p.positionScreen.y*=-f,u.positionScreen.x*=E,u.positionScreen.y*=-f,S.addPoint(p.positionScreen.x,p.positionScreen.y),S.addPoint(u.positionScreen.x,u.positionScreen.y),w.instersects(S)){for(_=0,g=z.materials.length;_<g;)if((F=z.materials[_++])&&0!=F.opacity){M=p,A=u;var B=y++;null==U[B]&&(U[B]=document.createElementNS("http://www.w3.org/2000/svg","line"),0==k&&U[B].setAttribute("shape-rendering","crispEdges")),(v=U[B]).setAttribute("x1",M.positionScreen.x),v.setAttribute("y1",M.positionScreen.y),v.setAttribute("x2",A.positionScreen.x),v.setAttribute("y2",A.positionScreen.y),F instanceof THREE.LineBasicMaterial&&(v.setAttribute("style","fill: none; stroke: "+F.color.getContextStyle()+"; stroke-width: "+F.linewidth+"; stroke-opacity: "+F.opacity+"; stroke-linecap: "+F.linecap+"; stroke-linejoin: "+F.linejoin),b.appendChild(v))}}}else if(z instanceof THREE.RenderableFace3){if(p=z.v1,u=z.v2,m=z.v3,p.positionScreen.x*=E,p.positionScreen.y*=-f,u.positionScreen.x*=E,u.positionScreen.y*=-f,m.positionScreen.x*=E,m.positionScreen.y*=-f,S.addPoint(p.positionScreen.x,p.positionScreen.y),S.addPoint(u.positionScreen.x,u.positionScreen.y),S.addPoint(m.positionScreen.x,m.positionScreen.y),w.instersects(S))for(_=0,g=z.meshMaterials.length;_<g;)if((F=z.meshMaterials[_++])instanceof THREE.MeshFaceMaterial)for(M=0,A=z.faceMaterials.length;M<A;)(F=z.faceMaterials[M++])&&0!=F.opacity&&t(p,u,m,z,F,e);else F&&0!=F.opacity&&t(p,u,m,z,F,e)}else if(z instanceof THREE.RenderableFace4&&(p=z.v1,u=z.v2,m=z.v3,$=z.v4,p.positionScreen.x*=E,p.positionScreen.y*=-f,u.positionScreen.x*=E,u.positionScreen.y*=-f,m.positionScreen.x*=E,m.positionScreen.y*=-f,$.positionScreen.x*=E,$.positionScreen.y*=-f,S.addPoint(p.positionScreen.x,p.positionScreen.y),S.addPoint(u.positionScreen.x,u.positionScreen.y),S.addPoint(m.positionScreen.x,m.positionScreen.y),S.addPoint($.positionScreen.x,$.positionScreen.y),w.instersects(S)))for(_=0,g=z.meshMaterials.length;_<g;)if((F=z.meshMaterials[_++])instanceof THREE.MeshFaceMaterial)for(M=0,A=z.faceMaterials.length;M<A;)(F=z.faceMaterials[M++])&&0!=F.opacity&&n(p,u,m,$,z,F,e);else F&&0!=F.opacity&&n(p,u,m,$,z,F,e)}},THREE.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform int combine;\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\nvec4 cubeColor = textureCube( envMap, vec3( -vReflect.x, vReflect.yz ) );\nif ( combine == 1 ) {\ngl_FragColor = vec4( mix( gl_FragColor.xyz, cubeColor.xyz, reflectivity ), opacity );\n} else {\ngl_FragColor = gl_FragColor * cubeColor;\n}\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = mat3( objectMatrix[ 0 ].xyz, objectMatrix[ 1 ].xyz, objectMatrix[ 2 ].xyz ) * normal;\nif ( useRefract ) {\nvReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refractionRatio );\n} else {\nvReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );\n}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, gl_PointCoord );\n#endif",map_pars_vertex:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform vec4 offsetRepeat;\n#endif",map_pars_fragment:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif",map_vertex:"#ifdef USE_MAP\nvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",map_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, vUv );\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",lights_pars_vertex:"uniform bool enableLighting;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#ifdef PHONG\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif",lights_vertex:"if ( !enableLighting ) {\nvLightWeighting = vec3( 1.0 );\n} else {\nvLightWeighting = ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ i ] * directionalLightWeighting;\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat pointLightWeighting = max( dot( transformedNormal, lVector ), 0.0 );\nvLightWeighting += pointLightColor[ i ] * pointLightWeighting * lDistance;\n#ifdef PHONG\nvPointLight[ i ] = vec4( lVector, lDistance );\n#endif\n}\n#endif\n}",lights_pars_fragment:"#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\nvec4 mColor = vec4( diffuse, opacity );\nvec4 mSpecular = vec4( specular, opacity );\n#if MAX_POINT_LIGHTS > 0\nvec4 pointDiffuse  = vec4( vec3( 0.0 ), 1.0 );\nvec4 pointSpecular = vec4( vec3( 0.0 ), 1.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec3 pointVector = normalize( vPointLight[ i ].xyz );\nvec3 pointHalfVector = normalize( vPointLight[ i ].xyz + viewPosition );\nfloat pointDistance = vPointLight[ i ].w;\nfloat pointDotNormalHalf = dot( normal, pointHalfVector );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = 0.0;\nif ( pointDotNormalHalf >= 0.0 )\npointSpecularWeight = pow( pointDotNormalHalf, shininess );\npointDiffuse  += mColor * pointDiffuseWeight * pointDistance;\npointSpecular += mSpecular * pointSpecularWeight * pointDistance;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec4 dirDiffuse  = vec4( vec3( 0.0 ), 1.0 );\nvec4 dirSpecular = vec4( vec3( 0.0 ), 1.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + viewPosition );\nfloat dirDotNormalHalf = dot( normal, dirHalfVector );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = 0.0;\nif ( dirDotNormalHalf >= 0.0 )\ndirSpecularWeight = pow( dirDotNormalHalf, shininess );\ndirDiffuse  += mColor * dirDiffuseWeight;\ndirSpecular += mSpecular * dirSpecularWeight;\n}\n#endif\nvec4 totalLight = vec4( ambient, opacity );\n#if MAX_DIR_LIGHTS > 0\ntotalLight += dirDiffuse + dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalLight += pointDiffuse + pointSpecular;\n#endif\ngl_FragColor = gl_FragColor * totalLight;",color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\nvColor = color;\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n#endif",skinning_vertex:"#ifdef USE_SKINNING\ngl_Position  = ( boneGlobalMatrices[ int( skinIndex.x ) ] * skinVertexA ) * skinWeight.x;\ngl_Position += ( boneGlobalMatrices[ int( skinIndex.y ) ] * skinVertexB ) * skinWeight.y;\ngl_Position  = projectionMatrix * viewMatrix * objectMatrix * gl_Position;\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\nuniform float morphTargetInfluences[ 8 ];\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0, 0.0, 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\nmorphed += position;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n#endif",default_vertex:"#ifndef USE_MORPHTARGETS\n#ifndef USE_SKINNING\ngl_Position = projectionMatrix * mvPosition;\n#endif\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\nuniform sampler2D shadowMap[ MAX_SHADOWS ];\nuniform float shadowDarkness;\nuniform float shadowBias;\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\n#endif",shadowmap_fragment:"#ifdef USE_SHADOWMAP\n#ifdef SHADOWMAP_SOFT\nconst float xPixelOffset = 1.0 / SHADOWMAP_WIDTH;\nconst float yPixelOffset = 1.0 / SHADOWMAP_HEIGHT;\n#endif\nvec4 shadowColor = vec4( 1.0 );\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\nif ( shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0 ) {\n#ifdef SHADOWMAP_SOFT\nfloat shadow = 0.0;\nfor ( float y = -1.25; y <= 1.25; y += 1.25 )\nfor ( float x = -1.25; x <= 1.25; x += 1.25 ) {\nvec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\nfloat fDepth = unpackDepth( rgbaDepth );\nif ( fDepth < ( shadowCoord.z + shadowBias ) )\nshadow += 1.0;\n}\nshadow /= 9.0;\nshadowColor = shadowColor * vec4( vec3( ( 1.0 - shadowDarkness * shadow ) ), 1.0 );\n#else\nvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\nfloat fDepth = unpackDepth( rgbaDepth );\nif ( fDepth < ( shadowCoord.z + shadowBias ) )\nshadowColor = shadowColor * vec4( vec3( shadowDarkness ), 1.0 );\n#endif\n}\n}\ngl_FragColor = gl_FragColor * shadowColor;\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvShadowCoord[ i ] = shadowMatrix[ i ] * objectMatrix * vec4( position, 1.0 );\n}\n#endif",alphatest_fragment:"#ifdef ALPHATEST\nif ( gl_FragColor.a < ALPHATEST ) discard;\n#endif"},THREE.UniformsUtils={merge:function(e){var t,n,o,h={};for(t=0;t<e.length;t++)for(n in o=this.clone(e[t]))h[n]=o[n];return h},clone:function(e){var t,n,o,h={};for(t in e)for(n in h[t]={},e[t])o=e[t][n],h[t][n]=o instanceof THREE.Color||o instanceof THREE.Vector2||o instanceof THREE.Vector3||o instanceof THREE.Vector4||o instanceof THREE.Matrix4||o instanceof THREE.Texture?o.clone():o instanceof Array?o.slice():o;return h}},THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:0,texture:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:2,texture:null},envMap:{type:"t",value:1,texture:null},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:0,texture:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:3,texture:[]},shadowMatrix:{type:"m4v",value:[]},shadowBias:{type:"f",value:.0039},shadowDarkness:{type:"f",value:.2}}},THREE.ShaderLib={lensFlareVertexTexture:{vertexShader:"uniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform int renderType;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 UV;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = UV;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.1, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility = (       visibility.r / 9.0 ) *\n( 1.0 - visibility.g / 9.0 ) *\n(       visibility.b / 9.0 ) *\n( 1.0 - visibility.a / 9.0 );\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D map;\nuniform float opacity;\nuniform int renderType;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity * vVisibility;\ngl_FragColor = color;\n}\n}"},lensFlare:{vertexShader:"uniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform int renderType;\nattribute vec2 position;\nattribute vec2 UV;\nvarying vec2 vUV;\nvoid main() {\nvUV = UV;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D map;\nuniform sampler2D occlusionMap;\nuniform float opacity;\nuniform int renderType;\nvarying vec2 vUV;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity * visibility;\ngl_FragColor = color;\n}\n}"},sprite:{vertexShader:"uniform int useScreenCoordinates;\nuniform int affectedByDistance;\nuniform vec3 screenPosition;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 alignment;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position + alignment;\nvec2 rotatedPosition;\nrotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;\nrotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;\nvec4 finalPosition;\nif( useScreenCoordinates != 0 ) {\nfinalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );\n} else {\nfinalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition * ( affectedByDistance == 1 ? 1.0 : finalPosition.z );\n}\ngl_Position = finalPosition;\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D map;\nuniform float opacity;\nvarying vec2 vUV;\nvoid main() {\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity;\ngl_FragColor = color;\n}"},shadowPost:{vertexShader:"uniform mat4 projectionMatrix;\nattribute vec3 position;\nvoid main() {\ngl_Position = projectionMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform float darkness;\nvoid main() {\ngl_FragColor = vec4( 0, 0, 0, darkness );\n}"},shadowVolumeDynamic:{uniforms:{directionalLightDirection:{type:"fv",value:[]}},vertexShader:"uniform vec3 directionalLightDirection;\nvoid main() {\nvec4 pos      = objectMatrix * vec4( position, 1.0 );\nvec3 norm     = mat3( objectMatrix[ 0 ].xyz, objectMatrix[ 1 ].xyz, objectMatrix[ 2 ].xyz ) * normal;\nvec4 extruded = vec4( directionalLightDirection * 5000.0 * step( 0.0, dot( directionalLightDirection, norm ) ), 0.0 );\ngl_Position   = projectionMatrix * viewMatrix * ( pos + extruded );\n}",fragmentShader:"void main() {\ngl_FragColor = vec4( 1.0 );\n}"},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}",vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}",vertexShader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\ngl_Position = projectionMatrix * mvPosition;\n}"},basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.shadowmap]),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap]),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,"gl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["varying vec3 vLightWeighting;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(328965)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30}}]),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 specular;\nuniform float shininess;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.lights_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["#define PHONG\nvarying vec3 vLightWeighting;\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif\nvViewPosition = cameraPosition - mPosition.xyz;\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormal = transformedNormal;",THREE.ShaderChunk.lights_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.particle,THREE.UniformsLib.shadowmap]),fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["uniform float size;\nuniform float scale;",THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n")},depthRGBA:{uniforms:{},fragmentShader:"vec4 pack_depth( const in float depth ) {\nconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\nconst vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\nvec4 res = fract( depth * bit_shift );\nres -= res.xxyz * bit_mask;\nreturn res;\n}\nvoid main() {\ngl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n}",vertexShader:[THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n")}},THREE.WebGLRenderer=function(e){function t(e,t,n){var o,h,c,_,E,f=e.vertices,p=f.length,u=e.colors,m=u.length,$=e.__vertexArray,g=e.__colorArray,v=e.__sortArray,T=e.__dirtyVertices,y=e.__dirtyColors,R=e.__webglCustomAttributes;if(R)for(_ in R)R[_].offset=0;if(n.sortParticles){for(K.multiplySelf(n.matrixWorld),o=0;o<p;o++)h=f[o].position,et.copy(h),K.multiplyVector3(et),v[o]=[et.z,o];for(v.sort(function(e,t){return t[0]-e[0]}),o=0;o<p;o++)h=f[v[o][1]].position,$[c=3*o]=h.x,$[c+1]=h.y,$[c+2]=h.z;for(o=0;o<m;o++)c=3*o,color=u[v[o][1]],g[c]=color.r,g[c+1]=color.g,g[c+2]=color.b;if(R)for(_ in R)for(c=0,u=(o=R[_]).value.length;c<u;c++)index=v[c][1],m=o.offset,1===o.size?(void 0===o.boundTo||"vertices"===o.boundTo)&&(o.array[m]=o.value[index]):((void 0===o.boundTo||"vertices"===o.boundTo)&&(E=o.value[index]),2===o.size?(o.array[m]=E.x,o.array[m+1]=E.y):3===o.size?"c"===o.type?(o.array[m]=E.r,o.array[m+1]=E.g,o.array[m+2]=E.b):(o.array[m]=E.x,o.array[m+1]=E.y,o.array[m+2]=E.z):(o.array[m]=E.x,o.array[m+1]=E.y,o.array[m+2]=E.z,o.array[m+3]=E.w)),o.offset+=o.size}else{if(T)for(o=0;o<p;o++)h=f[o].position,$[c=3*o]=h.x,$[c+1]=h.y,$[c+2]=h.z;if(y)for(o=0;o<m;o++)color=u[o],g[c=3*o]=color.r,g[c+1]=color.g,g[c+2]=color.b;if(R){for(_ in R)if((o=R[_]).__original.needsUpdate)for(c=0,u=o.value.length;c<u;c++)m=o.offset,1===o.size?(void 0===o.boundTo||"vertices"===o.boundTo)&&(o.array[m]=o.value[c]):((void 0===o.boundTo||"vertices"===o.boundTo)&&(E=o.value[c]),2===o.size?(o.array[m]=E.x,o.array[m+1]=E.y):3===o.size?"c"===o.type?(o.array[m]=E.r,o.array[m+1]=E.g,o.array[m+2]=E.b):(o.array[m]=E.x,o.array[m+1]=E.y,o.array[m+2]=E.z):(o.array[m]=E.x,o.array[m+1]=E.y,o.array[m+2]=E.z,o.array[m+3]=E.w)),o.offset+=o.size}}if((T||n.sortParticles)&&(P.bindBuffer(P.ARRAY_BUFFER,e.__webglVertexBuffer),P.bufferData(P.ARRAY_BUFFER,$,t)),(y||n.sortParticles)&&(P.bindBuffer(P.ARRAY_BUFFER,e.__webglColorBuffer),P.bufferData(P.ARRAY_BUFFER,g,t)),R)for(_ in R)((o=R[_]).__original.needsUpdate||n.sortParticles)&&(P.bindBuffer(P.ARRAY_BUFFER,o.buffer),P.bufferData(P.ARRAY_BUFFER,o.array,t))}function n(e,t,n,o,h){if(o.program||V.initMaterial(o,t,n,h),o.morphTargets&&!h.__webglMorphTargetInfluences){h.__webglMorphTargetInfluences=new Float32Array(V.maxMorphTargets);for(var c=0,_=V.maxMorphTargets;c<_;c++)h.__webglMorphTargetInfluences[c]=0}var c=o.program,_=c.uniforms,E=o.uniforms;if(c!=F&&(P.useProgram(c),F=c),P.uniformMatrix4fv(_.projectionMatrix,!1,J),n&&(o instanceof THREE.MeshBasicMaterial||o instanceof THREE.MeshLambertMaterial||o instanceof THREE.MeshPhongMaterial||o instanceof THREE.LineBasicMaterial||o instanceof THREE.ParticleBasicMaterial||o.fog)&&((E.fogColor.value=n.color,n instanceof THREE.Fog)?(E.fogNear.value=n.near,E.fogFar.value=n.far):n instanceof THREE.FogExp2&&(E.fogDensity.value=n.density)),o instanceof THREE.MeshPhongMaterial||o instanceof THREE.MeshLambertMaterial||o.lights){var f,p,u,m,$,g,v=0,T=0,y=0,R=ei,x=R.directional.colors,H=R.directional.positions,b=R.point.colors,C=R.point.positions,M=R.point.distances,A=0,L=0,n=p=g=0;for(f=t.length;n<f;n++)(u=(p=t[n]).color,m=p.position,$=p.intensity,g=p.distance,p instanceof THREE.AmbientLight)?(v+=u.r,T+=u.g,y+=u.b):p instanceof THREE.DirectionalLight?(x[g=3*A]=u.r*$,x[g+1]=u.g*$,x[g+2]=u.b*$,H[g]=m.x,H[g+1]=m.y,H[g+2]=m.z,A+=1):p instanceof THREE.SpotLight?(x[g=3*A]=u.r*$,x[g+1]=u.g*$,x[g+2]=u.b*$,u=1/m.length(),H[g]=m.x*u,H[g+1]=m.y*u,H[g+2]=m.z*u,A+=1):p instanceof THREE.PointLight&&(b[p=3*L]=u.r*$,b[p+1]=u.g*$,b[p+2]=u.b*$,C[p]=m.x,C[p+1]=m.y,C[p+2]=m.z,M[L]=g,L+=1);for(n=3*A;n<x.length;n++)x[n]=0;for(n=3*L;n<b.length;n++)b[n]=0;R.point.length=L,R.directional.length=A,R.ambient[0]=v,R.ambient[1]=T,R.ambient[2]=y,t=ei,E.enableLighting.value=t.directional.length+t.point.length,E.ambientLightColor.value=t.ambient,E.directionalLightColor.value=t.directional.colors,E.directionalLightDirection.value=t.directional.positions,E.pointLightColor.value=t.point.colors,E.pointLightPosition.value=t.point.positions,E.pointLightDistance.value=t.point.distances}if((o instanceof THREE.MeshBasicMaterial||o instanceof THREE.MeshLambertMaterial||o instanceof THREE.MeshPhongMaterial)&&(E.diffuse.value=o.color,E.opacity.value=o.opacity,(E.map.texture=o.map)&&E.offsetRepeat.value.set(o.map.offset.x,o.map.offset.y,o.map.repeat.x,o.map.repeat.y),E.lightMap.texture=o.lightMap,E.envMap.texture=o.envMap,E.reflectivity.value=o.reflectivity,E.refractionRatio.value=o.refractionRatio,E.combine.value=o.combine,E.useRefract.value=o.envMap&&o.envMap.mapping instanceof THREE.CubeRefractionMapping),o instanceof THREE.LineBasicMaterial?(E.diffuse.value=o.color,E.opacity.value=o.opacity):o instanceof THREE.ParticleBasicMaterial?(E.psColor.value=o.color,E.opacity.value=o.opacity,E.size.value=o.size,E.scale.value=er.height/2,E.map.texture=o.map):o instanceof THREE.MeshPhongMaterial?(E.ambient.value=o.ambient,E.specular.value=o.specular,E.shininess.value=o.shininess):o instanceof THREE.MeshDepthMaterial?(E.mNear.value=e.near,E.mFar.value=e.far,E.opacity.value=o.opacity):o instanceof THREE.MeshNormalMaterial&&(E.opacity.value=o.opacity),h.receiveShadow&&!o._shadowPass&&E.shadowMatrix){for(t=0;t<ec.length;t++)E.shadowMatrix.value[t]=ec[t],E.shadowMap.texture[t]=V.shadowMap[t];E.shadowDarkness.value=V.shadowMapDarkness,E.shadowBias.value=V.shadowMapBias}for(var z in E)if(f=c.uniforms[z]){if(v=(n=E[z]).type,t=n.value,"i"==v)P.uniform1i(f,t);else if("f"==v)P.uniform1f(f,t);else if("fv1"==v)P.uniform1fv(f,t);else if("fv"==v)P.uniform3fv(f,t);else if("v2"==v)P.uniform2f(f,t.x,t.y);else if("v3"==v)P.uniform3f(f,t.x,t.y,t.z);else if("v4"==v)P.uniform4f(f,t.x,t.y,t.z,t.w);else if("m4"==v)n._array||(n._array=new Float32Array(16)),t.flattenToArray(n._array),P.uniformMatrix4fv(f,!1,n._array);else if("m4v"==v){for(n._array||(n._array=new Float32Array(16*t.length)),v=0,T=t.length;v<T;v++)t[v].flattenToArrayOffset(n._array,16*v);P.uniformMatrix4fv(f,!1,n._array)}else if("c"==v)P.uniform3f(f,t.r,t.g,t.b);else if("t"==v){if(P.uniform1i(f,t),f=n.texture){if(f.image instanceof Array&&6==f.image.length){if(6==(n=f).image.length){if(n.needsUpdate){if(n.__webglInit)for(P.bindTexture(P.TEXTURE_CUBE_MAP,n.image.__webglTextureCube),f=0;f<6;++f)P.texSubImage2D(P.TEXTURE_CUBE_MAP_POSITIVE_X+f,0,0,0,P.RGBA,P.UNSIGNED_BYTE,n.image[f]);else{for(n.image.__webglTextureCube=P.createTexture(),P.bindTexture(P.TEXTURE_CUBE_MAP,n.image.__webglTextureCube),f=0;f<6;++f)P.texImage2D(P.TEXTURE_CUBE_MAP_POSITIVE_X+f,0,P.RGBA,P.RGBA,P.UNSIGNED_BYTE,n.image[f]);n.__webglInit=!0}w(P.TEXTURE_CUBE_MAP,n,n.image[0]),P.bindTexture(P.TEXTURE_CUBE_MAP,null),n.needsUpdate=!1}P.activeTexture(P.TEXTURE0+t),P.bindTexture(P.TEXTURE_CUBE_MAP,n.image.__webglTextureCube)}}else S(f,t)}}else if("tv"==v){if(!n._array)for(n._array=[],v=0,T=n.texture.length;v<T;v++)n._array[v]=t+v;for(P.uniform1iv(f,n._array),v=0,T=n.texture.length;v<T;v++)(f=n.texture[v])&&S(f,n._array[v])}}return P.uniformMatrix4fv(_.modelViewMatrix,!1,h._modelViewMatrixArray),P.uniformMatrix3fv(_.normalMatrix,!1,h._normalMatrixArray),(o instanceof THREE.MeshShaderMaterial||o instanceof THREE.MeshPhongMaterial||o.envMap)&&null!==_.cameraPosition&&P.uniform3f(_.cameraPosition,e.position.x,e.position.y,e.position.z),(o instanceof THREE.MeshShaderMaterial||o.envMap||o.skinning||h.receiveShadow)&&null!==_.objectMatrix&&P.uniformMatrix4fv(_.objectMatrix,!1,h._objectMatrixArray),(o instanceof THREE.MeshPhongMaterial||o instanceof THREE.MeshLambertMaterial||o instanceof THREE.MeshShaderMaterial||o.skinning)&&null!==_.viewMatrix&&P.uniformMatrix4fv(_.viewMatrix,!1,ee),o.skinning&&(P.uniformMatrix4fv(_.cameraInverseMatrix,!1,ee),P.uniformMatrix4fv(_.boneGlobalMatrices,!1,h.boneMatrices)),c}function o(e,t,o,h,c,_){if(0!=h.opacity){var E,e=n(e,t,o,h,_).attributes;if(!h.morphTargets&&e.position>=0)P.bindBuffer(P.ARRAY_BUFFER,c.__webglVertexBuffer),P.vertexAttribPointer(e.position,3,P.FLOAT,!1,0,0);else if(_.morphTargetBase){if(t=h.program.attributes,-1!==_.morphTargetBase?(P.bindBuffer(P.ARRAY_BUFFER,c.__webglMorphTargetsBuffers[_.morphTargetBase]),P.vertexAttribPointer(t.position,3,P.FLOAT,!1,0,0)):t.position>=0&&(P.bindBuffer(P.ARRAY_BUFFER,c.__webglVertexBuffer),P.vertexAttribPointer(t.position,3,P.FLOAT,!1,0,0)),_.morphTargetForcedOrder.length)for(var o=0,f=_.morphTargetForcedOrder,p=_.morphTargetInfluences;o<h.numSupportedMorphTargets&&o<f.length;)P.bindBuffer(P.ARRAY_BUFFER,c.__webglMorphTargetsBuffers[f[o]]),P.vertexAttribPointer(t["morphTarget"+o],3,P.FLOAT,!1,0,0),_.__webglMorphTargetInfluences[o]=p[f[o]],o++;else{var u,f=[],m=-1,$=0,p=_.morphTargetInfluences,g=p.length,o=0;for(-1!==_.morphTargetBase&&(f[_.morphTargetBase]=!0);o<h.numSupportedMorphTargets;){for(u=0;u<g;u++)!f[u]&&p[u]>m&&(m=p[$=u]);P.bindBuffer(P.ARRAY_BUFFER,c.__webglMorphTargetsBuffers[$]),P.vertexAttribPointer(t["morphTarget"+o],3,P.FLOAT,!1,0,0),_.__webglMorphTargetInfluences[o]=m,f[$]=1,m=-1,o++}}null!==h.program.uniforms.morphTargetInfluences&&P.uniform1fv(h.program.uniforms.morphTargetInfluences,_.__webglMorphTargetInfluences)}if(c.__webglCustomAttributes)for(E in c.__webglCustomAttributes)e[E]>=0&&(t=c.__webglCustomAttributes[E],P.bindBuffer(P.ARRAY_BUFFER,t.buffer),P.vertexAttribPointer(e[E],t.size,P.FLOAT,!1,0,0));e.color>=0&&(P.bindBuffer(P.ARRAY_BUFFER,c.__webglColorBuffer),P.vertexAttribPointer(e.color,3,P.FLOAT,!1,0,0)),e.normal>=0&&(P.bindBuffer(P.ARRAY_BUFFER,c.__webglNormalBuffer),P.vertexAttribPointer(e.normal,3,P.FLOAT,!1,0,0)),e.tangent>=0&&(P.bindBuffer(P.ARRAY_BUFFER,c.__webglTangentBuffer),P.vertexAttribPointer(e.tangent,4,P.FLOAT,!1,0,0)),e.uv>=0&&(c.__webglUVBuffer?(P.bindBuffer(P.ARRAY_BUFFER,c.__webglUVBuffer),P.vertexAttribPointer(e.uv,2,P.FLOAT,!1,0,0),P.enableVertexAttribArray(e.uv)):P.disableVertexAttribArray(e.uv)),e.uv2>=0&&(c.__webglUV2Buffer?(P.bindBuffer(P.ARRAY_BUFFER,c.__webglUV2Buffer),P.vertexAttribPointer(e.uv2,2,P.FLOAT,!1,0,0),P.enableVertexAttribArray(e.uv2)):P.disableVertexAttribArray(e.uv2)),h.skinning&&e.skinVertexA>=0&&e.skinVertexB>=0&&e.skinIndex>=0&&e.skinWeight>=0&&(P.bindBuffer(P.ARRAY_BUFFER,c.__webglSkinVertexABuffer),P.vertexAttribPointer(e.skinVertexA,4,P.FLOAT,!1,0,0),P.bindBuffer(P.ARRAY_BUFFER,c.__webglSkinVertexBBuffer),P.vertexAttribPointer(e.skinVertexB,4,P.FLOAT,!1,0,0),P.bindBuffer(P.ARRAY_BUFFER,c.__webglSkinIndicesBuffer),P.vertexAttribPointer(e.skinIndex,4,P.FLOAT,!1,0,0),P.bindBuffer(P.ARRAY_BUFFER,c.__webglSkinWeightsBuffer),P.vertexAttribPointer(e.skinWeight,4,P.FLOAT,!1,0,0)),_ instanceof THREE.Mesh?(h.wireframe?(P.lineWidth(h.wireframeLinewidth),P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,c.__webglLineBuffer),P.drawElements(P.LINES,c.__webglLineCount,P.UNSIGNED_SHORT,0)):(P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,c.__webglFaceBuffer),P.drawElements(P.TRIANGLES,c.__webglFaceCount,P.UNSIGNED_SHORT,0)),V.data.vertices+=c.__webglFaceCount,V.data.faces+=c.__webglFaceCount/3,V.data.drawCalls++):_ instanceof THREE.Line?(_=_.type==THREE.LineStrip?P.LINE_STRIP:P.LINES,P.lineWidth(h.linewidth),P.drawArrays(_,0,c.__webglLineCount),V.data.drawCalls++):_ instanceof THREE.ParticleSystem?(P.drawArrays(P.POINTS,0,c.__webglParticleCount),V.data.drawCalls++):_ instanceof THREE.Ribbon&&(P.drawArrays(P.TRIANGLE_STRIP,0,c.__webglVertexCount),V.data.drawCalls++)}}function h(e,t,n){if(e.__webglVertexBuffer||(e.__webglVertexBuffer=P.createBuffer()),e.__webglNormalBuffer||(e.__webglNormalBuffer=P.createBuffer()),e.hasPos&&(P.bindBuffer(P.ARRAY_BUFFER,e.__webglVertexBuffer),P.bufferData(P.ARRAY_BUFFER,e.positionArray,P.DYNAMIC_DRAW),P.enableVertexAttribArray(t.attributes.position),P.vertexAttribPointer(t.attributes.position,3,P.FLOAT,!1,0,0)),e.hasNormal){if(P.bindBuffer(P.ARRAY_BUFFER,e.__webglNormalBuffer),n==THREE.FlatShading){var o,h,c,_,E,f,p,u,m,$,g=3*e.count;for($=0;$<g;$+=9)o=(n=e.normalArray)[$],h=n[$+1],c=n[$+2],_=n[$+3],f=n[$+4],u=n[$+5],E=n[$+6],p=n[$+7],m=n[$+8],o=(o+_+E)/3,h=(h+f+p)/3,c=(c+u+m)/3,n[$]=o,n[$+1]=h,n[$+2]=c,n[$+3]=o,n[$+4]=h,n[$+5]=c,n[$+6]=o,n[$+7]=h,n[$+8]=c}P.bufferData(P.ARRAY_BUFFER,e.normalArray,P.DYNAMIC_DRAW),P.enableVertexAttribArray(t.attributes.normal),P.vertexAttribPointer(t.attributes.normal,3,P.FLOAT,!1,0,0)}P.drawArrays(P.TRIANGLES,0,e.count),e.count=0}function c(e){B!=e.doubleSided&&(e.doubleSided?P.disable(P.CULL_FACE):P.enable(P.CULL_FACE),B=e.doubleSided),D!=e.flipSided&&(e.flipSided?P.frontFace(P.CW):P.frontFace(P.CCW),D=e.flipSided)}function _(e){I!=e&&(e?P.enable(P.DEPTH_TEST):P.disable(P.DEPTH_TEST),I=e)}function E(e,t,n){O!=e&&(e?P.enable(P.POLYGON_OFFSET_FILL):P.disable(P.POLYGON_OFFSET_FILL),O=e),e&&(W!=t||G!=n)&&(P.polygonOffset(t,n),W=t,G=n)}function f(e){Q[0].set(e.n41-e.n11,e.n42-e.n12,e.n43-e.n13,e.n44-e.n14),Q[1].set(e.n41+e.n11,e.n42+e.n12,e.n43+e.n13,e.n44+e.n14),Q[2].set(e.n41+e.n21,e.n42+e.n22,e.n43+e.n23,e.n44+e.n24),Q[3].set(e.n41-e.n21,e.n42-e.n22,e.n43-e.n23,e.n44-e.n24),Q[4].set(e.n41-e.n31,e.n42-e.n32,e.n43-e.n33,e.n44-e.n34),Q[5].set(e.n41+e.n31,e.n42+e.n32,e.n43+e.n33,e.n44+e.n34);for(var t,e=0;e<6;e++)(t=Q[e]).divideScalar(Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z))}function p(e){for(var t=e.matrixWorld,n=-e.geometry.boundingSphere.radius*Math.max(e.scale.x,Math.max(e.scale.y,e.scale.z)),o=0;o<6;o++)if((e=Q[o].x*t.n14+Q[o].y*t.n24+Q[o].z*t.n34+Q[o].w)<=n)return!1;return!0}function u(e,t){e.list[e.count]=t,e.count+=1}function m(e){var t,n,o=e.object,h=e.opaque,c=e.transparent;for(c.count=0,e=h.count=0,t=o.materials.length;e<t;e++)(n=o.materials[e]).transparent?u(c,n):u(h,n)}function $(e){var t,n,o,h,c=e.object,_=e.buffer,E=e.opaque,f=e.transparent;for(f.count=0,e=E.count=0,o=c.materials.length;e<o;e++)if((t=c.materials[e])instanceof THREE.MeshFaceMaterial)for(t=0,n=_.materials.length;t<n;t++)(h=_.materials[t])&&(h.transparent?u(f,h):u(E,h));else(h=t)&&(h.transparent?u(f,h):u(E,h))}function g(e,t){return t.z-e.z}function v(e,t,n){e._modelViewMatrix.multiplyToArray(t.matrixWorldInverse,e.matrixWorld,e._modelViewMatrixArray),n&&THREE.Matrix4.makeInvert3x3(e._modelViewMatrix).transposeIntoArray(e._normalMatrixArray)}function T(e){var t,n,o,h;for(h=e.__materials,e=0,n=h.length;e<n;e++)if((o=h[e]).attributes){for(t in o.attributes)if(o.attributes[t].needsUpdate)return!0}return!1}function y(e){var t,n,o,h;for(h=e.__materials,e=0,n=h.length;e<n;e++)if((o=h[e]).attributes)for(t in o.attributes)o.attributes[t].needsUpdate=!1}function R(e,t){var n;for(n=e.length-1;n>=0;n--)e[n].object==t&&e.splice(n,1)}function x(e){function t(e){var t=[];for(n=0,o=e.length;n<o;n++)void 0==e[n]?t.push("undefined"):t.push(e[n].id);return t.join("_")}var n,o,h,c,_,E,f,p,u={},m=void 0!==e.morphTargets?e.morphTargets.length:0;for(e.geometryGroups={},h=0,c=e.faces.length;h<c;h++)void 0==u[f=t(E=(_=e.faces[h]).materials)]&&(u[f]={hash:f,counter:0}),p=u[f].hash+"_"+u[f].counter,void 0==e.geometryGroups[p]&&(e.geometryGroups[p]={faces:[],materials:E,vertices:0,numMorphTargets:m}),_=_ instanceof THREE.Face3?3:4,e.geometryGroups[p].vertices+_>65535&&(u[f].counter+=1,p=u[f].hash+"_"+u[f].counter,void 0==e.geometryGroups[p]&&(e.geometryGroups[p]={faces:[],materials:E,vertices:0,numMorphTargets:m})),e.geometryGroups[p].faces.push(h),e.geometryGroups[p].vertices+=_}function H(e,t,n){e.push({buffer:t,object:n,opaque:{list:[],count:0},transparent:{list:[],count:0}})}function b(e){if(e!=N){switch(e){case THREE.AdditiveBlending:P.blendEquation(P.FUNC_ADD),P.blendFunc(P.SRC_ALPHA,P.ONE);break;case THREE.SubtractiveBlending:P.blendEquation(P.FUNC_ADD),P.blendFunc(P.ZERO,P.ONE_MINUS_SRC_COLOR);break;case THREE.MultiplyBlending:P.blendEquation(P.FUNC_ADD),P.blendFunc(P.ZERO,P.SRC_COLOR);break;default:P.blendEquationSeparate(P.FUNC_ADD,P.FUNC_ADD),P.blendFuncSeparate(P.SRC_ALPHA,P.ONE_MINUS_SRC_ALPHA,P.ONE,P.ONE_MINUS_SRC_ALPHA)}N=e}}function w(e,t,n){(n.width&n.width-1)==0&&(n.height&n.height-1)==0?(P.texParameteri(e,P.TEXTURE_WRAP_S,L(t.wrapS)),P.texParameteri(e,P.TEXTURE_WRAP_T,L(t.wrapT)),P.texParameteri(e,P.TEXTURE_MAG_FILTER,L(t.magFilter)),P.texParameteri(e,P.TEXTURE_MIN_FILTER,L(t.minFilter)),P.generateMipmap(e)):(P.texParameteri(e,P.TEXTURE_WRAP_S,P.CLAMP_TO_EDGE),P.texParameteri(e,P.TEXTURE_WRAP_T,P.CLAMP_TO_EDGE),P.texParameteri(e,P.TEXTURE_MAG_FILTER,A(t.magFilter)),P.texParameteri(e,P.TEXTURE_MIN_FILTER,A(t.minFilter)))}function S(e,t){e.needsUpdate&&(e.__webglInit||(e.__webglTexture=P.createTexture(),e.__webglInit=!0),P.bindTexture(P.TEXTURE_2D,e.__webglTexture),e.image.data?P.texImage2D(P.TEXTURE_2D,0,L(e.format),e.image.width,e.image.height,0,L(e.format),P.UNSIGNED_BYTE,e.image.data):P.texImage2D(P.TEXTURE_2D,0,P.RGBA,P.RGBA,P.UNSIGNED_BYTE,e.image),w(P.TEXTURE_2D,e,e.image),P.bindTexture(P.TEXTURE_2D,null),e.needsUpdate=!1),P.activeTexture(P.TEXTURE0+t),P.bindTexture(P.TEXTURE_2D,e.__webglTexture)}function C(e){var t,n;e&&!e.__webglFramebuffer&&(void 0===e.depthBuffer&&(e.depthBuffer=!0),void 0===e.stencilBuffer&&(e.stencilBuffer=!0),e.__webglFramebuffer=P.createFramebuffer(),e.__webglRenderbuffer=P.createRenderbuffer(),e.__webglTexture=P.createTexture(),P.bindTexture(P.TEXTURE_2D,e.__webglTexture),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_WRAP_S,L(e.wrapS)),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_WRAP_T,L(e.wrapT)),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_MAG_FILTER,L(e.magFilter)),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_MIN_FILTER,L(e.minFilter)),P.texImage2D(P.TEXTURE_2D,0,L(e.format),e.width,e.height,0,L(e.format),L(e.type),null),P.bindRenderbuffer(P.RENDERBUFFER,e.__webglRenderbuffer),P.bindFramebuffer(P.FRAMEBUFFER,e.__webglFramebuffer),P.framebufferTexture2D(P.FRAMEBUFFER,P.COLOR_ATTACHMENT0,P.TEXTURE_2D,e.__webglTexture,0),e.depthBuffer&&!e.stencilBuffer?(P.renderbufferStorage(P.RENDERBUFFER,P.DEPTH_COMPONENT16,e.width,e.height),P.framebufferRenderbuffer(P.FRAMEBUFFER,P.DEPTH_ATTACHMENT,P.RENDERBUFFER,e.__webglRenderbuffer)):e.depthBuffer&&e.stencilBuffer?(P.renderbufferStorage(P.RENDERBUFFER,P.DEPTH_STENCIL,e.width,e.height),P.framebufferRenderbuffer(P.FRAMEBUFFER,P.DEPTH_STENCIL_ATTACHMENT,P.RENDERBUFFER,e.__webglRenderbuffer)):P.renderbufferStorage(P.RENDERBUFFER,P.RGBA4,e.width,e.height),P.bindTexture(P.TEXTURE_2D,null),P.bindRenderbuffer(P.RENDERBUFFER,null),P.bindFramebuffer(P.FRAMEBUFFER,null)),e?(t=e.__webglFramebuffer,n=e.width,e=e.height):(t=null,n=Y,e=Z),t!=U&&(P.bindFramebuffer(P.FRAMEBUFFER,t),P.viewport(j,X,n,e),U=t)}function M(e,t){var n;return("fragment"==e?n=P.createShader(P.FRAGMENT_SHADER):"vertex"==e&&(n=P.createShader(P.VERTEX_SHADER)),P.shaderSource(n,t),P.compileShader(n),P.getShaderParameter(n,P.COMPILE_STATUS))?n:(console.error(P.getShaderInfoLog(n)),console.error(t),null)}function A(e){switch(e){case THREE.NearestFilter:case THREE.NearestMipMapNearestFilter:case THREE.NearestMipMapLinearFilter:return P.NEAREST;default:return P.LINEAR}}function L(e){switch(e){case THREE.RepeatWrapping:return P.REPEAT;case THREE.ClampToEdgeWrapping:return P.CLAMP_TO_EDGE;case THREE.MirroredRepeatWrapping:return P.MIRRORED_REPEAT;case THREE.NearestFilter:return P.NEAREST;case THREE.NearestMipMapNearestFilter:return P.NEAREST_MIPMAP_NEAREST;case THREE.NearestMipMapLinearFilter:return P.NEAREST_MIPMAP_LINEAR;case THREE.LinearFilter:return P.LINEAR;case THREE.LinearMipMapNearestFilter:return P.LINEAR_MIPMAP_NEAREST;case THREE.LinearMipMapLinearFilter:return P.LINEAR_MIPMAP_LINEAR;case THREE.ByteType:return P.BYTE;case THREE.UnsignedByteType:return P.UNSIGNED_BYTE;case THREE.ShortType:return P.SHORT;case THREE.UnsignedShortType:return P.UNSIGNED_SHORT;case THREE.IntType:return P.INT;case THREE.UnsignedShortType:return P.UNSIGNED_INT;case THREE.FloatType:return P.FLOAT;case THREE.AlphaFormat:return P.ALPHA;case THREE.RGBFormat:return P.RGB;case THREE.RGBAFormat:return P.RGBA;case THREE.LuminanceFormat:return P.LUMINANCE;case THREE.LuminanceAlphaFormat:return P.LUMINANCE_ALPHA}return 0}var P,V=this,z=[],F=null,U=null,k=!0,B=null,D=null,N=null,I=null,O=null,W=null,G=null,j=0,X=0,Y=0,Z=0,Q=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],K=new THREE.Matrix4,J=new Float32Array(16),ee=new Float32Array(16),et=new THREE.Vector4,ei={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]}},e=e||{},er=void 0!==e.canvas?e.canvas:document.createElement("canvas"),en=void 0===e.stencil||e.stencil,eo=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,ea=void 0!==e.antialias&&e.antialias,es=new THREE.Color(void 0!==e.clearColor?e.clearColor:0),eh=void 0!==e.clearAlpha?e.clearAlpha:0;this.data={vertices:0,faces:0,drawCalls:0},this.maxMorphTargets=8,this.domElement=er,this.sortObjects=this.autoClear=!0,this.shadowMapBias=.0039,this.shadowMapDarkness=.5,this.shadowMapHeight=this.shadowMapWidth=512,this.shadowCameraNear=1,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowMap=[],this.shadowMapEnabled=!1,this.shadowMapSoft=!0;var el,ec=[],e=THREE.ShaderLib.depthRGBA,e_=THREE.UniformsUtils.clone(e.uniforms),eE=new THREE.MeshShaderMaterial({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:e_}),ef=new THREE.MeshShaderMaterial({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:e_,morphTargets:!0});eE._shadowPass=!0,ef._shadowPass=!0;try{if(!(P=er.getContext("experimental-webgl",{antialias:ea,stencil:en,preserveDrawingBuffer:eo})))throw"Error creating WebGL context.";console.log(navigator.userAgent+" | "+P.getParameter(P.VERSION)+" | "+P.getParameter(P.VENDOR)+" | "+P.getParameter(P.RENDERER)+" | "+P.getParameter(P.SHADING_LANGUAGE_VERSION))}catch(ep){console.error(ep)}P.clearColor(0,0,0,1),P.clearDepth(1),P.enable(P.DEPTH_TEST),P.depthFunc(P.LEQUAL),P.frontFace(P.CCW),P.cullFace(P.BACK),P.enable(P.CULL_FACE),P.enable(P.BLEND),P.blendEquation(P.FUNC_ADD),P.blendFunc(P.SRC_ALPHA,P.ONE_MINUS_SRC_ALPHA),P.clearColor(es.r,es.g,es.b,eh),this.context=P;var eu=P.getParameter(P.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0,ed={};ed.vertices=new Float32Array(16),ed.faces=new Uint16Array(6),i=0,ed.vertices[i++]=-1,ed.vertices[i++]=-1,ed.vertices[i++]=0,ed.vertices[i++]=1,ed.vertices[i++]=1,ed.vertices[i++]=-1,ed.vertices[i++]=1,ed.vertices[i++]=1,ed.vertices[i++]=1,ed.vertices[i++]=1,ed.vertices[i++]=1,ed.vertices[i++]=0,ed.vertices[i++]=-1,ed.vertices[i++]=1,ed.vertices[i++]=0,i=ed.vertices[i++]=0,ed.faces[i++]=0,ed.faces[i++]=1,ed.faces[i++]=2,ed.faces[i++]=0,ed.faces[i++]=2,ed.faces[i++]=3,ed.vertexBuffer=P.createBuffer(),ed.elementBuffer=P.createBuffer(),P.bindBuffer(P.ARRAY_BUFFER,ed.vertexBuffer),P.bufferData(P.ARRAY_BUFFER,ed.vertices,P.STATIC_DRAW),P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,ed.elementBuffer),P.bufferData(P.ELEMENT_ARRAY_BUFFER,ed.faces,P.STATIC_DRAW),ed.program=P.createProgram(),P.attachShader(ed.program,M("fragment",THREE.ShaderLib.sprite.fragmentShader)),P.attachShader(ed.program,M("vertex",THREE.ShaderLib.sprite.vertexShader)),P.linkProgram(ed.program),ed.attributes={},ed.uniforms={},ed.attributes.position=P.getAttribLocation(ed.program,"position"),ed.attributes.uv=P.getAttribLocation(ed.program,"uv"),ed.uniforms.uvOffset=P.getUniformLocation(ed.program,"uvOffset"),ed.uniforms.uvScale=P.getUniformLocation(ed.program,"uvScale"),ed.uniforms.rotation=P.getUniformLocation(ed.program,"rotation"),ed.uniforms.scale=P.getUniformLocation(ed.program,"scale"),ed.uniforms.alignment=P.getUniformLocation(ed.program,"alignment"),ed.uniforms.map=P.getUniformLocation(ed.program,"map"),ed.uniforms.opacity=P.getUniformLocation(ed.program,"opacity"),ed.uniforms.useScreenCoordinates=P.getUniformLocation(ed.program,"useScreenCoordinates"),ed.uniforms.affectedByDistance=P.getUniformLocation(ed.program,"affectedByDistance"),ed.uniforms.screenPosition=P.getUniformLocation(ed.program,"screenPosition"),ed.uniforms.modelViewMatrix=P.getUniformLocation(ed.program,"modelViewMatrix"),ed.uniforms.projectionMatrix=P.getUniformLocation(ed.program,"projectionMatrix");var em=!1;this.setSize=function(e,t){er.width=e,er.height=t,this.setViewport(0,0,er.width,er.height)},this.setViewport=function(e,t,n,o){j=e,X=t,Y=n,Z=o,P.viewport(j,X,Y,Z)},this.setScissor=function(e,t,n,o){P.scissor(e,t,n,o)},this.enableScissorTest=function(e){e?P.enable(P.SCISSOR_TEST):P.disable(P.SCISSOR_TEST)},this.enableDepthBufferWrite=function(e){k=e,P.depthMask(e)},this.setClearColorHex=function(e,t){es.setHex(e),eh=t,P.clearColor(es.r,es.g,es.b,eh)},this.setClearColor=function(e,t){es.copy(e),eh=t,P.clearColor(es.r,es.g,es.b,eh)},this.clear=function(){P.clear(P.COLOR_BUFFER_BIT|P.DEPTH_BUFFER_BIT|P.STENCIL_BUFFER_BIT)},this.getContext=function(){return P},this.initMaterial=function(e,t,n,o){if(e instanceof THREE.MeshDepthMaterial?f="depth":e instanceof THREE.MeshNormalMaterial?f="normal":e instanceof THREE.MeshBasicMaterial?f="basic":e instanceof THREE.MeshLambertMaterial?f="lambert":e instanceof THREE.MeshPhongMaterial?f="phong":e instanceof THREE.LineBasicMaterial?f="basic":e instanceof THREE.ParticleBasicMaterial&&(f="particle_basic"),f){var h=THREE.ShaderLib[f];e.uniforms=THREE.UniformsUtils.clone(h.uniforms),e.vertexShader=h.vertexShader,e.fragmentShader=h.fragmentShader}for(p=m=h=0,u=t.length;p<u;p++)(E=t[p])instanceof THREE.SpotLight&&m++,E instanceof THREE.DirectionalLight&&m++,E instanceof THREE.PointLight&&h++;for(h+m<=4?p=m:h=4-(p=Math.ceil(4*m/(h+m))),E={directional:p,point:h},h=m=0,p=t.length;h<p;h++)(u=t[h])instanceof THREE.SpotLight&&u.castShadow&&m++;var c=50;void 0!==o&&o instanceof THREE.SkinnedMesh&&(c=o.bones.length);a:{p=e.fragmentShader,u=e.vertexShader;var _,E,f,p,u,m,$,g,h=e.uniforms,t=e.attributes,n={map:!!e.map,envMap:!!e.envMap,lightMap:!!e.lightMap,vertexColors:e.vertexColors,fog:n,sizeAttenuation:e.sizeAttenuation,skinning:e.skinning,morphTargets:e.morphTargets,maxMorphTargets:this.maxMorphTargets,maxDirLights:E.directional,maxPointLights:E.point,maxBones:c,shadowMapEnabled:this.shadowMapEnabled&&o.receiveShadow,shadowMapSoft:this.shadowMapSoft,shadowMapWidth:this.shadowMapWidth,shadowMapHeight:this.shadowMapHeight,maxShadows:m,alphaTest:e.alphaTest},o=[];for(g in f?o.push(f):(o.push(p),o.push(u)),n)o.push(g),o.push(n[g]);for(f=o.join(),g=0,o=z.length;g<o;g++)if(z[g].code==f){$=z[g].program;break a}g=P.createProgram(),o=[eu?"#define VERTEX_TEXTURES":"","#define MAX_DIR_LIGHTS "+n.maxDirLights,"#define MAX_POINT_LIGHTS "+n.maxPointLights,"#define MAX_SHADOWS "+n.maxShadows,"#define MAX_BONES "+n.maxBones,n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.lightMap?"#define USE_LIGHTMAP":"",n.vertexColors?"#define USE_COLOR":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapSoft?"#define SHADOWMAP_SOFT":"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nuniform mat4 cameraInverseMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinVertexA;\nattribute vec4 skinVertexB;\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n"),E=["#ifdef GL_ES\nprecision highp float;\n#endif","#define MAX_DIR_LIGHTS "+n.maxDirLights,"#define MAX_POINT_LIGHTS "+n.maxPointLights,"#define MAX_SHADOWS "+n.maxShadows,n.alphaTest?"#define ALPHATEST "+n.alphaTest:"",n.fog?"#define USE_FOG":"",n.fog instanceof THREE.FogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.lightMap?"#define USE_LIGHTMAP":"",n.vertexColors?"#define USE_COLOR":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapSoft?"#define SHADOWMAP_SOFT":"",n.shadowMapSoft?"#define SHADOWMAP_WIDTH "+n.shadowMapWidth.toFixed(1):"",n.shadowMapSoft?"#define SHADOWMAP_HEIGHT "+n.shadowMapHeight.toFixed(1):"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n"),P.attachShader(g,M("fragment",E+p)),P.attachShader(g,M("vertex",o+u)),P.linkProgram(g),P.getProgramParameter(g,P.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+P.getProgramParameter(g,P.VALIDATE_STATUS)+", gl error ["+P.getError()+"]"),g.uniforms={},g.attributes={};var v,o=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition","cameraInverseMatrix","boneGlobalMatrices","morphTargetInfluences"];for(v in h)o.push(v);for(v=o,o=0,h=v.length;o<h;o++)p=v[o],g.uniforms[p]=P.getUniformLocation(g,p);for(v=0,o=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"];v<n.maxMorphTargets;v++)o.push("morphTarget"+v);for($ in t)o.push($);for(v=0,t=($=o).length;v<t;v++)n=$[v],g.attributes[n]=P.getAttribLocation(g,n);z.push({program:g,code:f}),$=g}if(e.program=$,($=e.program.attributes).position>=0&&P.enableVertexAttribArray($.position),$.color>=0&&P.enableVertexAttribArray($.color),$.normal>=0&&P.enableVertexAttribArray($.normal),$.tangent>=0&&P.enableVertexAttribArray($.tangent),e.skinning&&$.skinVertexA>=0&&$.skinVertexB>=0&&$.skinIndex>=0&&$.skinWeight>=0&&(P.enableVertexAttribArray($.skinVertexA),P.enableVertexAttribArray($.skinVertexB),P.enableVertexAttribArray($.skinIndex),P.enableVertexAttribArray($.skinWeight)),e.attributes)for(_ in e.attributes)void 0!==$[_]&&$[_]>=0&&P.enableVertexAttribArray($[_]);if(e.morphTargets)for(_=e.numSupportedMorphTargets=0;_<this.maxMorphTargets;_++)$[v="morphTarget"+_]>=0&&(P.enableVertexAttribArray($[v]),e.numSupportedMorphTargets++)},this.render=function(e,t,u,T){var y,R,x,H,w,M,A,L,z=e.lights,U=e.fog;for(this.shadowMapEnabled&&function e(t,E){var u,m,$,g,T,y,R,x=0,H=t.lights;for(el||(el=new THREE.Camera(V.shadowCameraFov,E.aspect,V.shadowCameraNear,V.shadowCameraFar)),u=0,m=H.length;u<m;u++)if(($=H[u])instanceof THREE.SpotLight&&$.castShadow){for(V.shadowMap[x]||(V.shadowMap[x]=new THREE.WebGLRenderTarget(V.shadowMapWidth,V.shadowMapHeight,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat})),ec[x]||(ec[x]=new THREE.Matrix4),g=V.shadowMap[x],T=ec[x],el.position.copy($.position),el.target.position.copy($.target.position),el.update(void 0,!0),t.update(void 0,!1,el),T.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),T.multiplySelf(el.projectionMatrix),T.multiplySelf(el.matrixWorldInverse),el.matrixWorldInverse.flattenToArray(ee),el.projectionMatrix.flattenToArray(J),K.multiply(el.projectionMatrix,el.matrixWorldInverse),f(K),V.initWebGLObjects(t),C(g),P.clearColor(1,1,1,1),V.clear(),P.clearColor(es.r,es.g,es.b,eh),T=t.__webglObjects.length,$=t.__webglObjectsImmediate.length,g=0;g<T;g++)(R=(y=t.__webglObjects[g]).object).visible&&R.castShadow&&(!(R instanceof THREE.Mesh)||p(R))?(R.matrixWorld.flattenToArray(R._objectMatrixArray),v(R,el,!1),y.render=!0):y.render=!1;for(_(!0),b(THREE.NormalBlending),g=0;g<T;g++)(y=t.__webglObjects[g]).render&&(R=y.object,buffer=y.buffer,c(R),o(el,H,null,y=R.customDepthMaterial?R.customDepthMaterial:R.geometry.morphTargets.length?ef:eE,buffer,R));for(g=0;g<$;g++)(R=(y=t.__webglObjectsImmediate[g]).object).visible&&R.castShadow&&(R.matrixAutoUpdate&&R.matrixWorld.flattenToArray(R._objectMatrixArray),v(R,el,!1),c(R),program=n(el,H,null,eE,R),R.render(function(e){h(e,program,eE.shading)}));x++}}(e,t),V.data.vertices=0,V.data.faces=0,V.data.drawCalls=0,t.matrixAutoUpdate&&t.update(void 0,!0),e.update(void 0,!1,t),t.matrixWorldInverse.flattenToArray(ee),t.projectionMatrix.flattenToArray(J),K.multiply(t.projectionMatrix,t.matrixWorldInverse),f(K),this.initWebGLObjects(e),C(u),(this.autoClear||T)&&this.clear(),w=e.__webglObjects.length,T=0;T<w;T++)(A=(y=e.__webglObjects[T]).object).visible&&(!(A instanceof THREE.Mesh)||p(A))?(A.matrixWorld.flattenToArray(A._objectMatrixArray),v(A,t,!0),$(y),y.render=!0,this.sortObjects&&(y.object.renderDepth?y.z=y.object.renderDepth:(et.copy(A.position),K.multiplyVector3(et),y.z=et.z))):y.render=!1;for(this.sortObjects&&e.__webglObjects.sort(g),M=e.__webglObjectsImmediate.length,T=0;T<M;T++)(A=(y=e.__webglObjectsImmediate[T]).object).visible&&(A.matrixAutoUpdate&&A.matrixWorld.flattenToArray(A._objectMatrixArray),v(A,t,!0),m(y));if(e.overrideMaterial){for(_(e.overrideMaterial.depthTest),b(e.overrideMaterial.blending),T=0;T<w;T++)(y=e.__webglObjects[T]).render&&(A=y.object,L=y.buffer,c(A),o(t,z,U,e.overrideMaterial,L,A));for(T=0;T<M;T++)(A=(y=e.__webglObjectsImmediate[T]).object).visible&&(c(A),R=n(t,z,U,e.overrideMaterial,A),A.render(function(t){h(t,R,e.overrideMaterial.shading)}))}else{for(b(THREE.NormalBlending),T=w-1;T>=0;T--)if((y=e.__webglObjects[T]).render)for(A=y.object,L=y.buffer,x=y.opaque,c(A),y=0;y<x.count;y++)_((H=x.list[y]).depthTest),E(H.polygonOffset,H.polygonOffsetFactor,H.polygonOffsetUnits),o(t,z,U,H,L,A);for(T=0;T<M;T++)if((A=(y=e.__webglObjectsImmediate[T]).object).visible)for(x=y.opaque,c(A),y=0;y<x.count;y++)_((H=x.list[y]).depthTest),E(H.polygonOffset,H.polygonOffsetFactor,H.polygonOffsetUnits),R=n(t,z,U,H,A),A.render(function(e){h(e,R,H.shading)});for(T=0;T<w;T++)if((y=e.__webglObjects[T]).render)for(A=y.object,L=y.buffer,x=y.transparent,c(A),y=0;y<x.count;y++)b((H=x.list[y]).blending),_(H.depthTest),E(H.polygonOffset,H.polygonOffsetFactor,H.polygonOffsetUnits),o(t,z,U,H,L,A);for(T=0;T<M;T++)if((A=(y=e.__webglObjectsImmediate[T]).object).visible)for(x=y.transparent,c(A),y=0;y<x.count;y++)b((H=x.list[y]).blending),_(H.depthTest),E(H.polygonOffset,H.polygonOffsetFactor,H.polygonOffsetUnits),R=n(t,z,U,H,A),A.render(function(e){h(e,R,H.shading)})}e.__webglSprites.length&&function e(t,n){o=ed.attributes;var o,h,c,_,E=ed.uniforms,f=Z/Y,p=[],u=.5*Y,m=.5*Z,$=!0;for(P.useProgram(ed.program),F=ed.program,I=N=-1,em||(P.enableVertexAttribArray(ed.attributes.position),P.enableVertexAttribArray(ed.attributes.uv),em=!0),P.disable(P.CULL_FACE),P.enable(P.BLEND),P.depthMask(!0),P.bindBuffer(P.ARRAY_BUFFER,ed.vertexBuffer),P.vertexAttribPointer(o.position,2,P.FLOAT,!1,16,0),P.vertexAttribPointer(o.uv,2,P.FLOAT,!1,16,8),P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,ed.elementBuffer),P.uniformMatrix4fv(E.projectionMatrix,!1,J),P.activeTexture(P.TEXTURE0),P.uniform1i(E.map,0),o=0,h=t.__webglSprites.length;o<h;o++)(c=t.__webglSprites[o]).useScreenCoordinates?c.z=-c.position.z:(c._modelViewMatrix.multiplyToArray(n.matrixWorldInverse,c.matrixWorld,c._modelViewMatrixArray),c.z=-c._modelViewMatrix.n34);for(t.__webglSprites.sort(g),o=0,h=t.__webglSprites.length;o<h;o++)void 0===(c=t.__webglSprites[o]).material&&c.map&&c.map.image&&c.map.image.width&&(c.useScreenCoordinates?(P.uniform1i(E.useScreenCoordinates,1),P.uniform3f(E.screenPosition,(c.position.x-u)/u,(m-c.position.y)/m,Math.max(0,Math.min(1,c.position.z)))):(P.uniform1i(E.useScreenCoordinates,0),P.uniform1i(E.affectedByDistance,c.affectedByDistance?1:0),P.uniformMatrix4fv(E.modelViewMatrix,!1,c._modelViewMatrixArray)),_=c.map.image.width/(c.scaleByViewport?Z:1),p[0]=_*f*c.scale.x,p[1]=_*c.scale.y,P.uniform2f(E.uvScale,c.uvScale.x,c.uvScale.y),P.uniform2f(E.uvOffset,c.uvOffset.x,c.uvOffset.y),P.uniform2f(E.alignment,c.alignment.x,c.alignment.y),P.uniform1f(E.opacity,c.opacity),P.uniform1f(E.rotation,c.rotation),P.uniform2fv(E.scale,p),c.mergeWith3D&&!$?(P.enable(P.DEPTH_TEST),$=!0):!c.mergeWith3D&&$&&(P.disable(P.DEPTH_TEST),$=!1),b(c.blending),S(c.map,0),P.drawElements(P.TRIANGLES,6,P.UNSIGNED_SHORT,0));P.enable(P.CULL_FACE),P.enable(P.DEPTH_TEST),P.depthMask(k)}(e,t),u&&u.minFilter!==THREE.NearestFilter&&u.minFilter!==THREE.LinearFilter&&(P.bindTexture(P.TEXTURE_2D,u.__webglTexture),P.generateMipmap(P.TEXTURE_2D),P.bindTexture(P.TEXTURE_2D,null))},this.initWebGLObjects=function(e){for(e.__webglObjects||(e.__webglObjects=[],e.__webglObjectsImmediate=[],e.__webglSprites=[]);e.__objectsAdded.length;){var n=e.__objectsAdded[0],o=e,h=void 0,c=void 0,_=void 0;if(void 0==n._modelViewMatrix&&(n._modelViewMatrix=new THREE.Matrix4,n._normalMatrixArray=new Float32Array(9),n._modelViewMatrixArray=new Float32Array(16),n._objectMatrixArray=new Float32Array(16),n.matrixWorld.flattenToArray(n._objectMatrixArray)),n instanceof THREE.Mesh)for(h in void 0==(c=n.geometry).geometryGroups&&x(c),c.geometryGroups){if(!(_=c.geometryGroups[h]).__webglVertexBuffer){var E=_;if(E.__webglVertexBuffer=P.createBuffer(),E.__webglNormalBuffer=P.createBuffer(),E.__webglTangentBuffer=P.createBuffer(),E.__webglColorBuffer=P.createBuffer(),E.__webglUVBuffer=P.createBuffer(),E.__webglUV2Buffer=P.createBuffer(),E.__webglSkinVertexABuffer=P.createBuffer(),E.__webglSkinVertexBBuffer=P.createBuffer(),E.__webglSkinIndicesBuffer=P.createBuffer(),E.__webglSkinWeightsBuffer=P.createBuffer(),E.__webglFaceBuffer=P.createBuffer(),E.__webglLineBuffer=P.createBuffer(),E.numMorphTargets){var f=void 0,p=void 0;for(E.__webglMorphTargetsBuffers=[],f=0,p=E.numMorphTargets;f<p;f++)E.__webglMorphTargetsBuffers.push(P.createBuffer())}for(var E=_,f=n,u=void 0,m=void 0,$=void 0,g=$=void 0,v=void 0,b=void 0,w=b=p=0,S=$=m=void 0,C=S=m=u=void 0,$=void 0,g=f.geometry,v=g.faces,S=E.faces,u=0,m=S.length;u<m;u++)($=v[$=S[u]])instanceof THREE.Face3?(p+=3,b+=1,w+=3):$ instanceof THREE.Face4&&(p+=4,b+=2,w+=4);for(var u=E,m=f,M=S=v=void 0,A=void 0,M=void 0,$=[],v=0,S=m.materials.length;v<S;v++)if((M=m.materials[v])instanceof THREE.MeshFaceMaterial)for(M=0,l=u.materials.length;M<l;M++)(A=u.materials[M])&&$.push(A);else(A=M)&&$.push(A);u=$,E.__materials=u;a:{for(v=m=void 0,S=u.length,m=0;m<S;m++)if((v=u[m]).map||v.lightMap||v instanceof THREE.MeshShaderMaterial){m=!0;break a}m=!1}a:{for(S=v=void 0,$=u.length,v=0;v<$;v++)if(!((S=u[v])instanceof THREE.MeshBasicMaterial&&!S.envMap||S instanceof THREE.MeshDepthMaterial)){S=S&&void 0!=S.shading&&S.shading==THREE.SmoothShading?THREE.SmoothShading:THREE.FlatShading;break a}S=!1}a:{for($=v=void 0,M=u.length,v=0;v<M;v++)if(($=u[v]).vertexColors){$=$.vertexColors;break a}$=!1}if(E.__vertexArray=new Float32Array(3*p),S&&(E.__normalArray=new Float32Array(3*p)),g.hasTangents&&(E.__tangentArray=new Float32Array(4*p)),$&&(E.__colorArray=new Float32Array(3*p)),m&&((g.faceUvs.length>0||g.faceVertexUvs.length>0)&&(E.__uvArray=new Float32Array(2*p)),(g.faceUvs.length>1||g.faceVertexUvs.length>1)&&(E.__uv2Array=new Float32Array(2*p))),f.geometry.skinWeights.length&&f.geometry.skinIndices.length&&(E.__skinVertexAArray=new Float32Array(4*p),E.__skinVertexBArray=new Float32Array(4*p),E.__skinIndexArray=new Float32Array(4*p),E.__skinWeightArray=new Float32Array(4*p)),E.__faceArray=new Uint16Array(3*b+(f.geometry.edgeFaces?6*f.geometry.edgeFaces.length:0)),E.__lineArray=new Uint16Array(2*w),E.numMorphTargets)for(E.__morphTargetsArrays=[],g=0,v=E.numMorphTargets;g<v;g++)E.__morphTargetsArrays.push(new Float32Array(3*p));for(E.__needsSmoothNormals=S==THREE.SmoothShading,E.__uvType=m,E.__vertexColorType=$,E.__normalType=S,E.__webglFaceCount=3*b+(f.geometry.edgeFaces?6*f.geometry.edgeFaces.length:0),E.__webglLineCount=2*w,g=0,v=u.length;g<v;g++)if((m=u[g]).attributes)for(a in void 0===E.__webglCustomAttributes&&(E.__webglCustomAttributes={}),m.attributes){for(C in $=m.attributes[a],S={},$)S[C]=$[C];(!S.__webglInitialized||S.createUniqueBuffers)&&(S.__webglInitialized=!0,b=1,"v2"===S.type?b=2:"v3"===S.type?b=3:"v4"===S.type?b=4:"c"===S.type&&(b=3),S.size=b,S.array=new Float32Array(p*b),S.buffer=P.createBuffer(),S.buffer.belongsToAttribute=a,$.needsUpdate=!0,S.__original=$),E.__webglCustomAttributes[a]=S}E.__inittedArrays=!0,c.__dirtyVertices=!0,c.__dirtyMorphTargets=!0,c.__dirtyElements=!0,c.__dirtyUvs=!0,c.__dirtyNormals=!0,c.__dirtyTangents=!0,c.__dirtyColors=!0}H(o.__webglObjects,_,n)}else if(n instanceof THREE.Ribbon)(c=n.geometry).__webglVertexBuffer||((h=c).__webglVertexBuffer=P.createBuffer(),h.__webglColorBuffer=P.createBuffer(),_=(h=c).vertices.length,h.__vertexArray=new Float32Array(3*_),h.__colorArray=new Float32Array(3*_),h.__webglVertexCount=_,c.__dirtyVertices=!0,c.__dirtyColors=!0),H(o.__webglObjects,c,n);else if(n instanceof THREE.Line)(c=n.geometry).__webglVertexBuffer||((h=c).__webglVertexBuffer=P.createBuffer(),h.__webglColorBuffer=P.createBuffer(),_=(h=c).vertices.length,h.__vertexArray=new Float32Array(3*_),h.__colorArray=new Float32Array(3*_),h.__webglLineCount=_,c.__dirtyVertices=!0,c.__dirtyColors=!0),H(o.__webglObjects,c,n);else if(n instanceof THREE.ParticleSystem){if(!(c=n.geometry).__webglVertexBuffer){for((h=c).__webglVertexBuffer=P.createBuffer(),h.__webglColorBuffer=P.createBuffer(),h=c,_=n,E=h.vertices.length,h.__vertexArray=new Float32Array(3*E),h.__colorArray=new Float32Array(3*E),h.__sortArray=[],h.__webglParticleCount=E,h.__materials=_.materials,C=p=f=void 0,f=0,p=_.materials.length;f<p;f++)if((C=_.materials[f]).attributes)for(a in void 0===h.__webglCustomAttributes&&(h.__webglCustomAttributes={}),C.attributes){for(property in originalAttribute=C.attributes[a],attribute={},originalAttribute)attribute[property]=originalAttribute[property];(!attribute.__webglInitialized||attribute.createUniqueBuffers)&&(attribute.__webglInitialized=!0,size=1,"v2"===attribute.type?size=2:"v3"===attribute.type?size=3:"v4"===attribute.type?size=4:"c"===attribute.type&&(size=3),attribute.size=size,attribute.array=new Float32Array(E*size),attribute.buffer=P.createBuffer(),attribute.buffer.belongsToAttribute=a,originalAttribute.needsUpdate=!0,attribute.__original=originalAttribute),h.__webglCustomAttributes[a]=attribute}c.__dirtyVertices=!0,c.__dirtyColors=!0}H(o.__webglObjects,c,n)}else void 0!==THREE.MarchingCubes&&n instanceof THREE.MarchingCubes?o.__webglObjectsImmediate.push({object:n,opaque:{list:[],count:0},transparent:{list:[],count:0}}):n instanceof THREE.Sprite&&o.__webglSprites.push(n);e.__objectsAdded.splice(0,1)}for(;e.__objectsRemoved.length;){if(o=e.__objectsRemoved[0],n=e,o instanceof THREE.Mesh||o instanceof THREE.ParticleSystem||o instanceof THREE.Ribbon||o instanceof THREE.Line)R(n.__webglObjects,o);else if(o instanceof THREE.Sprite)for(n=n.__webglSprites,c=void 0,c=n.length-1;c>=0;c--)n[c]==o&&n.splice(c,1);else o instanceof THREE.MarchingCubes&&R(n.__webglObjectsImmediate,o);e.__objectsRemoved.splice(0,1)}for(n=0,o=e.__webglObjects.length;n<o;n++)if(h=e.__webglObjects[n].object,f=E=c=_=void 0,h instanceof THREE.Mesh){for(_ in(c=h.geometry).geometryGroups)if(f=T(E=c.geometryGroups[_]),(c.__dirtyVertices||c.__dirtyMorphTargets||c.__dirtyElements||c.__dirtyUvs||c.__dirtyNormals||c.__dirtyColors||c.__dirtyTangents||f)&&(f=E,p=P.DYNAMIC_DRAW,C=!c.dynamic,f.__inittedArrays)){var L=w=b=void 0,V=void 0,z=L=void 0,F=void 0,U=void 0,k=void 0,B=A=M=$=S=v=m=u=g=void 0,D=V=k=V=U=F=void 0,N=void 0,I=N=D=F=void 0,O=void 0,W=I=N=D=L=L=z=k=V=I=N=D=O=I=N=D=O=I=N=D=void 0,G=0,j=0,X=0,Y=0,Z=0,Q=0,K=0,J=0,ee=0,et=0,ei=0,I=D=0,I=void 0,er=f.__vertexArray,en=f.__uvArray,eo=f.__uv2Array,ea=f.__normalArray,es=f.__tangentArray,eh=f.__colorArray,el=f.__skinVertexAArray,ec=f.__skinVertexBArray,e_=f.__skinIndexArray,eE=f.__skinWeightArray,ef=f.__morphTargetsArrays,ep=f.__webglCustomAttributes,N=void 0,eu=f.__faceArray,ed=f.__lineArray,em=f.__needsSmoothNormals,u=f.__vertexColorType,g=f.__uvType,m=f.__normalType,e$=h.geometry,eg=e$.__dirtyVertices,ev=e$.__dirtyElements,eT=e$.__dirtyUvs,ey=e$.__dirtyNormals,eR=e$.__dirtyTangents,ex=e$.__dirtyColors,eH=e$.__dirtyMorphTargets,eb=e$.vertices,e0=f.faces,e8=e$.faces,e1=e$.faceVertexUvs[0],ew=e$.faceVertexUvs[1],eS=e$.skinVerticesA,eC=e$.skinVerticesB,eM=e$.skinIndices,e2=e$.skinWeights,eA=e$.morphTargets;if(ep)for(W in ep)ep[W].offset=0,ep[W].offsetSrc=0;for(b=0,w=e0.length;b<w;b++)if(V=e8[L=e0[b]],e1&&(v=e1[L]),ew&&(S=ew[L]),L=V.vertexNormals,z=V.normal,F=V.vertexColors,U=V.color,k=V.vertexTangents,V instanceof THREE.Face3){if(eg&&($=eb[V.a].position,M=eb[V.b].position,A=eb[V.c].position,er[j]=$.x,er[j+1]=$.y,er[j+2]=$.z,er[j+3]=M.x,er[j+4]=M.y,er[j+5]=M.z,er[j+6]=A.x,er[j+7]=A.y,er[j+8]=A.z,j+=9),ep)for(W in ep)(N=ep[W]).__original.needsUpdate&&(D=N.offset,I=N.offsetSrc,1===N.size?(void 0===N.boundTo||"vertices"===N.boundTo?(N.array[D]=N.value[V.a],N.array[D+1]=N.value[V.b],N.array[D+2]=N.value[V.c]):"faces"===N.boundTo?(I=N.value[I],N.array[D]=I,N.array[D+1]=I,N.array[D+2]=I,N.offsetSrc++):"faceVertices"===N.boundTo&&(N.array[D]=N.value[I],N.array[D+1]=N.value[I+1],N.array[D+2]=N.value[I+2],N.offsetSrc+=3),N.offset+=3):(void 0===N.boundTo||"vertices"===N.boundTo?($=N.value[V.a],M=N.value[V.b],A=N.value[V.c]):"faces"===N.boundTo?(A=M=$=I=N.value[I],N.offsetSrc++):"faceVertices"===N.boundTo&&($=N.value[I],M=N.value[I+1],A=N.value[I+2],N.offsetSrc+=3),2===N.size?(N.array[D]=$.x,N.array[D+1]=$.y,N.array[D+2]=M.x,N.array[D+3]=M.y,N.array[D+4]=A.x,N.array[D+5]=A.y,N.offset+=6):3===N.size?("c"===N.type?(N.array[D]=$.r,N.array[D+1]=$.g,N.array[D+2]=$.b,N.array[D+3]=M.r,N.array[D+4]=M.g,N.array[D+5]=M.b,N.array[D+6]=A.r,N.array[D+7]=A.g,N.array[D+8]=A.b):(N.array[D]=$.x,N.array[D+1]=$.y,N.array[D+2]=$.z,N.array[D+3]=M.x,N.array[D+4]=M.y,N.array[D+5]=M.z,N.array[D+6]=A.x,N.array[D+7]=A.y,N.array[D+8]=A.z),N.offset+=9):(N.array[D]=$.x,N.array[D+1]=$.y,N.array[D+2]=$.z,N.array[D+3]=$.w,N.array[D+4]=M.x,N.array[D+5]=M.y,N.array[D+6]=M.z,N.array[D+7]=M.w,N.array[D+8]=A.x,N.array[D+9]=A.y,N.array[D+10]=A.z,N.array[D+11]=A.w,N.offset+=12)));if(eH){for(D=0,N=eA.length;D<N;D++)$=eA[D].vertices[V.a].position,M=eA[D].vertices[V.b].position,A=eA[D].vertices[V.c].position,(I=ef[D])[ei]=$.x,I[ei+1]=$.y,I[ei+2]=$.z,I[ei+3]=M.x,I[ei+4]=M.y,I[ei+5]=M.z,I[ei+6]=A.x,I[ei+7]=A.y,I[ei+8]=A.z;ei+=9}if(e2.length&&(D=e2[V.a],N=e2[V.b],I=e2[V.c],eE[et]=D.x,eE[et+1]=D.y,eE[et+2]=D.z,eE[et+3]=D.w,eE[et+4]=N.x,eE[et+5]=N.y,eE[et+6]=N.z,eE[et+7]=N.w,eE[et+8]=I.x,eE[et+9]=I.y,eE[et+10]=I.z,eE[et+11]=I.w,D=eM[V.a],N=eM[V.b],I=eM[V.c],e_[et]=D.x,e_[et+1]=D.y,e_[et+2]=D.z,e_[et+3]=D.w,e_[et+4]=N.x,e_[et+5]=N.y,e_[et+6]=N.z,e_[et+7]=N.w,e_[et+8]=I.x,e_[et+9]=I.y,e_[et+10]=I.z,e_[et+11]=I.w,D=eS[V.a],N=eS[V.b],I=eS[V.c],el[et]=D.x,el[et+1]=D.y,el[et+2]=D.z,el[et+3]=1,el[et+4]=N.x,el[et+5]=N.y,el[et+6]=N.z,el[et+7]=1,el[et+8]=I.x,el[et+9]=I.y,el[et+10]=I.z,el[et+11]=1,D=eC[V.a],N=eC[V.b],I=eC[V.c],ec[et]=D.x,ec[et+1]=D.y,ec[et+2]=D.z,ec[et+3]=1,ec[et+4]=N.x,ec[et+5]=N.y,ec[et+6]=N.z,ec[et+7]=1,ec[et+8]=I.x,ec[et+9]=I.y,ec[et+10]=I.z,ec[et+11]=1,et+=12),ex&&u&&(3==F.length&&u==THREE.VertexColors?(V=F[0],D=F[1],N=F[2]):N=D=V=U,eh[ee]=V.r,eh[ee+1]=V.g,eh[ee+2]=V.b,eh[ee+3]=D.r,eh[ee+4]=D.g,eh[ee+5]=D.b,eh[ee+6]=N.r,eh[ee+7]=N.g,eh[ee+8]=N.b,ee+=9),eR&&e$.hasTangents&&(F=k[0],U=k[1],V=k[2],es[K]=F.x,es[K+1]=F.y,es[K+2]=F.z,es[K+3]=F.w,es[K+4]=U.x,es[K+5]=U.y,es[K+6]=U.z,es[K+7]=U.w,es[K+8]=V.x,es[K+9]=V.y,es[K+10]=V.z,es[K+11]=V.w,K+=12),ey&&m){if(3==L.length&&em)for(k=0;k<3;k++)z=L[k],ea[Q]=z.x,ea[Q+1]=z.y,ea[Q+2]=z.z,Q+=3;else for(k=0;k<3;k++)ea[Q]=z.x,ea[Q+1]=z.y,ea[Q+2]=z.z,Q+=3}if(eT&&void 0!==v&&g)for(k=0;k<3;k++)L=v[k],en[X]=L.u,en[X+1]=L.v,X+=2;if(eT&&void 0!==S&&g)for(k=0;k<3;k++)L=S[k],eo[Y]=L.u,eo[Y+1]=L.v,Y+=2;ev&&(eu[Z]=G,eu[Z+1]=G+1,eu[Z+2]=G+2,Z+=3,ed[J]=G,ed[J+1]=G+1,ed[J+2]=G,ed[J+3]=G+2,ed[J+4]=G+1,ed[J+5]=G+2,J+=6,G+=3)}else if(V instanceof THREE.Face4){if(eg&&($=eb[V.a].position,M=eb[V.b].position,A=eb[V.c].position,B=eb[V.d].position,er[j]=$.x,er[j+1]=$.y,er[j+2]=$.z,er[j+3]=M.x,er[j+4]=M.y,er[j+5]=M.z,er[j+6]=A.x,er[j+7]=A.y,er[j+8]=A.z,er[j+9]=B.x,er[j+10]=B.y,er[j+11]=B.z,j+=12),ep)for(W in ep)(N=ep[W]).__original.needsUpdate&&(D=N.offset,I=N.offsetSrc,1===N.size?(void 0===N.boundTo||"vertices"===N.boundTo?(N.array[D]=N.value[V.a],N.array[D+1]=N.value[V.b],N.array[D+2]=N.value[V.c],N.array[D+3]=N.value[V.d]):"faces"===N.boundTo?(I=N.value[I],N.array[D]=I,N.array[D+1]=I,N.array[D+2]=I,N.array[D+3]=I,N.offsetSrc++):"faceVertices"===N.boundTo&&(N.array[D]=N.value[I],N.array[D+1]=N.value[I+1],N.array[D+2]=N.value[I+2],N.array[D+3]=N.value[I+3],N.offsetSrc+=4),N.offset+=4):(void 0===N.boundTo||"vertices"===N.boundTo?($=N.value[V.a],M=N.value[V.b],A=N.value[V.c],B=N.value[V.d]):"faces"===N.boundTo?(B=A=M=$=I=N.value[I],N.offsetSrc++):"faceVertices"===N.boundTo&&($=N.value[I],M=N.value[I+1],A=N.value[I+2],B=N.value[I+3],N.offsetSrc+=4),2===N.size?(N.array[D]=$.x,N.array[D+1]=$.y,N.array[D+2]=M.x,N.array[D+3]=M.y,N.array[D+4]=A.x,N.array[D+5]=A.y,N.array[D+6]=B.x,N.array[D+7]=B.y,N.offset+=8):3===N.size?("c"===N.type?(N.array[D]=$.r,N.array[D+1]=$.g,N.array[D+2]=$.b,N.array[D+3]=M.r,N.array[D+4]=M.g,N.array[D+5]=M.b,N.array[D+6]=A.r,N.array[D+7]=A.g,N.array[D+8]=A.b,N.array[D+9]=B.r,N.array[D+10]=B.g,N.array[D+11]=B.b):(N.array[D]=$.x,N.array[D+1]=$.y,N.array[D+2]=$.z,N.array[D+3]=M.x,N.array[D+4]=M.y,N.array[D+5]=M.z,N.array[D+6]=A.x,N.array[D+7]=A.y,N.array[D+8]=A.z,N.array[D+9]=B.x,N.array[D+10]=B.y,N.array[D+11]=B.z),N.offset+=12):(N.array[D]=$.x,N.array[D+1]=$.y,N.array[D+2]=$.z,N.array[D+3]=$.w,N.array[D+4]=M.x,N.array[D+5]=M.y,N.array[D+6]=M.z,N.array[D+7]=M.w,N.array[D+8]=A.x,N.array[D+9]=A.y,N.array[D+10]=A.z,N.array[D+11]=A.w,N.array[D+12]=B.x,N.array[D+13]=B.y,N.array[D+14]=B.z,N.array[D+15]=B.w,N.offset+=16)));if(eH){for(D=0,N=eA.length;D<N;D++)$=eA[D].vertices[V.a].position,M=eA[D].vertices[V.b].position,A=eA[D].vertices[V.c].position,B=eA[D].vertices[V.d].position,(I=ef[D])[ei]=$.x,I[ei+1]=$.y,I[ei+2]=$.z,I[ei+3]=M.x,I[ei+4]=M.y,I[ei+5]=M.z,I[ei+6]=A.x,I[ei+7]=A.y,I[ei+8]=A.z,I[ei+9]=B.x,I[ei+10]=B.y,I[ei+11]=B.z;ei+=12}if(e2.length&&(D=e2[V.a],N=e2[V.b],I=e2[V.c],O=e2[V.d],eE[et]=D.x,eE[et+1]=D.y,eE[et+2]=D.z,eE[et+3]=D.w,eE[et+4]=N.x,eE[et+5]=N.y,eE[et+6]=N.z,eE[et+7]=N.w,eE[et+8]=I.x,eE[et+9]=I.y,eE[et+10]=I.z,eE[et+11]=I.w,eE[et+12]=O.x,eE[et+13]=O.y,eE[et+14]=O.z,eE[et+15]=O.w,D=eM[V.a],N=eM[V.b],I=eM[V.c],O=eM[V.d],e_[et]=D.x,e_[et+1]=D.y,e_[et+2]=D.z,e_[et+3]=D.w,e_[et+4]=N.x,e_[et+5]=N.y,e_[et+6]=N.z,e_[et+7]=N.w,e_[et+8]=I.x,e_[et+9]=I.y,e_[et+10]=I.z,e_[et+11]=I.w,e_[et+12]=O.x,e_[et+13]=O.y,e_[et+14]=O.z,e_[et+15]=O.w,D=eS[V.a],N=eS[V.b],I=eS[V.c],O=eS[V.d],el[et]=D.x,el[et+1]=D.y,el[et+2]=D.z,el[et+3]=1,el[et+4]=N.x,el[et+5]=N.y,el[et+6]=N.z,el[et+7]=1,el[et+8]=I.x,el[et+9]=I.y,el[et+10]=I.z,el[et+11]=1,el[et+12]=O.x,el[et+13]=O.y,el[et+14]=O.z,el[et+15]=1,D=eC[V.a],N=eC[V.b],I=eC[V.c],V=eC[V.d],ec[et]=D.x,ec[et+1]=D.y,ec[et+2]=D.z,ec[et+3]=1,ec[et+4]=N.x,ec[et+5]=N.y,ec[et+6]=N.z,ec[et+7]=1,ec[et+8]=I.x,ec[et+9]=I.y,ec[et+10]=I.z,ec[et+11]=1,ec[et+12]=V.x,ec[et+13]=V.y,ec[et+14]=V.z,ec[et+15]=1,et+=16),ex&&u&&(4==F.length&&u==THREE.VertexColors?(V=F[0],D=F[1],N=F[2],F=F[3]):F=N=D=V=U,eh[ee]=V.r,eh[ee+1]=V.g,eh[ee+2]=V.b,eh[ee+3]=D.r,eh[ee+4]=D.g,eh[ee+5]=D.b,eh[ee+6]=N.r,eh[ee+7]=N.g,eh[ee+8]=N.b,eh[ee+9]=F.r,eh[ee+10]=F.g,eh[ee+11]=F.b,ee+=12),eR&&e$.hasTangents&&(F=k[0],U=k[1],V=k[2],k=k[3],es[K]=F.x,es[K+1]=F.y,es[K+2]=F.z,es[K+3]=F.w,es[K+4]=U.x,es[K+5]=U.y,es[K+6]=U.z,es[K+7]=U.w,es[K+8]=V.x,es[K+9]=V.y,es[K+10]=V.z,es[K+11]=V.w,es[K+12]=k.x,es[K+13]=k.y,es[K+14]=k.z,es[K+15]=k.w,K+=16),ey&&m){if(4==L.length&&em)for(k=0;k<4;k++)z=L[k],ea[Q]=z.x,ea[Q+1]=z.y,ea[Q+2]=z.z,Q+=3;else for(k=0;k<4;k++)ea[Q]=z.x,ea[Q+1]=z.y,ea[Q+2]=z.z,Q+=3}if(eT&&void 0!==v&&g)for(k=0;k<4;k++)L=v[k],en[X]=L.u,en[X+1]=L.v,X+=2;if(eT&&void 0!==S&&g)for(k=0;k<4;k++)L=S[k],eo[Y]=L.u,eo[Y+1]=L.v,Y+=2;ev&&(eu[Z]=G,eu[Z+1]=G+1,eu[Z+2]=G+3,eu[Z+3]=G+1,eu[Z+4]=G+2,eu[Z+5]=G+3,Z+=6,ed[J]=G,ed[J+1]=G+1,ed[J+2]=G,ed[J+3]=G+3,ed[J+4]=G+1,ed[J+5]=G+2,ed[J+6]=G+2,ed[J+7]=G+3,J+=8,G+=4)}if(eg&&(P.bindBuffer(P.ARRAY_BUFFER,f.__webglVertexBuffer),P.bufferData(P.ARRAY_BUFFER,er,p)),ep)for(W in ep)(N=ep[W]).__original.needsUpdate&&(P.bindBuffer(P.ARRAY_BUFFER,N.buffer),P.bufferData(P.ARRAY_BUFFER,N.array,p));if(eH)for(D=0,N=eA.length;D<N;D++)P.bindBuffer(P.ARRAY_BUFFER,f.__webglMorphTargetsBuffers[D]),P.bufferData(P.ARRAY_BUFFER,ef[D],p);ex&&ee>0&&(P.bindBuffer(P.ARRAY_BUFFER,f.__webglColorBuffer),P.bufferData(P.ARRAY_BUFFER,eh,p)),ey&&(P.bindBuffer(P.ARRAY_BUFFER,f.__webglNormalBuffer),P.bufferData(P.ARRAY_BUFFER,ea,p)),eR&&e$.hasTangents&&(P.bindBuffer(P.ARRAY_BUFFER,f.__webglTangentBuffer),P.bufferData(P.ARRAY_BUFFER,es,p)),eT&&X>0&&(P.bindBuffer(P.ARRAY_BUFFER,f.__webglUVBuffer),P.bufferData(P.ARRAY_BUFFER,en,p)),eT&&Y>0&&(P.bindBuffer(P.ARRAY_BUFFER,f.__webglUV2Buffer),P.bufferData(P.ARRAY_BUFFER,eo,p)),ev&&(P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,f.__webglFaceBuffer),P.bufferData(P.ELEMENT_ARRAY_BUFFER,eu,p),P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,f.__webglLineBuffer),P.bufferData(P.ELEMENT_ARRAY_BUFFER,ed,p)),et>0&&(P.bindBuffer(P.ARRAY_BUFFER,f.__webglSkinVertexABuffer),P.bufferData(P.ARRAY_BUFFER,el,p),P.bindBuffer(P.ARRAY_BUFFER,f.__webglSkinVertexBBuffer),P.bufferData(P.ARRAY_BUFFER,ec,p),P.bindBuffer(P.ARRAY_BUFFER,f.__webglSkinIndicesBuffer),P.bufferData(P.ARRAY_BUFFER,e_,p),P.bindBuffer(P.ARRAY_BUFFER,f.__webglSkinWeightsBuffer),P.bufferData(P.ARRAY_BUFFER,eE,p)),C&&(delete f.__inittedArrays,delete f.__colorArray,delete f.__normalArray,delete f.__tangentArray,delete f.__uvArray,delete f.__uv2Array,delete f.__faceArray,delete f.__vertexArray,delete f.__lineArray,delete f.__skinVertexAArray,delete f.__skinVertexBArray,delete f.__skinIndexArray,delete f.__skinWeightArray)}c.__dirtyVertices=!1,c.__dirtyMorphTargets=!1,c.__dirtyElements=!1,c.__dirtyUvs=!1,c.__dirtyNormals=!1,c.__dirtyTangents=!1,c.__dirtyColors=!1,y(E)}else if(h instanceof THREE.Ribbon){if((c=h.geometry).__dirtyVertices||c.__dirtyColors){if(h=c,_=P.DYNAMIC_DRAW,E=w=b=b=void 0,g=h.vertices,f=h.colors,u=g.length,p=f.length,m=h.__vertexArray,C=h.__colorArray,v=h.__dirtyColors,h.__dirtyVertices){for(b=0;b<u;b++)w=g[b].position,m[E=3*b]=w.x,m[E+1]=w.y,m[E+2]=w.z;P.bindBuffer(P.ARRAY_BUFFER,h.__webglVertexBuffer),P.bufferData(P.ARRAY_BUFFER,m,_)}if(v){for(b=0;b<p;b++)color=f[b],C[E=3*b]=color.r,C[E+1]=color.g,C[E+2]=color.b;P.bindBuffer(P.ARRAY_BUFFER,h.__webglColorBuffer),P.bufferData(P.ARRAY_BUFFER,C,_)}}c.__dirtyVertices=!1,c.__dirtyColors=!1}else if(h instanceof THREE.Line){if((c=h.geometry).__dirtyVertices||c.__dirtyColors){if(h=c,_=P.DYNAMIC_DRAW,E=w=b=b=void 0,g=h.vertices,f=h.colors,u=g.length,p=f.length,m=h.__vertexArray,C=h.__colorArray,v=h.__dirtyColors,h.__dirtyVertices){for(b=0;b<u;b++)w=g[b].position,m[E=3*b]=w.x,m[E+1]=w.y,m[E+2]=w.z;P.bindBuffer(P.ARRAY_BUFFER,h.__webglVertexBuffer),P.bufferData(P.ARRAY_BUFFER,m,_)}if(v){for(b=0;b<p;b++)color=f[b],C[E=3*b]=color.r,C[E+1]=color.g,C[E+2]=color.b;P.bindBuffer(P.ARRAY_BUFFER,h.__webglColorBuffer),P.bufferData(P.ARRAY_BUFFER,C,_)}}c.__dirtyVertices=!1,c.__dirtyColors=!1}else h instanceof THREE.ParticleSystem&&(f=T(c=h.geometry),(c.__dirtyVertices||c.__dirtyColors||h.sortParticles||f)&&t(c,P.DYNAMIC_DRAW,h),c.__dirtyVertices=!1,c.__dirtyColors=!1,y(c))},this.setFaceCulling=function(e,t){e?(t&&"ccw"!=t?P.frontFace(P.CW):P.frontFace(P.CCW),"back"==e?P.cullFace(P.BACK):"front"==e?P.cullFace(P.FRONT):P.cullFace(P.FRONT_AND_BACK),P.enable(P.CULL_FACE)):P.disable(P.CULL_FACE)},this.supportsVertexTextures=function(){return eu}},THREE.WebGLRenderTarget=function(e,t,n){this.width=e,this.height=t,n=n||{},this.wrapS=void 0!==n.wrapS?n.wrapS:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==n.wrapT?n.wrapT:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==n.magFilter?n.magFilter:THREE.LinearFilter,this.minFilter=void 0!==n.minFilter?n.minFilter:THREE.LinearMipMapLinearFilter,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.format=void 0!==n.format?n.format:THREE.RGBAFormat,this.type=void 0!==n.type?n.type:THREE.UnsignedByteType,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0===n.stencilBuffer||n.stencilBuffer},THREE.RenderableVertex=function(){this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableFace3=function(){this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.centroidWorld=new THREE.Vector3,this.centroidScreen=new THREE.Vector3,this.normalWorld=new THREE.Vector3,this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.faceMaterials=this.meshMaterials=null,this.overdraw=!1,this.uvs=[[]],this.z=null},THREE.RenderableFace4=function(){this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.v4=new THREE.RenderableVertex,this.centroidWorld=new THREE.Vector3,this.centroidScreen=new THREE.Vector3,this.normalWorld=new THREE.Vector3,this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.faceMaterials=this.meshMaterials=null,this.overdraw=!1,this.uvs=[[]],this.z=null},THREE.RenderableObject=function(){this.z=this.object=null},THREE.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=null,this.scale=new THREE.Vector2,this.materials=null},THREE.RenderableLine=function(){this.z=null,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.materials=null},THREE.ColorUtils={adjustHSV:function(e,t,n,o){var h=THREE.ColorUtils.__hsv;THREE.ColorUtils.rgbToHsv(e,h),h.h=THREE.ColorUtils.clamp(h.h+t,0,1),h.s=THREE.ColorUtils.clamp(h.s+n,0,1),h.v=THREE.ColorUtils.clamp(h.v+o,0,1),e.setHSV(h.h,h.s,h.v)},rgbToHsv:function(e,t){var n=e.r,o=e.g,h=e.b,c=Math.max(Math.max(n,o),h),_=Math.min(Math.min(n,o),h);if(_==c)_=n=0;else{var E=c-_,_=E/c,n=n==c?(o-h)/E:o==c?2+(h-n)/E:4+(n-o)/E;(n/=6)<0&&(n+=1),n>1&&(n-=1)}return void 0===t&&(t={h:0,s:0,v:0}),t.h=n,t.s=_,t.v=c,t},clamp:function(e,t,n){return e<t?t:e>n?n:e}},THREE.ColorUtils.__hsv={h:0,s:0,v:0},THREE.GeometryUtils={merge:function(e,t){var n=t instanceof THREE.Mesh,o=e.vertices.length,h=n?t.geometry:t,c=e.vertices,_=h.vertices,E=e.faces,f=h.faces,p=e.faceVertexUvs[0],h=h.faceVertexUvs[0];n&&t.matrixAutoUpdate&&t.updateMatrix();for(var u=0,m=_.length;u<m;u++){var $=new THREE.Vertex(_[u].position.clone());n&&t.matrix.multiplyVector3($.position),c.push($)}for(u=0,m=f.length;u<m;u++){var g,v,_=f[u],T=_.vertexNormals,$=_.vertexColors;for(_ instanceof THREE.Face3?g=new THREE.Face3(_.a+o,_.b+o,_.c+o):_ instanceof THREE.Face4&&(g=new THREE.Face4(_.a+o,_.b+o,_.c+o,_.d+o)),g.normal.copy(_.normal),n=0,c=T.length;n<c;n++)v=T[n],g.vertexNormals.push(v.clone());for(g.color.copy(_.color),n=0,c=$.length;n<c;n++)v=$[n],g.vertexColors.push(v.clone());g.materials=_.materials.slice(),g.centroid.copy(_.centroid),E.push(g)}for(u=0,m=h.length;u<m;u++){for(o=h[u],E=[],n=0,c=o.length;n<c;n++)E.push(new THREE.UV(o[n].u,o[n].v));p.push(E)}},clone:function(e){var t,n=new THREE.Geometry,o=e.vertices,h=e.faces,c=e.faceVertexUvs[0],e=0;for(t=o.length;e<t;e++){var _=new THREE.Vertex(o[e].position.clone());n.vertices.push(_)}for(e=0,t=h.length;e<t;e++){var E,f,p=h[e],u=p.vertexNormals,m=p.vertexColors;for(p instanceof THREE.Face3?E=new THREE.Face3(p.a,p.b,p.c):p instanceof THREE.Face4&&(E=new THREE.Face4(p.a,p.b,p.c,p.d)),E.normal.copy(p.normal),o=0,_=u.length;o<_;o++)f=u[o],E.vertexNormals.push(f.clone());for(E.color.copy(p.color),o=0,_=m.length;o<_;o++)f=m[o],E.vertexColors.push(f.clone());E.materials=p.materials.slice(),E.centroid.copy(p.centroid),n.faces.push(E)}for(e=0,t=c.length;e<t;e++){for(h=c[e],E=[],o=0,_=h.length;o<_;o++)E.push(new THREE.UV(h[o].u,h[o].v));n.faceVertexUvs[0].push(E)}return n},randomPointInTriangle:function(e,t,n){var o,h,c,_=new THREE.Vector3,E=THREE.GeometryUtils.__v1;return(o=THREE.GeometryUtils.random())+(h=THREE.GeometryUtils.random())>1&&(o=1-o,h=1-h),c=1-o-h,_.copy(e),_.multiplyScalar(o),E.copy(t),E.multiplyScalar(h),_.addSelf(E),E.copy(n),E.multiplyScalar(c),_.addSelf(E),_},randomPointInFace:function(e,t,n){var o,h,c;if(e instanceof THREE.Face3)return o=t.vertices[e.a].position,h=t.vertices[e.b].position,c=t.vertices[e.c].position,THREE.GeometryUtils.randomPointInTriangle(o,h,c);if(e instanceof THREE.Face4){o=t.vertices[e.a].position,h=t.vertices[e.b].position,c=t.vertices[e.c].position;var _,t=t.vertices[e.d].position;return n?e._area1&&e._area2?(n=e._area1,_=e._area2):(n=THREE.GeometryUtils.triangleArea(o,h,t),_=THREE.GeometryUtils.triangleArea(h,c,t),e._area1=n,e._area2=_):(n=THREE.GeometryUtils.triangleArea(o,h,t),_=THREE.GeometryUtils.triangleArea(h,c,t)),THREE.GeometryUtils.random()*(n+_)<n?THREE.GeometryUtils.randomPointInTriangle(o,h,t):THREE.GeometryUtils.randomPointInTriangle(h,c,t)}},randomPointsInGeometry:function(e,t){function n(e){return function t(n,o){if(o<n)return n;var h=n+Math.floor((o-n)/2);return g[h]>e?t(n,h-1):g[h]<e?t(h+1,o):h}(0,g.length-1)}var o,h,c,_,E,f,p=e.faces,u=e.vertices,m=p.length,$=0,g=[];for(h=0;h<m;h++)(o=p[h])instanceof THREE.Face3?(c=u[o.a].position,_=u[o.b].position,E=u[o.c].position,o._area=THREE.GeometryUtils.triangleArea(c,_,E)):o instanceof THREE.Face4&&(c=u[o.a].position,_=u[o.b].position,E=u[o.c].position,f=u[o.d].position,o._area1=THREE.GeometryUtils.triangleArea(c,_,f),o._area2=THREE.GeometryUtils.triangleArea(_,E,f),o._area=o._area1+o._area2),$+=o._area,g[h]=$;for(h=0,o=[],u={};h<t;h++)m=n(m=THREE.GeometryUtils.random()*$),o[h]=THREE.GeometryUtils.randomPointInFace(p[m],e,!0),u[m]?u[m]+=1:u[m]=1;return o},triangleArea:function(e,t,n){var o,h=THREE.GeometryUtils.__v1;return h.sub(e,t),o=h.length(),h.sub(e,n),e=h.length(),h.sub(t,n),Math.sqrt((t=.5*(o+e+(n=h.length())))*(t-o)*(t-e)*(t-n))},random16:function(){return(65280*Math.random()+255*Math.random())/65535}},THREE.GeometryUtils.random=THREE.GeometryUtils.random16,THREE.GeometryUtils.__v1=new THREE.Vector3,THREE.ImageUtils={loadTexture:function(e,t,n){var o=new Image,h=new THREE.Texture(o,t);return o.onload=function(){h.needsUpdate=!0,n&&n(this)},o.crossOrigin="",o.src=e,h},loadTextureCube:function(e,t,n){var o,h=[],c=new THREE.Texture(h,t),t=h.loadCount=0;for(o=e.length;t<o;++t)h[t]=new Image,h[t].onload=function(){h.loadCount+=1,6==h.loadCount&&(c.needsUpdate=!0),n&&n(this)},h[t].crossOrigin="",h[t].src=e[t];return c}},THREE.SceneUtils={showHierarchy:function(e,t){THREE.SceneUtils.traverseHierarchy(e,function(e){e.visible=t})},traverseHierarchy:function(e,t){var n,o,h=e.children.length;for(o=0;o<h;o++)t(n=e.children[o]),THREE.SceneUtils.traverseHierarchy(n,t)}},THREE.WebGLRenderer&&(THREE.ShaderUtils={lib:{fresnel:{uniforms:{mRefractionRatio:{type:"f",value:1.02},mFresnelBias:{type:"f",value:.1},mFresnelPower:{type:"f",value:2},mFresnelScale:{type:"f",value:1},tCube:{type:"t",value:1,texture:null}},fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\nvec4 refractedColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nrefractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;\nrefractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;\nrefractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;\nrefractedColor.a = 1.0;\ngl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );\n}",vertexShader:"uniform float mRefractionRatio;\nuniform float mFresnelBias;\nuniform float mFresnelScale;\nuniform float mFresnelPower;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = normalize ( mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal );\nvec3 I = mPosition.xyz - cameraPosition;\nvReflect = reflect( I, nWorld );\nvRefract[0] = refract( normalize( I ), nWorld, mRefractionRatio );\nvRefract[1] = refract( normalize( I ), nWorld, mRefractionRatio * 0.99 );\nvRefract[2] = refract( normalize( I ), nWorld, mRefractionRatio * 0.98 );\nvReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), nWorld ), mFresnelPower );\ngl_Position = projectionMatrix * mvPosition;\n}"},normal:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},tDiffuse:{type:"t",value:0,texture:null},tNormal:{type:"t",value:2,texture:null},tSpecular:{type:"t",value:3,texture:null},tAO:{type:"t",value:4,texture:null},uNormalScale:{type:"f",value:1},tDisplacement:{type:"t",value:5,texture:null},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new THREE.Color(15658734)},uSpecularColor:{type:"c",value:new THREE.Color(1118481)},uAmbientColor:{type:"c",value:new THREE.Color(328965)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1}}]),fragmentShader:["uniform vec3 uAmbientColor;\nuniform vec3 uDiffuseColor;\nuniform vec3 uSpecularColor;\nuniform float uShininess;\nuniform float uOpacity;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform float uNormalScale;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;",THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( 1.0 );\nvec4 mColor = vec4( uDiffuseColor, uOpacity );\nvec4 mSpecular = vec4( uSpecularColor, uOpacity );\nvec3 specularTex = vec3( 1.0 );\nvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\nnormalTex.xy *= uNormalScale;\nnormalTex = normalize( normalTex );\nif( enableDiffuse )\ngl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );\nif( enableAO )\ngl_FragColor = gl_FragColor * texture2D( tAO, vUv );\nif( enableSpecular )\nspecularTex = texture2D( tSpecular, vUv ).xyz;\nmat3 tsb = mat3( vTangent, vBinormal, vNormal );\nvec3 finalNormal = tsb * normalTex;\nvec3 normal = normalize( finalNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#if MAX_POINT_LIGHTS > 0\nvec4 pointTotal = vec4( vec3( 0.0 ), 1.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec3 pointVector = normalize( vPointLight[ i ].xyz );\nvec3 pointHalfVector = normalize( vPointLight[ i ].xyz + viewPosition );\nfloat pointDistance = vPointLight[ i ].w;\nfloat pointDotNormalHalf = dot( normal, pointHalfVector );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = 0.0;\nif ( pointDotNormalHalf >= 0.0 )\npointSpecularWeight = specularTex.r * pow( pointDotNormalHalf, uShininess );\npointTotal  += pointDistance * vec4( pointLightColor[ i ], 1.0 ) * ( mColor * pointDiffuseWeight + mSpecular * pointSpecularWeight * pointDiffuseWeight );\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec4 dirTotal = vec4( vec3( 0.0 ), 1.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + viewPosition );\nfloat dirDotNormalHalf = dot( normal, dirHalfVector );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = 0.0;\nif ( dirDotNormalHalf >= 0.0 )\ndirSpecularWeight = specularTex.r * pow( dirDotNormalHalf, uShininess );\ndirTotal  += vec4( directionalLightColor[ i ], 1.0 ) * ( mColor * dirDiffuseWeight + mSpecular * dirSpecularWeight * dirDiffuseWeight );\n}\n#endif\nvec4 totalLight = vec4( ambientLightColor * uAmbientColor, uOpacity );\n#if MAX_DIR_LIGHTS > 0\ntotalLight += dirTotal;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalLight += pointTotal;\n#endif\ngl_FragColor = gl_FragColor * totalLight;",THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:"attribute vec4 tangent;\n#ifdef VERTEX_TEXTURES\nuniform sampler2D tDisplacement;\nuniform float uDisplacementScale;\nuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\nvTangent = normalize( normalMatrix * tangent.xyz );\nvBinormal = cross( vNormal, vTangent ) * tangent.w;\nvBinormal = normalize( vBinormal );\nvUv = uv;\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#ifdef VERTEX_TEXTURES\nvec3 dv = texture2D( tDisplacement, uv ).xyz;\nfloat df = uDisplacementScale * dv.x + uDisplacementBias;\nvec4 displacedPosition = vec4( vNormal.xyz * df, 0.0 ) + mvPosition;\ngl_Position = projectionMatrix * displacedPosition;\n#else\ngl_Position = projectionMatrix * mvPosition;\n#endif\n}"},cube:{uniforms:{tCube:{type:"t",value:1,texture:null}},vertexShader:"varying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 wPos = cameraPosition - vViewPosition;\ngl_FragColor = textureCube( tCube, vec3( - wPos.x, wPos.yz ) );\n}"},convolution:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},uImageIncrement:{type:"v2",value:new THREE.Vector2(.001953125,0)},cKernel:{type:"fv1",value:[]}},vertexShader:"varying vec2 vUv;\nuniform vec2 uImageIncrement;\nvoid main(void) {\nvUv = uv - ((KERNEL_SIZE - 1.0) / 2.0) * uImageIncrement;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform vec2 uImageIncrement;\nuniform float cKernel[KERNEL_SIZE];\nvoid main(void) {\nvec2 imageCoord = vUv;\nvec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );\nfor( int i=0; i<KERNEL_SIZE; ++i ) {\nsum += texture2D( tDiffuse, imageCoord ) * cKernel[i];\nimageCoord += uImageIncrement;\n}\ngl_FragColor = sum;\n}"},film:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},time:{type:"f",value:0},nIntensity:{type:"f",value:.5},sIntensity:{type:"f",value:.05},sCount:{type:"f",value:4096},grayscale:{type:"i",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform float time;\nuniform bool grayscale;\nuniform float nIntensity;\nuniform float sIntensity;\nuniform float sCount;\nvoid main() {\nvec4 cTextureScreen = texture2D( tDiffuse, vUv );\nfloat x = vUv.x * vUv.y * time *  1000.0;\nx = mod( x, 13.0 ) * mod( x, 123.0 );\nfloat dx = mod( x, 0.01 );\nvec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );\nvec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );\ncResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;\ncResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );\nif( grayscale ) {\ncResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );\n}\ngl_FragColor =  vec4( cResult, cTextureScreen.a );\n}"},screen:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},opacity:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform float opacity;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\ngl_FragColor = opacity * texel;\n}"},basic:{uniforms:{},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"void main() {\ngl_FragColor = vec4( 1.0, 0.0, 0.0, 0.5 );\n}"}},buildKernel:function(e){var t,n,o,h,c=2*Math.ceil(3*e)+1;for(c>25&&(c=25),h=(c-1)*.5,n=Array(c),t=o=0;t<c;++t)n[t]=Math.exp(-((t-h)*(t-h))/(2*e*e)),o+=n[t];for(t=0;t<c;++t)n[t]/=o;return n}}),THREE.AnimationHandler=function(){var e=[],t={},n={update:function(t){for(var n=0;n<e.length;n++)e[n].update(t)},addToUpdate:function(t){-1===e.indexOf(t)&&e.push(t)},removeFromUpdate:function(t){-1!==(t=e.indexOf(t))&&e.splice(t,1)},add:function(e){if(void 0!==t[e.name]&&console.log("THREE.AnimationHandler.add: Warning! "+e.name+" already exists in library. Overwriting."),t[e.name]=e,!0!==e.initialized){for(var n=0;n<e.hierarchy.length;n++){for(var o=0;o<e.hierarchy[n].keys.length;o++)if(e.hierarchy[n].keys[o].time<0&&(e.hierarchy[n].keys[o].time=0),void 0!==e.hierarchy[n].keys[o].rot&&!(e.hierarchy[n].keys[o].rot instanceof THREE.Quaternion)){var h=e.hierarchy[n].keys[o].rot;e.hierarchy[n].keys[o].rot=new THREE.Quaternion(h[0],h[1],h[2],h[3])}if(void 0!==e.hierarchy[n].keys[0].morphTargets){for(o=0,h={};o<e.hierarchy[n].keys.length;o++)for(var c=0;c<e.hierarchy[n].keys[o].morphTargets.length;c++){var _=e.hierarchy[n].keys[o].morphTargets[c];h[_]=-1}for(o=0,e.hierarchy[n].usedMorphTargets=h;o<e.hierarchy[n].keys.length;o++){var E={};for(_ in h){for(c=0;c<e.hierarchy[n].keys[o].morphTargets.length;c++)if(e.hierarchy[n].keys[o].morphTargets[c]===_){E[_]=e.hierarchy[n].keys[o].morphTargetsInfluences[c];break}c===e.hierarchy[n].keys[o].morphTargets.length&&(E[_]=0)}e.hierarchy[n].keys[o].morphTargetsInfluences=E}}for(o=1;o<e.hierarchy[n].keys.length;o++)e.hierarchy[n].keys[o].time===e.hierarchy[n].keys[o-1].time&&(e.hierarchy[n].keys.splice(o,1),o--);for(o=1;o<e.hierarchy[n].keys.length;o++)e.hierarchy[n].keys[o].index=o}for(n=0,o=parseInt(e.length*e.fps,10),e.JIT={},e.JIT.hierarchy=[];n<e.hierarchy.length;n++)e.JIT.hierarchy.push(Array(o));e.initialized=!0}},get:function(e){if("string"==typeof e)return t[e]?t[e]:(console.log("THREE.AnimationHandler.get: Couldn't find animation "+e),null)},parse:function(e){var t=[];if(e instanceof THREE.SkinnedMesh)for(var n=0;n<e.bones.length;n++)t.push(e.bones[n]);else o(e,t);return t}},o=function(e,t){t.push(e);for(var n=0;n<e.children.length;n++)o(e.children[n],t)};return n.LINEAR=0,n.CATMULLROM=1,n.CATMULLROM_FORWARD=2,n}(),THREE.Animation=function(e,t,n,o){this.root=e,this.data=THREE.AnimationHandler.get(t),this.hierarchy=THREE.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.loop=this.isPaused=!0,this.interpolationType=void 0!==n?n:THREE.AnimationHandler.LINEAR,this.JITCompile=void 0===o||o,this.points=[],this.target=new THREE.Vector3},THREE.Animation.prototype.play=function(e,t){if(!this.isPlaying){this.isPlaying=!0,this.loop=void 0===e||e,this.currentTime=void 0!==t?t:0;var n,o,h=this.hierarchy.length;for(n=0;n<h;n++){o=this.hierarchy[n],this.interpolationType!==THREE.AnimationHandler.CATMULLROM_FORWARD&&(o.useQuaternion=!0),o.matrixAutoUpdate=!0,void 0===o.animationCache&&(o.animationCache={},o.animationCache.prevKey={pos:0,rot:0,scl:0},o.animationCache.nextKey={pos:0,rot:0,scl:0},o.animationCache.originalMatrix=o instanceof THREE.Bone?o.skinMatrix:o.matrix);var c=o.animationCache.prevKey;o=o.animationCache.nextKey,c.pos=this.data.hierarchy[n].keys[0],c.rot=this.data.hierarchy[n].keys[0],c.scl=this.data.hierarchy[n].keys[0],o.pos=this.getNextKeyWith("pos",n,1),o.rot=this.getNextKeyWith("rot",n,1),o.scl=this.getNextKeyWith("scl",n,1)}this.update(0)}this.isPaused=!1,THREE.AnimationHandler.addToUpdate(this)},THREE.Animation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},THREE.Animation.prototype.stop=function(){this.isPaused=this.isPlaying=!1,THREE.AnimationHandler.removeFromUpdate(this);for(var e=0;e<this.hierarchy.length;e++)void 0!==this.hierarchy[e].animationCache&&(this.hierarchy[e]instanceof THREE.Bone?this.hierarchy[e].skinMatrix=this.hierarchy[e].animationCache.originalMatrix:this.hierarchy[e].matrix=this.hierarchy[e].animationCache.originalMatrix,delete this.hierarchy[e].animationCache)},THREE.Animation.prototype.update=function(e){if(this.isPlaying){var t,n,o,h,c,_,E,f,p,u,m=["pos","rot","scl"],$=this.data.JIT.hierarchy;this.currentTime+=e*this.timeScale,u=this.currentTime,f=parseInt(Math.min((p=this.currentTime%=this.data.length)*this.data.fps,this.data.length*this.data.fps),10);for(var g=0,v=this.hierarchy.length;g<v;g++)if(E=(e=this.hierarchy[g]).animationCache,this.JITCompile&&void 0!==$[g][f])e instanceof THREE.Bone?(e.skinMatrix=$[g][f],e.matrixAutoUpdate=!1,e.matrixWorldNeedsUpdate=!1):(e.matrix=$[g][f],e.matrixAutoUpdate=!1,e.matrixWorldNeedsUpdate=!0);else{this.JITCompile&&(e instanceof THREE.Bone?e.skinMatrix=e.animationCache.originalMatrix:e.matrix=e.animationCache.originalMatrix);for(var T=0;T<3;T++){if(t=m[T],c=E.prevKey[t],(_=E.nextKey[t]).time<=u){if(p<u){if(this.loop)for(c=this.data.hierarchy[g].keys[0],_=this.getNextKeyWith(t,g,1);_.time<p;)c=_,_=this.getNextKeyWith(t,g,_.index+1);else{this.stop();return}}else do c=_,_=this.getNextKeyWith(t,g,_.index+1);while(_.time<p);E.prevKey[t]=c,E.nextKey[t]=_}e.matrixAutoUpdate=!0,e.matrixWorldNeedsUpdate=!0,n=(p-c.time)/(_.time-c.time),o=c[t],h=_[t],(n<0||n>1)&&(console.log("THREE.Animation.update: Warning! Scale out of bounds:"+n+" on bone "+g),n=n<0?0:1),"pos"===t?(t=e.position,this.interpolationType===THREE.AnimationHandler.LINEAR)?(t.x=o[0]+(h[0]-o[0])*n,t.y=o[1]+(h[1]-o[1])*n,t.z=o[2]+(h[2]-o[2])*n):(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD)&&(this.points[0]=this.getPrevKeyWith("pos",g,c.index-1).pos,this.points[1]=o,this.points[2]=h,this.points[3]=this.getNextKeyWith("pos",g,_.index+1).pos,n=.33*n+.33,o=this.interpolateCatmullRom(this.points,n),t.x=o[0],t.y=o[1],t.z=o[2],this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD&&(n=this.interpolateCatmullRom(this.points,1.01*n),this.target.set(n[0],n[1],n[2]),this.target.subSelf(t),this.target.y=0,this.target.normalize(),n=Math.atan2(this.target.x,this.target.z),e.rotation.set(0,n,0))):"rot"===t?THREE.Quaternion.slerp(o,h,e.quaternion,n):"scl"===t&&((t=e.scale).x=o[0]+(h[0]-o[0])*n,t.y=o[1]+(h[1]-o[1])*n,t.z=o[2]+(h[2]-o[2])*n)}}if(this.JITCompile&&void 0===$[0][f])for(this.hierarchy[0].update(void 0,!0),g=0;g<this.hierarchy.length;g++)$[g][f]=this.hierarchy[g]instanceof THREE.Bone?this.hierarchy[g].skinMatrix.clone():this.hierarchy[g].matrix.clone()}},THREE.Animation.prototype.interpolateCatmullRom=function(e,t){var n,o,h,c,_,E,f=[],p=[];return o=Math.floor(n=(e.length-1)*t),n-=o,f[0]=0==o?o:o-1,f[1]=o,f[2]=o>e.length-2?o:o+1,f[3]=o>e.length-3?o:o+2,o=e[f[0]],c=e[f[1]],_=e[f[2]],E=e[f[3]],f=n*n,h=n*f,p[0]=this.interpolate(o[0],c[0],_[0],E[0],n,f,h),p[1]=this.interpolate(o[1],c[1],_[1],E[1],n,f,h),p[2]=this.interpolate(o[2],c[2],_[2],E[2],n,f,h),p},THREE.Animation.prototype.interpolate=function(e,t,n,o,h,c,_){return e=(n-e)*.5,o=(o-t)*.5,(2*(t-n)+e+o)*_+(-3*(t-n)-2*e-o)*c+e*h+t},THREE.Animation.prototype.getNextKeyWith=function(e,t,n){var o=this.data.hierarchy[t].keys;for(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?n=n<o.length-1?n:o.length-1:n%=o.length;n<o.length;n++)if(void 0!==o[n][e])return o[n];return this.data.hierarchy[t].keys[0]},THREE.Animation.prototype.getPrevKeyWith=function(e,t,n){for(var o=this.data.hierarchy[t].keys,n=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?n>0?n:0:n>=0?n:n+o.length;n>=0;n--)if(void 0!==o[n][e])return o[n];return this.data.hierarchy[t].keys[o.length-1]},THREE.FirstPersonCamera=function(e){function t(e,t){return function(){t.apply(e,arguments)}}THREE.Camera.call(this,e.fov,e.aspect,e.near,e.far,e.target),this.movementSpeed=1,this.lookSpeed=.005,this.noFly=!1,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=3.14,this.domElement=document,this.lastUpdate=(new Date).getTime(),this.tdiff=0,e&&(void 0!==e.movementSpeed&&(this.movementSpeed=e.movementSpeed),void 0!==e.lookSpeed&&(this.lookSpeed=e.lookSpeed),void 0!==e.noFly&&(this.noFly=e.noFly),void 0!==e.lookVertical&&(this.lookVertical=e.lookVertical),void 0!==e.autoForward&&(this.autoForward=e.autoForward),void 0!==e.activeLook&&(this.activeLook=e.activeLook),void 0!==e.heightSpeed&&(this.heightSpeed=e.heightSpeed),void 0!==e.heightCoef&&(this.heightCoef=e.heightCoef),void 0!==e.heightMin&&(this.heightMin=e.heightMin),void 0!==e.heightMax&&(this.heightMax=e.heightMax),void 0!==e.constrainVertical&&(this.constrainVertical=e.constrainVertical),void 0!==e.verticalMin&&(this.verticalMin=e.verticalMin),void 0!==e.verticalMax&&(this.verticalMax=e.verticalMax),void 0!==e.domElement&&(this.domElement=e.domElement)),this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=this.autoSpeedFactor=0,this.mouseDragOn=this.freeze=this.moveRight=this.moveLeft=this.moveBackward=this.moveForward=!1,this.windowHalfX=window.innerWidth/2,this.windowHalfY=window.innerHeight/2,this.onMouseDown=function(e){if(e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0},this.onMouseUp=function(e){if(e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1},this.onMouseMove=function(e){this.mouseX=e.clientX-this.windowHalfX,this.mouseY=e.clientY-this.windowHalfY},this.onKeyDown=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0;break;case 81:this.freeze=!this.freeze}},this.onKeyUp=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}},this.update=function(){var e=(new Date).getTime();if(this.tdiff=(e-this.lastUpdate)/1e3,this.lastUpdate=e,!this.freeze){this.autoSpeedFactor=this.heightSpeed?this.tdiff*((this.position.y<this.heightMin?this.heightMin:this.position.y>this.heightMax?this.heightMax:this.position.y)-this.heightMin)*this.heightCoef:0;var t=this.tdiff*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.translateZ(-(t+this.autoSpeedFactor)),this.moveBackward&&this.translateZ(t),this.moveLeft&&this.translateX(-t),this.moveRight&&this.translateX(t),this.moveUp&&this.translateY(t),this.moveDown&&this.translateY(-t),t=this.tdiff*this.lookSpeed,this.activeLook||(t=0),this.lon+=this.mouseX*t,this.lookVertical&&(this.lat-=this.mouseY*t),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=(90-this.lat)*Math.PI/180,this.theta=this.lon*Math.PI/180;var e=this.target.position,n=this.position;e.x=n.x+100*Math.sin(this.phi)*Math.cos(this.theta),e.y=n.y+100*Math.cos(this.phi),e.z=n.z+100*Math.sin(this.phi)*Math.sin(this.theta)}e=1,this.constrainVertical&&(e=3.14/(this.verticalMax-this.verticalMin)),this.lon+=this.mouseX*t,this.lookVertical&&(this.lat-=this.mouseY*t*e),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=(90-this.lat)*Math.PI/180,this.theta=this.lon*Math.PI/180,this.constrainVertical&&(this.phi=(this.phi-0)*(this.verticalMax-this.verticalMin)/3.14+this.verticalMin),e=this.target.position,n=this.position,e.x=n.x+100*Math.sin(this.phi)*Math.cos(this.theta),e.y=n.y+100*Math.cos(this.phi),e.z=n.z+100*Math.sin(this.phi)*Math.sin(this.theta),this.supr.update.call(this)},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousemove",t(this,this.onMouseMove),!1),this.domElement.addEventListener("mousedown",t(this,this.onMouseDown),!1),this.domElement.addEventListener("mouseup",t(this,this.onMouseUp),!1),this.domElement.addEventListener("keydown",t(this,this.onKeyDown),!1),this.domElement.addEventListener("keyup",t(this,this.onKeyUp),!1)},THREE.FirstPersonCamera.prototype=new THREE.Camera,THREE.FirstPersonCamera.prototype.constructor=THREE.FirstPersonCamera,THREE.FirstPersonCamera.prototype.supr=THREE.Camera.prototype,THREE.FirstPersonCamera.prototype.translate=function(e,t){this.matrix.rotateAxis(t),this.noFly&&(t.y=0),this.position.addSelf(t.multiplyScalar(e)),this.target.position.addSelf(t.multiplyScalar(e))},THREE.PathCamera=function(e){function t(e,t,n,o){var h,c={name:n,fps:.6,length:o,hierarchy:[]},_=t.getControlPointsArray(),E=t.getLength(),f=_.length,p=0;for(h=f-1,(t={parent:-1,keys:[]}).keys[0]={time:0,pos:_[0],rot:[0,0,0,1],scl:[1,1,1]},t.keys[h]={time:o,pos:_[h],rot:[0,0,0,1],scl:[1,1,1]},h=1;h<f-1;h++)p=o*E.chunks[h]/E.total,t.keys[h]={time:p,pos:_[h]};return c.hierarchy[0]=t,THREE.AnimationHandler.add(c),new THREE.Animation(e,n,THREE.AnimationHandler.CATMULLROM_FORWARD,!1)}function n(e,t){var n,o,h=new THREE.Geometry;for(n=0;n<e.points.length*t;n++)o=n/(e.points.length*t),o=e.getPoint(o),h.vertices[n]=new THREE.Vertex(new THREE.Vector3(o.x,o.y,o.z));return h}THREE.Camera.call(this,e.fov,e.aspect,e.near,e.far,e.target),this.id="PathCamera"+THREE.PathCameraIdCounter++,this.duration=1e4,this.waypoints=[],this.useConstantSpeed=!0,this.resamplingCoef=50,this.debugPath=new THREE.Object3D,this.debugDummy=new THREE.Object3D,this.animationParent=new THREE.Object3D,this.lookSpeed=.005,this.lookHorizontal=this.lookVertical=!0,this.verticalAngleMap={srcRange:[0,6.28],dstRange:[0,6.28]},this.horizontalAngleMap={srcRange:[0,6.28],dstRange:[0,6.28]},this.domElement=document,e&&(void 0!==e.duration&&(this.duration=1e3*e.duration),void 0!==e.waypoints&&(this.waypoints=e.waypoints),void 0!==e.useConstantSpeed&&(this.useConstantSpeed=e.useConstantSpeed),void 0!==e.resamplingCoef&&(this.resamplingCoef=e.resamplingCoef),void 0!==e.createDebugPath&&(this.createDebugPath=e.createDebugPath),void 0!==e.createDebugDummy&&(this.createDebugDummy=e.createDebugDummy),void 0!==e.lookSpeed&&(this.lookSpeed=e.lookSpeed),void 0!==e.lookVertical&&(this.lookVertical=e.lookVertical),void 0!==e.lookHorizontal&&(this.lookHorizontal=e.lookHorizontal),void 0!==e.verticalAngleMap&&(this.verticalAngleMap=e.verticalAngleMap),void 0!==e.horizontalAngleMap&&(this.horizontalAngleMap=e.horizontalAngleMap),void 0!==e.domElement&&(this.domElement=e.domElement)),this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=0,this.windowHalfX=window.innerWidth/2,this.windowHalfY=window.innerHeight/2;var o,h,c=2*Math.PI,_=Math.PI/180;if(this.update=function(e,t,n){this.lookHorizontal&&(this.lon+=this.mouseX*this.lookSpeed),this.lookVertical&&(this.lat-=this.mouseY*this.lookSpeed),this.lon=Math.max(0,Math.min(360,this.lon)),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=(90-this.lat)*_,this.theta=this.lon*_,o=this.phi%c,this.phi=o>=0?o:o+c,o=this.verticalAngleMap.srcRange;var o,h,E=(h=this.verticalAngleMap.dstRange)[1]-h[0];this.phi=TWEEN.Easing.Quadratic.EaseInOut(((this.phi-o[0])*(h[1]-h[0])/(o[1]-o[0])+h[0]-h[0])/E)*E+h[0],o=this.horizontalAngleMap.srcRange,E=(h=this.horizontalAngleMap.dstRange)[1]-h[0],this.theta=TWEEN.Easing.Quadratic.EaseInOut(((this.theta-o[0])*(h[1]-h[0])/(o[1]-o[0])+h[0]-h[0])/E)*E+h[0],(o=this.target.position).x=100*Math.sin(this.phi)*Math.cos(this.theta),o.y=100*Math.cos(this.phi),o.z=100*Math.sin(this.phi)*Math.sin(this.theta),this.supr.update.call(this,e,t,n)},this.onMouseMove=function(e){this.mouseX=e.clientX-this.windowHalfX,this.mouseY=e.clientY-this.windowHalfY},this.spline=new THREE.Spline,this.spline.initFromArray(this.waypoints),this.useConstantSpeed&&this.spline.reparametrizeByArcLength(this.resamplingCoef),this.createDebugDummy){var e=new THREE.MeshLambertMaterial({color:30719}),E=new THREE.MeshLambertMaterial({color:65280}),f=new THREE.CubeGeometry(10,10,20),p=new THREE.CubeGeometry(2,2,10);this.animationParent=new THREE.Mesh(f,e),(e=new THREE.Mesh(p,E)).position.set(0,10,0),this.animation=t(this.animationParent,this.spline,this.id,this.duration),this.animationParent.addChild(this),this.animationParent.addChild(this.target),this.animationParent.addChild(e)}else this.animation=t(this.animationParent,this.spline,this.id,this.duration),this.animationParent.addChild(this.target),this.animationParent.addChild(this);this.createDebugPath&&function e(t,o){var h=n(o,10),c=n(o,10),_=new THREE.LineBasicMaterial({color:16711680,linewidth:3});for(lineObj=new THREE.Line(h,_),particleObj=new THREE.ParticleSystem(c,new THREE.ParticleBasicMaterial({color:16755200,size:3})),lineObj.scale.set(1,1,1),t.addChild(lineObj),particleObj.scale.set(1,1,1),t.addChild(particleObj),c=new THREE.SphereGeometry(1,16,8),_=new THREE.MeshBasicMaterial({color:65280}),i=0;i<o.points.length;i++)(h=new THREE.Mesh(c,_)).position.copy(o.points[i]),h.updateMatrix(),t.addChild(h)}(this.debugPath,this.spline),this.domElement.addEventListener("mousemove",(o=this,h=this.onMouseMove,function(){h.apply(o,arguments)}),!1)},THREE.PathCamera.prototype=new THREE.Camera,THREE.PathCamera.prototype.constructor=THREE.PathCamera,THREE.PathCamera.prototype.supr=THREE.Camera.prototype,THREE.PathCameraIdCounter=0,THREE.FlyCamera=function(e){function t(e,t){return function(){t.apply(e,arguments)}}THREE.Camera.call(this,e.fov,e.aspect,e.near,e.far,e.target),this.tmpQuaternion=new THREE.Quaternion,this.movementSpeed=1,this.rollSpeed=.005,this.autoForward=this.dragToLook=!1,this.domElement=document,e&&(void 0!==e.movementSpeed&&(this.movementSpeed=e.movementSpeed),void 0!==e.rollSpeed&&(this.rollSpeed=e.rollSpeed),void 0!==e.dragToLook&&(this.dragToLook=e.dragToLook),void 0!==e.autoForward&&(this.autoForward=e.autoForward),void 0!==e.domElement&&(this.domElement=e.domElement)),this.useTarget=!1,this.useQuaternion=!0,this.mouseStatus=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new THREE.Vector3(0,0,0),this.rotationVector=new THREE.Vector3(0,0,0),this.lastUpdate=-1,this.tdiff=0,this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)},this.keydown=function(e){if(!e.altKey){switch(e.keyCode){case 16:this.movementSpeedMultiplier=.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(e){switch(e.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector(),this.updateRotationVector()},this.mousedown=function(e){if(e.preventDefault(),e.stopPropagation(),this.dragToLook)this.mouseStatus++;else switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}},this.mousemove=function(e){if(!this.dragToLook||this.mouseStatus>0){var t=this.getContainerDimensions(),n=t.size[0]/2,o=t.size[1]/2;this.moveState.yawLeft=-(e.clientX-t.offset[0]-n)/n,this.moveState.pitchDown=(e.clientY-t.offset[1]-o)/o,this.updateRotationVector()}},this.mouseup=function(e){if(e.preventDefault(),e.stopPropagation(),this.dragToLook)this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0;else switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.updateRotationVector()},this.update=function(){var e=(new Date).getTime();-1==this.lastUpdate&&(this.lastUpdate=e),this.tdiff=(e-this.lastUpdate)/1e3,this.lastUpdate=e;var e=this.tdiff*this.movementSpeed,t=this.tdiff*this.rollSpeed;this.translateX(this.moveVector.x*e),this.translateY(this.moveVector.y*e),this.translateZ(this.moveVector.z*e),this.tmpQuaternion.set(this.rotationVector.x*t,this.rotationVector.y*t,this.rotationVector.z*t,1).normalize(),this.quaternion.multiplySelf(this.tmpQuaternion),this.matrix.setPosition(this.position),this.matrix.setRotationFromQuaternion(this.quaternion),this.matrixWorldNeedsUpdate=!0,this.supr.update.call(this)},this.updateMovementVector=function(){var e=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-e+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.domElement.addEventListener("mousemove",t(this,this.mousemove),!1),this.domElement.addEventListener("mousedown",t(this,this.mousedown),!1),this.domElement.addEventListener("mouseup",t(this,this.mouseup),!1),window.addEventListener("keydown",t(this,this.keydown),!1),window.addEventListener("keyup",t(this,this.keyup),!1),this.updateMovementVector(),this.updateRotationVector()},THREE.FlyCamera.prototype=new THREE.Camera,THREE.FlyCamera.prototype.constructor=THREE.FlyCamera,THREE.FlyCamera.prototype.supr=THREE.Camera.prototype,THREE.RollCamera=function(e,t,n,o){THREE.Camera.call(this,e,t,n,o),this.mouseLook=!0,this.autoForward=!1,this.rollSpeed=this.movementSpeed=this.lookSpeed=1,this.constrainVertical=[-.9,.9],this.domElement=document,this.matrixAutoUpdate=this.useTarget=!1,this.forward=new THREE.Vector3(0,0,1),this.roll=0,this.lastUpdate=-1,this.delta=0;var h=new THREE.Vector3,c=new THREE.Vector3,_=new THREE.Vector3,E=new THREE.Matrix4,f=!1,p=1,u=0,m=0,$=0,g=0,v=0,T=window.innerWidth/2,y=window.innerHeight/2;this.update=function(){var e=(new Date).getTime();-1==this.lastUpdate&&(this.lastUpdate=e),this.delta=(e-this.lastUpdate)/1e3,this.lastUpdate=e,this.mouseLook&&(e=this.delta*this.lookSpeed,this.rotateHorizontally(e*g),this.rotateVertically(e*v)),e=this.delta*this.movementSpeed,this.translateZ(e*(u>0||this.autoForward&&!(u<0)?1:u)),this.translateX(e*m),this.translateY(e*$),f&&(this.roll+=this.rollSpeed*this.delta*p),this.forward.y>this.constrainVertical[1]?(this.forward.y=this.constrainVertical[1],this.forward.normalize()):this.forward.y<this.constrainVertical[0]&&(this.forward.y=this.constrainVertical[0],this.forward.normalize()),_.copy(this.forward),c.set(0,1,0),h.cross(c,_).normalize(),c.cross(_,h).normalize(),this.matrix.n11=h.x,this.matrix.n12=c.x,this.matrix.n13=_.x,this.matrix.n21=h.y,this.matrix.n22=c.y,this.matrix.n23=_.y,this.matrix.n31=h.z,this.matrix.n32=c.z,this.matrix.n33=_.z,E.identity(),E.n11=Math.cos(this.roll),E.n12=-Math.sin(this.roll),E.n21=Math.sin(this.roll),E.n22=Math.cos(this.roll),this.matrix.multiplySelf(E),this.matrixWorldNeedsUpdate=!0,this.matrix.n14=this.position.x,this.matrix.n24=this.position.y,this.matrix.n34=this.position.z,this.supr.update.call(this)},this.translateX=function(e){this.position.x+=this.matrix.n11*e,this.position.y+=this.matrix.n21*e,this.position.z+=this.matrix.n31*e},this.translateY=function(e){this.position.x+=this.matrix.n12*e,this.position.y+=this.matrix.n22*e,this.position.z+=this.matrix.n32*e},this.translateZ=function(e){this.position.x-=this.matrix.n13*e,this.position.y-=this.matrix.n23*e,this.position.z-=this.matrix.n33*e},this.rotateHorizontally=function(e){h.set(this.matrix.n11,this.matrix.n21,this.matrix.n31),h.multiplyScalar(e),this.forward.subSelf(h),this.forward.normalize()},this.rotateVertically=function(e){c.set(this.matrix.n12,this.matrix.n22,this.matrix.n32),c.multiplyScalar(e),this.forward.addSelf(c),this.forward.normalize()},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousemove",function(e){g=(e.clientX-T)/window.innerWidth,v=(e.clientY-y)/window.innerHeight},!1),this.domElement.addEventListener("mousedown",function(e){switch(e.preventDefault(),e.stopPropagation(),e.button){case 0:u=1;break;case 2:u=-1}},!1),this.domElement.addEventListener("mouseup",function(e){switch(e.preventDefault(),e.stopPropagation(),e.button){case 0:case 2:u=0}},!1),this.domElement.addEventListener("keydown",function(e){switch(e.keyCode){case 38:case 87:u=1;break;case 37:case 65:m=-1;break;case 40:case 83:u=-1;break;case 39:case 68:m=1;break;case 81:f=!0,p=1;break;case 69:f=!0,p=-1;break;case 82:$=1;break;case 70:$=-1}},!1),this.domElement.addEventListener("keyup",function(e){switch(e.keyCode){case 38:case 87:case 40:case 83:u=0;break;case 37:case 65:case 39:case 68:m=0;break;case 81:case 69:f=!1;break;case 82:case 70:$=0}},!1)},THREE.RollCamera.prototype=new THREE.Camera,THREE.RollCamera.prototype.constructor=THREE.RollCamera,THREE.RollCamera.prototype.supr=THREE.Camera.prototype,THREE.TrackballCamera=function(e){function t(e,t){return function(){t.apply(e,arguments)}}e=e||{},THREE.Camera.call(this,e.fov,e.aspect,e.near,e.far,e.target),this.domElement=e.domElement||document,this.screen=e.screen||{width:window.innerWidth,height:window.innerHeight,offsetLeft:0,offsetTop:0},this.radius=e.radius||(this.screen.width+this.screen.height)/4,this.rotateSpeed=e.rotateSpeed||1,this.zoomSpeed=e.zoomSpeed||1.2,this.panSpeed=e.panSpeed||.3,this.noZoom=e.noZoom||!1,this.noPan=e.noPan||!1,this.staticMoving=e.staticMoving||!1,this.dynamicDampingFactor=e.dynamicDampingFactor||.2,this.minDistance=e.minDistance||0,this.maxDistance=e.maxDistance||1/0,this.keys=e.keys||[65,83,68],this.useTarget=!0;var n=!1,o=this.STATE.NONE,h=new THREE.Vector3,c=new THREE.Vector3,_=new THREE.Vector3,E=new THREE.Vector2,f=new THREE.Vector2,p=new THREE.Vector2,u=new THREE.Vector2;this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)},this.getMouseOnScreen=function(e,t){return new THREE.Vector2((e-this.screen.offsetLeft)/this.radius*.5,(t-this.screen.offsetTop)/this.radius*.5)},this.getMouseProjectionOnBall=function(e,t){var n=new THREE.Vector3((e-.5*this.screen.width-this.screen.offsetLeft)/this.radius,(.5*this.screen.height+this.screen.offsetTop-t)/this.radius,0),o=n.length();return o>1?n.normalize():n.z=Math.sqrt(1-o*o),h=this.position.clone().subSelf(this.target.position),(o=this.up.clone().setLength(n.y)).addSelf(this.up.clone().crossSelf(h).setLength(n.x)),o.addSelf(h.setLength(n.z)),o},this.rotateCamera=function(){var e=Math.acos(c.dot(_)/c.length()/_.length());if(e){var t=(new THREE.Vector3).cross(c,_).normalize(),n=new THREE.Quaternion;e*=this.rotateSpeed,n.setFromAxisAngle(t,-e),n.multiplyVector3(h),n.multiplyVector3(this.up),n.multiplyVector3(_),this.staticMoving?c=_:(n.setFromAxisAngle(t,e*(this.dynamicDampingFactor-1)),n.multiplyVector3(c))}},this.zoomCamera=function(){var e=1+(f.y-E.y)*this.zoomSpeed;1!==e&&e>0&&(h.multiplyScalar(e),this.staticMoving?E=f:E.y+=(f.y-E.y)*this.dynamicDampingFactor)},this.panCamera=function(){var e=u.clone().subSelf(p);if(e.lengthSq()){e.multiplyScalar(h.length()*this.panSpeed);var t=h.clone().crossSelf(this.up).setLength(e.x);t.addSelf(this.up.clone().setLength(e.y)),this.position.addSelf(t),this.target.position.addSelf(t),this.staticMoving?p=u:p.addSelf(e.sub(u,p).multiplyScalar(this.dynamicDampingFactor))}},this.checkDistances=function(){this.noZoom&&this.noPan||(this.position.lengthSq()>this.maxDistance*this.maxDistance&&this.position.setLength(this.maxDistance),h.lengthSq()<this.minDistance*this.minDistance&&this.position.add(this.target.position,h.setLength(this.minDistance)))},this.update=function(e,t,n){h=this.position.clone().subSelf(this.target.position),this.rotateCamera(),this.noZoom||this.zoomCamera(),this.noPan||this.panCamera(),this.position.add(this.target.position,h),this.checkDistances(),this.supr.update.call(this,e,t,n)},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousemove",t(this,function(e){n&&(c=_=this.getMouseProjectionOnBall(e.clientX,e.clientY),E=f=this.getMouseOnScreen(e.clientX,e.clientY),p=u=this.getMouseOnScreen(e.clientX,e.clientY),n=!1),o===this.STATE.NONE||(o===this.STATE.ROTATE?_=this.getMouseProjectionOnBall(e.clientX,e.clientY):o!==this.STATE.ZOOM||this.noZoom?o!==this.STATE.PAN||this.noPan||(u=this.getMouseOnScreen(e.clientX,e.clientY)):f=this.getMouseOnScreen(e.clientX,e.clientY))}),!1),this.domElement.addEventListener("mousedown",t(this,function(e){e.preventDefault(),e.stopPropagation(),o===this.STATE.NONE&&((o=e.button)===this.STATE.ROTATE?c=_=this.getMouseProjectionOnBall(e.clientX,e.clientY):o!==this.STATE.ZOOM||this.noZoom?this.noPan||(p=u=this.getMouseOnScreen(e.clientX,e.clientY)):E=f=this.getMouseOnScreen(e.clientX,e.clientY))}),!1),this.domElement.addEventListener("mouseup",t(this,function(e){e.preventDefault(),e.stopPropagation(),o=this.STATE.NONE}),!1),window.addEventListener("keydown",t(this,function(e){o===this.STATE.NONE&&(e.keyCode===this.keys[this.STATE.ROTATE]?o=this.STATE.ROTATE:e.keyCode!==this.keys[this.STATE.ZOOM]||this.noZoom?e.keyCode!==this.keys[this.STATE.PAN]||this.noPan||(o=this.STATE.PAN):o=this.STATE.ZOOM,o!==this.STATE.NONE&&(n=!0))}),!1),window.addEventListener("keyup",t(this,function(){o!==this.STATE.NONE&&(o=this.STATE.NONE)}),!1)},THREE.TrackballCamera.prototype=new THREE.Camera,THREE.TrackballCamera.prototype.constructor=THREE.TrackballCamera,THREE.TrackballCamera.prototype.supr=THREE.Camera.prototype,THREE.TrackballCamera.prototype.STATE={NONE:-1,ROTATE:0,ZOOM:1,PAN:2},THREE.QuakeCamera=THREE.FirstPersonCamera,THREE.Curve=function(){},THREE.Curve.prototype.getPoint=function(){return console.log("Warning, getPoint() not implemented!"),null},THREE.Curve.prototype.getPointAt=function(e){return this.getPoint(this.getUtoTmapping(e))},THREE.Curve.prototype.getPoints=function(e){e||(e=5);var t,n=[];for(t=0;t<=e;t++)n.push(this.getPoint(t/e));return n},THREE.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,n=[];for(t=0;t<=e;t++)n.push(this.getPointAt(t/e));return n},THREE.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},THREE.Curve.prototype.getLengths=function(e){if(e||(e=200),this.cacheArcLengths&&this.cacheArcLengths.length==e+1)return this.cacheArcLengths;var t,n,o=[],h=this.getPoint(0),c=0;for(o.push(0),n=1;n<=e;n++)o.push(c+=(t=this.getPoint(n/e)).distanceTo(h)),h=t;return this.cacheArcLengths=o},THREE.Curve.prototype.getUtoTmapping=function(e,t){var n,o=this.getLengths(),h=0,c=o.length;n=t||e*o[c-1],time=Date.now();for(var _,E=0,f=c-1;E<=f;)if((_=o[h=Math.floor(E+(f-E)/2)]-n)<0)E=h+1;else if(_>0)f=h-1;else{f=h;break}return o[h=f]==n?h/(c-1):(E=o[h],(h+(n-E)/(o[h+1]-E))/(c-1))},THREE.Curve.prototype.getNormalVector=function(e){return e=this.getTangent(e),new THREE.Vector2(-e.y,e.x)},THREE.Curve.prototype.getTangent=function(e){var t=e-1e-4;t<0&&(t=0),(e+=1e-4)>1&&(e=1);var t=this.getPoint(t),e=this.getPoint(e),n=new THREE.Vector2;return n.sub(e,t),n.unit()},THREE.LineCurve=function(e,t){e instanceof THREE.Vector2?(this.v1=e,this.v2=t):THREE.LineCurve.oldConstructor.apply(this,arguments)},THREE.LineCurve.oldConstructor=function(e,t,n,o){this.constructor(new THREE.Vector2(e,t),new THREE.Vector2(n,o))},THREE.LineCurve.prototype=new THREE.Curve,THREE.LineCurve.prototype.constructor=THREE.LineCurve,THREE.LineCurve.prototype.getPoint=function(e){var t=new THREE.Vector2;return t.sub(this.v2,this.v1),t.multiplyScalar(e).addSelf(this.v1),t},THREE.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},THREE.LineCurve.prototype.getTangent=function(){var e=new THREE.Vector2;return e.sub(this.v2,this.v1),e.normalize(),e},THREE.QuadraticBezierCurve=function(e,t,n){if(!(t instanceof THREE.Vector2))var o=Array.prototype.slice.call(arguments),e=new THREE.Vector2(o[0],o[1]),t=new THREE.Vector2(o[2],o[3]),n=new THREE.Vector2(o[4],o[5]);this.v0=e,this.v1=t,this.v2=n},THREE.QuadraticBezierCurve.prototype=new THREE.Curve,THREE.QuadraticBezierCurve.prototype.constructor=THREE.QuadraticBezierCurve,THREE.QuadraticBezierCurve.prototype.getPoint=function(e){var t;return t=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),e=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),new THREE.Vector2(t,e)},THREE.QuadraticBezierCurve.prototype.getTangent=function(e){var t;return t=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x),e=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y),(t=new THREE.Vector2(t,e)).normalize(),t},THREE.CubicBezierCurve=function(e,t,n,o){if(!(t instanceof THREE.Vector2))var h=Array.prototype.slice.call(arguments),e=new THREE.Vector2(h[0],h[1]),t=new THREE.Vector2(h[2],h[3]),n=new THREE.Vector2(h[4],h[5]),o=new THREE.Vector2(h[6],h[7]);this.v0=e,this.v1=t,this.v2=n,this.v3=o},THREE.CubicBezierCurve.prototype=new THREE.Curve,THREE.CubicBezierCurve.prototype.constructor=THREE.CubicBezierCurve,THREE.CubicBezierCurve.prototype.getPoint=function(e){var t;return t=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),e=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new THREE.Vector2(t,e)},THREE.CubicBezierCurve.prototype.getTangent=function(e){var t;return t=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),e=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),(t=new THREE.Vector2(t,e)).normalize(),t},THREE.SplineCurve=function(e){this.points=e},THREE.SplineCurve.prototype=new THREE.Curve,THREE.SplineCurve.prototype.constructor=THREE.SplineCurve,THREE.SplineCurve.prototype.getPoint=function(e){var t,n=new THREE.Vector2,o=[],h=this.points;return e=Math.floor(t=(h.length-1)*e),t-=e,o[0]=0==e?e:e-1,o[1]=e,o[2]=e>h.length-2?e:e+1,o[3]=e>h.length-3?e:e+2,n.x=THREE.Curve.Utils.interpolate(h[o[0]].x,h[o[1]].x,h[o[2]].x,h[o[3]].x,t),n.y=THREE.Curve.Utils.interpolate(h[o[0]].y,h[o[1]].y,h[o[2]].y,h[o[3]].y,t),n},THREE.ArcCurve=function(e,t,n,o,h,c){this.aX=e,this.aY=t,this.aRadius=n,this.aStartAngle=o,this.aEndAngle=h,this.aClockwise=c},THREE.ArcCurve.prototype=new THREE.Curve,THREE.ArcCurve.prototype.constructor=THREE.ArcCurve,THREE.ArcCurve.prototype.getPoint=function(e){var t=this.aEndAngle-this.aStartAngle;return this.aClockwise||(e=1-e),e=this.aStartAngle+e*t,new THREE.Vector2(this.aX+this.aRadius*Math.cos(e),this.aY+this.aRadius*Math.sin(e))},THREE.Curve.Utils={tangentQuadraticBezier:function(e,t,n,o){return 2*(1-e)*(n-t)+2*e*(o-n)},tangentCubicBezier:function(e,t,n,o,h){return -3*t*(1-e)*(1-e)+3*n*(1-e)*(1-e)-6*e*n*(1-e)+6*e*o*(1-e)-3*e*e*o+3*e*e*h},tangentSpline:function(e){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},interpolate:function(e,t,n,o,h){var e=(n-e)*.5,o=(o-t)*.5,c=h*h;return(2*t-2*n+e+o)*h*c+(-3*t+3*n-2*e-o)*c+e*h+t}},THREE.Curve.create=function(e,t){return e.prototype=new THREE.Curve,e.prototype.constructor=e,e.prototype.getPoint=t,e},THREE.LineCurve3=THREE.Curve.create(function(e,t){this.v1=e,this.v2=t},function(e){var t=new THREE.Vector3;return t.sub(v2,v1),t.multiplyScalar(e),t.addSelf(this.v1),t}),THREE.QuadraticBezierCurve3=THREE.Curve.create(function(e,t,n){this.v0=e,this.v1=t,this.v2=n},function(e){var t,n;return t=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),n=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),e=THREE.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),new THREE.Vector3(t,n,e)}),THREE.CurvePath=function(){this.curves=[],this.bends=[]},THREE.CurvePath.prototype=new THREE.Curve,THREE.CurvePath.prototype.constructor=THREE.CurvePath,THREE.CurvePath.prototype.add=function(e){this.curves.push(e)},THREE.CurvePath.prototype.checkConnection=function(){},THREE.CurvePath.prototype.closePath=function(){},THREE.CurvePath.prototype.getPoint=function(e){for(var t=e*this.getLength(),n=this.getCurveLengths(),e=0;e<n.length;){if(n[e]>=t)return t=1-(t=n[e]-t)/(e=this.curves[e]).getLength(),e.getPointAt(t);e++}return null},THREE.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e,t=[],n=0,o=this.curves.length;for(e=0;e<o;e++)t.push(n+=this.curves[e].getLength());return this.cacheLengths=t},THREE.CurvePath.prototype.getBoundingBox=function(){var e,t,n,o,h,c,_,E,f=this.getPoints();for(h=c=Number.NEGATIVE_INFINITY,_=E=Number.POSITIVE_INFINITY,o=new THREE.Vector2,t=0,n=f.length;t<n;t++)(e=f[t]).x>h?h=e.x:e.x<_&&(_=e.x),e.y>c?c=e.y:e.y<c&&(E=e.y),o.addSelf(e.x,e.y);return{minX:_,minY:E,maxX:h,maxY:c,centroid:o.divideScalar(n)}},THREE.CurvePath.prototype.createPointsGeometry=function(e){return this.createGeometry(this.getPoints(e,!0))},THREE.CurvePath.prototype.createSpacedPointsGeometry=function(e){return this.createGeometry(this.getSpacedPoints(e,!0))},THREE.CurvePath.prototype.createGeometry=function(e){for(var t=new THREE.Geometry,n=0;n<e.length;n++)t.vertices.push(new THREE.Vertex(new THREE.Vector3(e[n].x,e[n].y,0)));return t},THREE.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},THREE.CurvePath.prototype.getTransformedPoints=function(e,t){var n,o,h=this.getPoints(e);for(t||(t=this.bends),n=0,o=t.length;n<o;n++)h=this.getWrapPoints(h,t[n]);return h},THREE.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var n,o,h=this.getSpacedPoints(e);for(t||(t=this.bends),n=0,o=t.length;n<o;n++)h=this.getWrapPoints(h,t[n]);return h},THREE.CurvePath.prototype.getWrapPoints=function(e,t){var n,o,h,c,_,E,f=this.getBoundingBox();for(n=0,o=e.length;n<o;n++)c=(h=e[n]).x,_=h.y,E=c/f.maxX,E=t.getUtoTmapping(E,c),c=t.getPoint(E),_=t.getNormalVector(E).multiplyScalar(_),h.x=c.x+_.x,h.y=c.y+_.y;return e},THREE.Path=function(e){THREE.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},THREE.Path.prototype=new THREE.CurvePath,THREE.Path.prototype.constructor=THREE.Path,THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc"},THREE.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);var t,n=e.length;for(t=1;t<n;t++)this.lineTo(e[t].x,e[t].y)},THREE.Path.prototype.moveTo=function(){var e=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:e})},THREE.Path.prototype.lineTo=function(e,t){var n=Array.prototype.slice.call(arguments),o=this.actions[this.actions.length-1].args;this.curves.push(new THREE.LineCurve(new THREE.Vector2(o[o.length-2],o[o.length-1]),new THREE.Vector2(e,t))),this.actions.push({action:THREE.PathActions.LINE_TO,args:n})},THREE.Path.prototype.quadraticCurveTo=function(e,t,n,o){var h=Array.prototype.slice.call(arguments),c=this.actions[this.actions.length-1].args;this.curves.push(new THREE.QuadraticBezierCurve(new THREE.Vector2(c[c.length-2],c[c.length-1]),new THREE.Vector2(e,t),new THREE.Vector2(n,o))),this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:h})},THREE.Path.prototype.bezierCurveTo=function(e,t,n,o,h,c){var _=Array.prototype.slice.call(arguments),E=this.actions[this.actions.length-1].args;this.curves.push(new THREE.CubicBezierCurve(new THREE.Vector2(E[E.length-2],E[E.length-1]),new THREE.Vector2(e,t),new THREE.Vector2(n,o),new THREE.Vector2(h,c))),this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:_})},THREE.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),n=this.actions[this.actions.length-1].args,n=[new THREE.Vector2(n[n.length-2],n[n.length-1])],n=n.concat(e);this.curves.push(new THREE.SplineCurve(n)),this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:t})},THREE.Path.prototype.arc=function(e,t,n,o,h,c){var _=Array.prototype.slice.call(arguments);this.curves.push(new THREE.ArcCurve(e,t,n,o,h,c)),this.actions.push({action:THREE.PathActions.ARC,args:_})},THREE.Path.prototype.getSpacedPoints=function(e){e||(e=40);for(var t=[],n=0;n<e;n++)t.push(this.getPoint(n/e));return t},THREE.Path.prototype.getPoints=function(e,t){var n,o,h,c,_,E,f,p,u,m,$,g,v,e=e||12,T=[];for(n=0,o=this.actions.length;n<o;n++)switch(c=(h=this.actions[n]).action,h=h.args,c){case THREE.PathActions.LINE_TO:T.push(new THREE.Vector2(h[0],h[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:for(_=h[2],E=h[3],u=h[0],m=h[1],T.length>0?($=(c=T[T.length-1]).x,g=c.y):($=(c=this.actions[n-1].args)[c.length-2],g=c[c.length-1]),c=1;c<=e;c++)v=c/e,h=THREE.Shape.Utils.b2(v,$,u,_),v=THREE.Shape.Utils.b2(v,g,m,E),T.push(new THREE.Vector2(h,v));break;case THREE.PathActions.BEZIER_CURVE_TO:for(_=h[4],E=h[5],u=h[0],m=h[1],f=h[2],p=h[3],T.length>0?($=(c=T[T.length-1]).x,g=c.y):($=(c=this.actions[n-1].args)[c.length-2],g=c[c.length-1]),c=1;c<=e;c++)v=c/e,h=THREE.Shape.Utils.b3(v,$,u,f,_),v=THREE.Shape.Utils.b3(v,g,m,p,E),T.push(new THREE.Vector2(h,v));break;case THREE.PathActions.CSPLINE_THRU:for(c=this.actions[n-1].args,c=[new THREE.Vector2(c[c.length-2],c[c.length-1])],v=e*h[0].length,c=c.concat(h[0]),h=new THREE.SplineCurve(c),c=1;c<=v;c++)T.push(h.getPointAt(c/v));break;case THREE.PathActions.ARC:c=this.actions[n-1].args,_=h[0],E=h[1],f=h[2],u=h[3],v=h[4],m=!!h[5],p=c[c.length-2],$=c[c.length-1],0==c.length&&(p=$=0),g=v-u;var y=2*e;for(c=1;c<=y;c++)v=c/y,m||(v=1-v),h=p+_+f*Math.cos(v=u+v*g),v=$+E+f*Math.sin(v),T.push(new THREE.Vector2(h,v))}return t&&T.push(T[0]),T},THREE.Path.prototype.transform=function(e,t){return this.getBoundingBox(),this.getWrapPoints(this.getPoints(t),e)},THREE.Path.prototype.nltransform=function(e,t,n,o,h,c){var _,E,f,p,u,m=this.getPoints();for(_=0,E=m.length;_<E;_++)p=(f=m[_]).x,u=f.y,f.x=e*p+t*u+n,f.y=o*u+h*p+c;return m},THREE.Path.prototype.debug=function(e){var t=this.getBoundingBox();e||((e=document.createElement("canvas")).setAttribute("width",t.maxX+100),e.setAttribute("height",t.maxY+100),document.body.appendChild(e)),(t=e.getContext("2d")).fillStyle="white",t.fillRect(0,0,e.width,e.height),t.strokeStyle="black",t.beginPath();var n,o,h,e=0;for(n=this.actions.length;e<n;e++)h=(o=this.actions[e]).args,(o=o.action)!=THREE.PathActions.CSPLINE_THRU&&t[o].apply(t,h);for(t.stroke(),t.closePath(),t.strokeStyle="red",o=this.getPoints(),e=0,n=o.length;e<n;e++)h=o[e],t.beginPath(),t.arc(h.x,h.y,1.5,0,2*Math.PI,!1),t.stroke(),t.closePath()},THREE.Path.prototype.toShapes=function(){var e,t,n,o,h=[],c=new THREE.Path;for(e=0,t=this.actions.length;e<t;e++)o=(n=this.actions[e]).args,(n=n.action)==THREE.PathActions.MOVE_TO&&0!=c.actions.length&&(h.push(c),c=new THREE.Path),c[n].apply(c,o);if(0!=c.actions.length&&h.push(c),0==h.length)return[];var _,c=[];if(THREE.Shape.Utils.isClockWise(h[0].getPoints())){for(e=0,t=h.length;e<t;e++)o=h[e],THREE.Shape.Utils.isClockWise(o.getPoints())?(_&&c.push(_),(_=new THREE.Shape).actions=o.actions,_.curves=o.curves):_.holes.push(o);c.push(_)}else for(_=new THREE.Shape,e=0,t=h.length;e<t;e++)o=h[e],THREE.Shape.Utils.isClockWise(o.getPoints())?(_.actions=o.actions,_.curves=o.curves,c.push(_),_=new THREE.Shape):_.holes.push(o);return c},THREE.Shape=function(){THREE.Path.apply(this,arguments),this.holes=[]},THREE.Shape.prototype=new THREE.Path,THREE.Shape.prototype.constructor=THREE.Path,THREE.Shape.prototype.extrude=function(e){return new THREE.ExtrudeGeometry(this,e)},THREE.Shape.prototype.getPointsHoles=function(e){var t,n=this.holes.length,o=[];for(t=0;t<n;t++)o[t]=this.holes[t].getTransformedPoints(e,this.bends);return o},THREE.Shape.prototype.getSpacedPointsHoles=function(e){var t,n=this.holes.length,o=[];for(t=0;t<n;t++)o[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return o},THREE.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},THREE.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},THREE.Shape.Utils={removeHoles:function(e,t){var n,o,h,c,_,E,f,p,u,m,$=e.concat(),g=$.concat(),v=[];for(_=0;_<t.length;_++){for(n=0,E=t[_],g=g.concat(E),o=Number.POSITIVE_INFINITY;n<E.length;n++)for(p=0,u=E[n],m=[];p<$.length;p++)f=$[p],f=u.distanceToSquared(f),m.push(f),f<o&&(o=f,h=n,c=p);n=c-1>=0?c-1:$.length-1,o=h-1>=0?h-1:E.length-1;var T=[E[h],$[c],$[n]];p=THREE.FontUtils.Triangulate.area(T);var y=[E[h],E[o],$[c]];u=THREE.FontUtils.Triangulate.area(y),m=c,f=h,h+=-1,(c+=1)<0&&(c+=$.length),c%=$.length,h<0&&(h+=E.length),h%=E.length,n=c-1>=0?c-1:$.length-1,o=h-1>=0?h-1:E.length-1,T=[E[h],$[c],$[n]],T=THREE.FontUtils.Triangulate.area(T),y=[E[h],E[o],$[c]],p+u>T+(y=THREE.FontUtils.Triangulate.area(y))&&(c=m,h=f,c<0&&(c+=$.length),c%=$.length,h<0&&(h+=E.length),h%=E.length,n=c-1>=0?c-1:$.length-1,o=h-1>=0?h-1:E.length-1),p=$.slice(0,c),u=$.slice(c),m=E.slice(h),f=E.slice(0,h),o=[E[h],E[o],$[c]],v.push([E[h],$[c],$[n]]),v.push(o),$=p.concat(m).concat(f).concat(u)}return{shape:$,isolatedPts:v,allpoints:g}},triangulateShape:function(e,t){var n,o,h,c,_=THREE.Shape.Utils.removeHoles(e,t),E=_.allpoints,f=_.isolatedPts,_=THREE.FontUtils.Triangulate(_.shape,!1),p={};for(n=0,o=E.length;n<o;n++)void 0!==p[c=E[n].x+":"+E[n].y]&&console.log("Duplicate point",c),p[c]=n;for(n=0,o=_.length;n<o;n++)for(E=0,h=_[n];E<3;E++)void 0!==(c=p[c=h[E].x+":"+h[E].y])&&(h[E]=c);for(n=0,o=f.length;n<o;n++)for(E=0,h=f[n];E<3;E++)void 0!==(c=p[c=h[E].x+":"+h[E].y])&&(h[E]=c);return _.concat(f)},isClockWise:function(e){return 0>THREE.FontUtils.Triangulate.area(e)},b2p0:function(e,t){var n=1-e;return n*n*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,n,o){return this.b2p0(e,t)+this.b2p1(e,n)+this.b2p2(e,o)},b3p0:function(e,t){var n=1-e;return n*n*n*t},b3p1:function(e,t){var n=1-e;return 3*n*n*e*t},b3p2:function(e,t){return 3*(1-e)*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,n,o,h){return this.b3p0(e,t)+this.b3p1(e,n)+this.b3p2(e,o)+this.b3p3(e,h)}},THREE.TextPath=function(e,t){THREE.Path.call(this),this.parameters=t||{},this.set(e)},THREE.TextPath.prototype.set=function(e,t){this.text=e;var t=t||this.parameters,n=void 0!==t.curveSegments?t.curveSegments:4,o=void 0!==t.font?t.font:"helvetiker",h=void 0!==t.weight?t.weight:"normal",c=void 0!==t.style?t.style:"normal";THREE.FontUtils.size=void 0!==t.size?t.size:100,THREE.FontUtils.divisions=n,THREE.FontUtils.face=o,THREE.FontUtils.weight=h,THREE.FontUtils.style=c},THREE.TextPath.prototype.toShapes=function(){for(var e=THREE.FontUtils.drawText(this.text).paths,t=[],n=0,o=e.length;n<o;n++)t=t.concat(e[n].toShapes());return t},THREE.CubeGeometry=function(e,t,n,o,h,c,_,E,f){function p(e,t,n,_,E,f,p,m){var $,g,v=o||1,T=h||1,y=E/2,R=f/2,x=u.vertices.length;"x"==e&&"y"==t||"y"==e&&"x"==t?$="z":"x"==e&&"z"==t||"z"==e&&"x"==t?($="y",T=c||1):("z"==e&&"y"==t||"y"==e&&"z"==t)&&($="x",v=c||1);var H=v+1,b=T+1;E/=v;var w=f/T;for(g=0;g<b;g++)for(f=0;f<H;f++){var S=new THREE.Vector3;S[e]=(f*E-y)*n,S[t]=(g*w-R)*_,S[$]=p,u.vertices.push(new THREE.Vertex(S))}for(g=0;g<T;g++)for(f=0;f<v;f++)u.faces.push(new THREE.Face4(f+H*g+x,f+H*(g+1)+x,f+1+H*(g+1)+x,f+1+H*g+x,null,null,m)),u.faceVertexUvs[0].push([new THREE.UV(f/v,g/T),new THREE.UV(f/v,(g+1)/T),new THREE.UV((f+1)/v,(g+1)/T),new THREE.UV((f+1)/v,g/T)])}THREE.Geometry.call(this);var u=this,m=e/2,$=t/2,g=n/2,E=E?-1:1;if(void 0!==_){if(_ instanceof Array)this.materials=_;else{this.materials=[];for(var v=0;v<6;v++)this.materials.push([_])}}else this.materials=[];if(this.sides={px:!0,nx:!0,py:!0,ny:!0,pz:!0,nz:!0},void 0!=f)for(var T in f)void 0!=this.sides[T]&&(this.sides[T]=f[T]);this.sides.px&&p("z","y",1*E,-1,n,t,-m,this.materials[0]),this.sides.nx&&p("z","y",-1*E,-1,n,t,m,this.materials[1]),this.sides.py&&p("x","z",1*E,1,e,n,$,this.materials[2]),this.sides.ny&&p("x","z",1*E,-1,e,n,-$,this.materials[3]),this.sides.pz&&p("x","y",1*E,-1,e,t,g,this.materials[4]),this.sides.nz&&p("x","y",-1*E,-1,e,t,-g,this.materials[5]),function(){for(var e=[],t=[],n=0,o=u.vertices.length;n<o;n++){for(var h=u.vertices[n],c=!1,_=0,E=e.length;_<E;_++){var f=e[_];if(h.position.x==f.position.x&&h.position.y==f.position.y&&h.position.z==f.position.z){t[n]=_,c=!0;break}}c||(t[n]=e.length,e.push(new THREE.Vertex(h.position.clone())))}for(n=0,o=u.faces.length;n<o;n++)(h=u.faces[n]).a=t[h.a],h.b=t[h.b],h.c=t[h.c],h.d=t[h.d];u.vertices=e}(),this.computeCentroids(),this.computeFaceNormals()},THREE.CubeGeometry.prototype=new THREE.Geometry,THREE.CubeGeometry.prototype.constructor=THREE.CubeGeometry,THREE.CylinderGeometry=function(e,t,n,o,h,c){function _(e,t,n){f.vertices.push(new THREE.Vertex(new THREE.Vector3(e,t,n)))}THREE.Geometry.call(this);var E,f=this,p=2*Math.PI,u=o/2;for(E=0;E<e;E++)_(Math.sin(p*E/e)*t,Math.cos(p*E/e)*t,-u);for(E=0;E<e;E++)_(Math.sin(p*E/e)*n,Math.cos(p*E/e)*n,u);for(E=0;E<e;E++)f.faces.push(new THREE.Face4(E,E+e,e+(E+1)%e,(E+1)%e));if(n>0)for(_(0,0,-u-(c||0)),E=e;E<e+e/2;E++)f.faces.push(new THREE.Face4(2*e,(2*E-2*e)%e,(2*E-2*e+1)%e,(2*E-2*e+2)%e));if(t>0)for(_(0,0,u+(h||0)),E=e+e/2;E<2*e;E++)f.faces.push(new THREE.Face4(2*e+1,(2*E-2*e+2)%e+e,(2*E-2*e+1)%e+e,(2*E-2*e)%e+e));for(E=0,e=this.faces.length;E<e;E++){var t=[],n=this.faces[E],h=this.vertices[n.a],c=this.vertices[n.b],u=this.vertices[n.c],m=this.vertices[n.d];t.push(new THREE.UV(.5+Math.atan2(h.position.x,h.position.y)/p,.5+h.position.z/o)),t.push(new THREE.UV(.5+Math.atan2(c.position.x,c.position.y)/p,.5+c.position.z/o)),t.push(new THREE.UV(.5+Math.atan2(u.position.x,u.position.y)/p,.5+u.position.z/o)),n instanceof THREE.Face4&&t.push(new THREE.UV(.5+Math.atan2(m.position.x,m.position.y)/p,.5+m.position.z/o)),this.faceVertexUvs[0].push(t)}this.computeCentroids(),this.computeFaceNormals()},THREE.CylinderGeometry.prototype=new THREE.Geometry,THREE.CylinderGeometry.prototype.constructor=THREE.CylinderGeometry,THREE.ExtrudeGeometry=function(e,t){if(void 0!==e){THREE.Geometry.call(this);var n,o,e=e instanceof Array?e:[e],h=e.length;for(n=0;n<h;n++)o=e[n],this.addShape(o,t)}},THREE.ExtrudeGeometry.prototype=new THREE.Geometry,THREE.ExtrudeGeometry.prototype.constructor=THREE.ExtrudeGeometry,THREE.ExtrudeGeometry.prototype.addShape=function(e,t){function n(e,t,n){return t||console.log("die"),t.clone().multiplyScalar(n).addSelf(e)}function o(e,t,n){var o=THREE.ExtrudeGeometry.__v1,h=THREE.ExtrudeGeometry.__v2,c=THREE.ExtrudeGeometry.__v3,_=THREE.ExtrudeGeometry.__v4,E=THREE.ExtrudeGeometry.__v5,f=THREE.ExtrudeGeometry.__v6;return(o.set(e.x-t.x,e.y-t.y),h.set(e.x-n.x,e.y-n.y),o=o.normalize(),h=h.normalize(),c.set(-o.y,o.x),_.set(h.y,-h.x),E.copy(e).addSelf(c),f.copy(e).addSelf(_),E.equals(f))?_.clone():(E.copy(t).addSelf(c),f.copy(n).addSelf(_),c=o.dot(_),_=f.subSelf(E).dot(_),0==c&&(console.log("Either infinite or no solutions!"),0==_?console.log("Its finite solutions."):console.log("Too bad, no solutions.")),(_/=c)<0)?((t=Math.atan2(t.y-e.y,t.x-e.x))>(e=Math.atan2(n.y-e.y,n.x-e.x))&&(e+=2*Math.PI),anglec=(t+e)/2,new THREE.Vector2(-Math.cos(anglec),-Math.sin(anglec))):o.multiplyScalar(_).addSelf(E).subSelf(e).clone()}function h(e){for(M=e.length;--M>=0;){I=M,(O=M-1)<0&&(O=e.length-1);for(var t=0,t=0;t<v+2*m;t++){var n=F*t,o=F*(t+1),h=W+I+n,n=W+O+n,c=W+O+o,o=W+I+o;h+=C,n+=C,c+=C,o+=C,S.faces.push(new THREE.Face4(h,n,c,o))}}}function c(e,t,n){S.vertices.push(new THREE.Vertex(new THREE.Vector3(e,t,n)))}function _(e,t,n){e+=C,t+=C,n+=C,S.faces.push(new THREE.Face3(e,t,n))}var E,f=void 0!==t.amount?t.amount:100,p=void 0!==t.bevelThickness?t.bevelThickness:6,u=void 0!==t.bevelSize?t.bevelSize:p-2,m=void 0!==t.bevelSegments?t.bevelSegments:3,$=void 0===t.bevelEnabled||t.bevelEnabled,g=void 0!==t.curveSegments?t.curveSegments:12,v=void 0!==t.steps?t.steps:1,T=t.bendPath,y=t.extrudePath,R=!1,x=void 0!==t.useSpacedPoints&&t.useSpacedPoints;y&&(v=(E=y.getPoints(g)).length,R=!0,$=!1),$||(u=p=m=0);var H,b,w,S=this,C=this.vertices.length;if(T&&e.addWrapPath(T),T=(g=x?e.extractAllSpacedPoints(g):e.extractAllPoints(g)).shape,g=g.holes,y=!THREE.Shape.Utils.isClockWise(T)){for(T=T.reverse(),b=0,w=g.length;b<w;b++)H=g[b],THREE.Shape.Utils.isClockWise(H)&&(g[b]=H.reverse());y=!1}for(y=THREE.Shape.Utils.triangulateShape(T,g),x=T,b=0,w=g.length;b<w;b++)H=g[b],T=T.concat(H);var M,A,L,P,V,z,F=T.length,U=y.length,k=[];for(M=0,I=(A=x.length)-1,O=M+1;M<A;M++,I++,O++)I==A&&(I=0),O==A&&(O=0),k[M]=o(x[M],x[I],x[O]);var B,D=[],N=k.concat();for(b=0,w=g.length;b<w;b++){for(H=g[b],B=[],M=0,I=(A=H.length)-1,O=M+1;M<A;M++,I++,O++)I==A&&(I=0),O==A&&(O=0),B[M]=o(H[M],H[I],H[O]);D.push(B),N=N.concat(B)}for(L=0;L<m;L++){for(V=p*(1-(P=L/m)),P=u*Math.sin(P*Math.PI/2),M=0,A=x.length;M<A;M++)c((z=n(x[M],k[M],P)).x,z.y,-V);for(b=0,w=g.length;b<w;b++)for(H=g[b],B=D[b],M=0,A=H.length;M<A;M++)c((z=n(H[M],B[M],P)).x,z.y,-V)}for(M=0,P=u;M<F;M++)z=$?n(T[M],N[M],P):T[M],R?c(z.x,z.y+E[0].y,E[0].x):c(z.x,z.y,0);for(L=1;L<=v;L++)for(M=0;M<F;M++)z=$?n(T[M],N[M],P):T[M],R?c(z.x,z.y+E[L-1].y,E[L-1].x):c(z.x,z.y,f/v*L);for(L=m-1;L>=0;L--){for(V=p*(1-(P=L/m)),P=u*Math.sin(P*Math.PI/2),M=0,A=x.length;M<A;M++)c((z=n(x[M],k[M],P)).x,z.y,f+V);for(b=0,w=g.length;b<w;b++)for(H=g[b],B=D[b],M=0,A=H.length;M<A;M++)z=n(H[M],B[M],P),R?c(z.x,z.y+E[v-1].y,E[v-1].x+V):c(z.x,z.y,f+V)}if($){for(M=0,p=0*F;M<U;M++)_((f=y[M])[2]+p,f[1]+p,f[0]+p);for(M=0,p=F*(v+2*m);M<U;M++)_((f=y[M])[0]+p,f[1]+p,f[2]+p)}else{for(M=0;M<U;M++)_((f=y[M])[2],f[1],f[0]);for(M=0;M<U;M++)_((f=y[M])[0]+F*v,f[1]+F*v,f[2]+F*v)}var I,O,W=0;for(h(x),W+=x.length,b=0,w=g.length;b<w;b++)h(H=g[b]),W+=H.length;this.computeCentroids(),this.computeFaceNormals()},THREE.ExtrudeGeometry.__v1=new THREE.Vector2,THREE.ExtrudeGeometry.__v2=new THREE.Vector2,THREE.ExtrudeGeometry.__v3=new THREE.Vector2,THREE.ExtrudeGeometry.__v4=new THREE.Vector2,THREE.ExtrudeGeometry.__v5=new THREE.Vector2,THREE.ExtrudeGeometry.__v6=new THREE.Vector2,THREE.IcosahedronGeometry=function(e){function t(e,t,n){var o=Math.sqrt(e*e+t*t+n*n);return h.vertices.push(new THREE.Vertex(new THREE.Vector3(e/o,t/o,n/o)))-1}function n(e,t,n,o){o.faces.push(new THREE.Face3(e,t,n))}function o(e,n){var o=h.vertices[e].position,c=h.vertices[n].position;return t((o.x+c.x)/2,(o.y+c.y)/2,(o.z+c.z)/2)}var h=this,c=new THREE.Geometry;this.subdivisions=e||0,THREE.Geometry.call(this),t(-1,e=(1+Math.sqrt(5))/2,0),t(1,e,0),t(-1,-e,0),t(1,-e,0),t(0,-1,e),t(0,1,e),t(0,-1,-e),t(0,1,-e),t(e,0,-1),t(e,0,1),t(-e,0,-1),t(-e,0,1),n(0,11,5,c),n(0,5,1,c),n(0,1,7,c),n(0,7,10,c),n(0,10,11,c),n(1,5,9,c),n(5,11,4,c),n(11,10,2,c),n(10,7,6,c),n(7,1,8,c),n(3,9,4,c),n(3,4,2,c),n(3,2,6,c),n(3,6,8,c),n(3,8,9,c),n(4,9,5,c),n(2,4,11,c),n(6,2,10,c),n(8,6,7,c),n(9,8,1,c);for(var _=0;_<this.subdivisions;_++){var E,e=new THREE.Geometry;for(E in c.faces){var f=o(c.faces[E].a,c.faces[E].b),p=o(c.faces[E].b,c.faces[E].c),u=o(c.faces[E].c,c.faces[E].a);n(c.faces[E].a,f,u,e),n(c.faces[E].b,p,f,e),n(c.faces[E].c,u,p,e),n(f,p,u,e)}c.faces=e.faces}h.faces=c.faces,this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.IcosahedronGeometry.prototype=new THREE.Geometry,THREE.IcosahedronGeometry.prototype.constructor=THREE.IcosahedronGeometry,THREE.LatheGeometry=function(e,t,n){THREE.Geometry.call(this),this.steps=t||12,this.angle=n||2*Math.PI;for(var t=this.angle/this.steps,n=[],o=[],h=[],c=[],_=(new THREE.Matrix4).setRotationZ(t),E=0;E<e.length;E++)this.vertices.push(new THREE.Vertex(e[E])),n[E]=e[E].clone(),o[E]=this.vertices.length-1;for(var f=0;f<=this.angle+.001;f+=t){for(E=0;E<n.length;E++)f<this.angle?(n[E]=_.multiplyVector3(n[E].clone()),this.vertices.push(new THREE.Vertex(n[E])),h[E]=this.vertices.length-1):h=c;for(0==f&&(c=o),E=0;E<o.length-1;E++)this.faces.push(new THREE.Face4(h[E],h[E+1],o[E+1],o[E])),this.faceVertexUvs[0].push([new THREE.UV(1-f/this.angle,E/e.length),new THREE.UV(1-f/this.angle,(E+1)/e.length),new THREE.UV(1-(f-t)/this.angle,(E+1)/e.length),new THREE.UV(1-(f-t)/this.angle,E/e.length)]);o=h,h=[]}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.LatheGeometry.prototype=new THREE.Geometry,THREE.LatheGeometry.prototype.constructor=THREE.LatheGeometry,THREE.PlaneGeometry=function(e,t,n,o){THREE.Geometry.call(this);var h,c=e/2,_=t/2,n=n||1,o=o||1,E=n+1,f=o+1;e/=n;var p=t/o;for(h=0;h<f;h++)for(t=0;t<E;t++)this.vertices.push(new THREE.Vertex(new THREE.Vector3(t*e-c,-(h*p-_),0)));for(h=0;h<o;h++)for(t=0;t<n;t++)this.faces.push(new THREE.Face4(t+E*h,t+E*(h+1),t+1+E*(h+1),t+1+E*h)),this.faceVertexUvs[0].push([new THREE.UV(t/n,h/o),new THREE.UV(t/n,(h+1)/o),new THREE.UV((t+1)/n,(h+1)/o),new THREE.UV((t+1)/n,h/o)]);this.computeCentroids(),this.computeFaceNormals()},THREE.PlaneGeometry.prototype=new THREE.Geometry,THREE.PlaneGeometry.prototype.constructor=THREE.PlaneGeometry,THREE.SphereGeometry=function(e,t,n){THREE.Geometry.call(this);for(var o,e=e||50,h=Math.PI,c=Math.max(3,t||8),_=Math.max(2,n||6),t=[],n=0;n<_+1;n++){var E=e*Math.cos((o=n/_)*h),f=e*Math.sin(o*h),p=[],u=0;for(o=0;o<c;o++){var m=2*o/c,$=f*Math.sin(m*h),m=f*Math.cos(m*h);(0==n||n==_)&&o>0||(u=this.vertices.push(new THREE.Vertex(new THREE.Vector3(m,E,$)))-1),p.push(u)}t.push(p)}for(var g,v,T,h=t.length,n=0;n<h;n++)if(c=t[n].length,n>0)for(o=0;o<c;o++){p=o==c-1,_=t[n][p?0:o+1],E=t[n][p?c-1:o],f=t[n-1][p?c-1:o],p=t[n-1][p?0:o+1],$=n/(h-1),g=(n-1)/(h-1),v=(o+1)/c;var m=o/c,u=new THREE.UV(1-v,$),$=new THREE.UV(1-m,$),m=new THREE.UV(1-m,g),y=new THREE.UV(1-v,g);n<t.length-1&&(g=this.vertices[_].position.clone(),v=this.vertices[E].position.clone(),T=this.vertices[f].position.clone(),g.normalize(),v.normalize(),T.normalize(),this.faces.push(new THREE.Face3(_,E,f,[new THREE.Vector3(g.x,g.y,g.z),new THREE.Vector3(v.x,v.y,v.z),new THREE.Vector3(T.x,T.y,T.z)])),this.faceVertexUvs[0].push([u,$,m])),n>1&&(g=this.vertices[_].position.clone(),v=this.vertices[f].position.clone(),T=this.vertices[p].position.clone(),g.normalize(),v.normalize(),T.normalize(),this.faces.push(new THREE.Face3(_,f,p,[new THREE.Vector3(g.x,g.y,g.z),new THREE.Vector3(v.x,v.y,v.z),new THREE.Vector3(T.x,T.y,T.z)])),this.faceVertexUvs[0].push([u,m,y]))}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals(),this.boundingSphere={radius:e}},THREE.SphereGeometry.prototype=new THREE.Geometry,THREE.SphereGeometry.prototype.constructor=THREE.SphereGeometry,THREE.TextGeometry=function(e,t){var n=new THREE.TextPath(e,t).toShapes();if(t.amount=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),t.bend){var o=n[n.length-1].getBoundingBox().maxX;t.bendPath=new THREE.QuadraticBezierCurve(new THREE.Vector2(0,0),new THREE.Vector2(o/2,120),new THREE.Vector2(o,0))}THREE.ExtrudeGeometry.call(this,n,t)},THREE.TextGeometry.prototype=new THREE.ExtrudeGeometry,THREE.TextGeometry.prototype.constructor=THREE.TextGeometry,THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},getTextShapes:function(e,t){return new TextPath(e,t).toShapes()},loadFace:function(e){var t=e.familyName.toLowerCase();return this.faces[t]=this.faces[t]||{},this.faces[t][e.cssFontWeight]=this.faces[t][e.cssFontWeight]||{},this.faces[t][e.cssFontWeight][e.cssFontStyle]=e,this.faces[t][e.cssFontWeight][e.cssFontStyle]=e},drawText:function(e){for(var t=this.getFace(),n=this.size/t.resolution,o=0,h=String(e).split(""),c=h.length,_=[],e=0;e<c;e++){var E=new THREE.Path,E=this.extractGlyphPoints(h[e],t,n,o,E);o+=E.offset,_.push(E.path)}return{paths:_,offset:o/2}},extractGlyphPoints:function(e,t,n,o,h){var c,_,E,f,p,u,m,$,g,v,T=[],y=t.glyphs[e]||t.glyphs[ctxt.options.fallbackCharacter];if(y){if(y.o)for(e=0,E=(t=y._cachedOutline||(y._cachedOutline=y.o.split(" "))).length;e<E;)switch(_=t[e++]){case"m":_=t[e++]*n+o,f=t[e++]*n,T.push(new THREE.Vector2(_,f)),h.moveTo(_,f);break;case"l":_=t[e++]*n+o,f=t[e++]*n,T.push(new THREE.Vector2(_,f)),h.lineTo(_,f);break;case"q":if(_=t[e++]*n+o,f=t[e++]*n,m=t[e++]*n+o,$=t[e++]*n,h.quadraticCurveTo(m,$,_,f),c=T[T.length-1])for(p=c.x,u=c.y,c=1,divisions=this.divisions;c<=divisions;c++){var R=c/divisions,x=THREE.Shape.Utils.b2(R,p,m,_),R=THREE.Shape.Utils.b2(R,u,$,f);T.push(new THREE.Vector2(x,R))}break;case"b":if(_=t[e++]*n+o,f=t[e++]*n,m=t[e++]*n+o,$=-(t[e++]*n),g=t[e++]*n+o,v=-(t[e++]*n),h.bezierCurveTo(_,f,m,$,g,v),c=T[T.length-1])for(p=c.x,u=c.y,c=1,divisions=this.divisions;c<=divisions;c++)R=c/divisions,x=THREE.Shape.Utils.b3(R,p,m,g,_),R=THREE.Shape.Utils.b3(R,u,$,v,f),T.push(new THREE.Vector2(x,R))}return{offset:y.ha*n,points:T,path:h}}}},function(e){var t=function(e){for(var t=e.length,n=0,o=t-1,h=0;h<t;o=h++)n+=e[o].x*e[h].y-e[h].x*e[o].y;return .5*n};e.Triangulate=function(e,n){var o=e.length;if(o<3)return null;var h,c,_,E=[],f=[],p=[];if(t(e)>0)for(c=0;c<o;c++)f[c]=c;else for(c=0;c<o;c++)f[c]=o-1-c;var u=2*o;for(c=o-1;o>2;){if(u--<=0){if(console.log("Warning, unable to triangulate polygon!"),n)return p;return E}o<=(h=c)&&(h=0),o<=(c=h+1)&&(c=0),o<=(_=c+1)&&(_=0);a:{var m,$=h,g=c,v=_,T=o,y=f,R=void 0,x=void 0,H=void 0,b=void 0,w=void 0,S=void 0,C=void 0,M=void 0,A=void 0,x=(m=e)[y[$]].x,H=m[y[$]].y,b=m[y[g]].x,w=m[y[g]].y,S=m[y[v]].x,C=m[y[v]].y;if(1e-10>(b-x)*(C-H)-(w-H)*(S-x))m=!1;else{for(R=0;R<T;R++)if(!(R==$||R==g||R==v)){var M=m[y[R]].x,A=m[y[R]].y,L=void 0,P=void 0,V=void 0,z=void 0,F=void 0,U=void 0,k=void 0,B=void 0,D=void 0,N=void 0,I=void 0,O=void 0,L=V=F=void 0,L=S-b,P=C-w,V=x-S,z=H-C,F=b-x,U=w-H,k=M-x,B=A-H,D=M-b,N=A-w,I=M-S,O=A-C,L=L*N-P*D,F=F*B-U*k,V=V*O-z*I;if(L>=0&&V>=0&&F>=0){m=!1;break a}}m=!0}}if(m){for(E.push([e[f[h]],e[f[c]],e[f[_]]]),p.push([f[h],f[c],f[_]]),h=c,_=c+1;_<o;h++,_++)f[h]=f[_];u=2*--o}}return n?p:E},e.Triangulate.area=t}(THREE.FontUtils),window._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace},THREE.TorusGeometry=function(e,t,n,o){for(THREE.Geometry.call(this),this.radius=e||100,this.tube=t||40,this.segmentsR=n||8,this.segmentsT=o||6,e=[],t=0;t<=this.segmentsR;++t)for(n=0;n<=this.segmentsT;++n){var o=n/this.segmentsT*2*Math.PI,h=t/this.segmentsR*2*Math.PI;this.vertices.push(new THREE.Vertex(new THREE.Vector3((this.radius+this.tube*Math.cos(h))*Math.cos(o),(this.radius+this.tube*Math.cos(h))*Math.sin(o),this.tube*Math.sin(h)))),e.push([n/this.segmentsT,1-t/this.segmentsR])}for(t=1;t<=this.segmentsR;++t)for(n=1;n<=this.segmentsT;++n){var o=(this.segmentsT+1)*t+n,h=(this.segmentsT+1)*t+n-1,c=(this.segmentsT+1)*(t-1)+n-1,_=(this.segmentsT+1)*(t-1)+n;this.faces.push(new THREE.Face4(o,h,c,_)),this.faceVertexUvs[0].push([new THREE.UV(e[o][0],e[o][1]),new THREE.UV(e[h][0],e[h][1]),new THREE.UV(e[c][0],e[c][1]),new THREE.UV(e[_][0],e[_][1])])}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.TorusGeometry.prototype=new THREE.Geometry,THREE.TorusGeometry.prototype.constructor=THREE.TorusGeometry,THREE.TorusKnotGeometry=function(e,t,n,o,h,c,_){function E(e,t,n,o,h,c){return n=Math.cos(t=n/o*e),new THREE.Vector3(h*(2+n)*.5*Math.cos(e),h*(2+n)*Math.sin(e)*.5,c*h*Math.sin(t)*.5)}for(THREE.Geometry.call(this),this.radius=e||200,this.tube=t||40,this.segmentsR=n||64,this.segmentsT=o||8,this.p=h||2,this.q=c||3,this.heightScale=_||1,this.grid=Array(this.segmentsR),n=new THREE.Vector3,o=new THREE.Vector3,c=new THREE.Vector3,e=0;e<this.segmentsR;++e)for(t=0,this.grid[e]=Array(this.segmentsT);t<this.segmentsT;++t){var f=e/this.segmentsR*2*this.p*Math.PI,_=t/this.segmentsT*2*Math.PI,h=E(f,_,this.q,this.p,this.radius,this.heightScale),f=E(f+.01,_,this.q,this.p,this.radius,this.heightScale);n.x=f.x-h.x,n.y=f.y-h.y,n.z=f.z-h.z,o.x=f.x+h.x,o.y=f.y+h.y,o.z=f.z+h.z,c.cross(n,o),o.cross(c,n),c.normalize(),o.normalize(),f=-this.tube*Math.cos(_),_=this.tube*Math.sin(_),h.x+=f*o.x+_*c.x,h.y+=f*o.y+_*c.y,h.z+=f*o.z+_*c.z,this.grid[e][t]=this.vertices.push(new THREE.Vertex(new THREE.Vector3(h.x,h.y,h.z)))-1}for(e=0;e<this.segmentsR;++e)for(t=0;t<this.segmentsT;++t){var o=(e+1)%this.segmentsR,c=(t+1)%this.segmentsT,h=this.grid[e][t],n=this.grid[o][t],o=this.grid[o][c],c=this.grid[e][c],_=new THREE.UV(e/this.segmentsR,t/this.segmentsT),f=new THREE.UV((e+1)/this.segmentsR,t/this.segmentsT),p=new THREE.UV((e+1)/this.segmentsR,(t+1)/this.segmentsT),u=new THREE.UV(e/this.segmentsR,(t+1)/this.segmentsT);this.faces.push(new THREE.Face4(h,n,o,c)),this.faceVertexUvs[0].push([_,f,p,u])}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.TorusKnotGeometry.prototype=new THREE.Geometry,THREE.TorusKnotGeometry.prototype.constructor=THREE.TorusKnotGeometry,THREE.Loader=function(e){this.statusDomElement=(this.showStatus=e)?THREE.Loader.prototype.addStatusElement():null,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},THREE.Loader.prototype={addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(e){var t="Loaded ";t+=e.total?(100*e.loaded/e.total).toFixed(0)+"%":(e.loaded/1e3).toFixed(2)+" KB",this.statusDomElement.innerHTML=t},extractUrlbase:function(e){return(e=e.split("/")).pop(),e.join("/")},init_materials:function(e,t,n){e.materials=[];for(var o=0;o<t.length;++o)e.materials[o]=[THREE.Loader.prototype.createMaterial(t[o],n)]},hasNormals:function(e){var t,n,o=e.materials.length;for(n=0;n<o;n++)if((t=e.materials[n][0])instanceof THREE.MeshShaderMaterial)return!0;return!1},createMaterial:function(e,t){function n(e){return Math.floor(e=Math.log(e)/Math.LN2)==e}function o(e,o,h,c,_,E){var f,p,u,m=document.createElement("canvas");e[o]=new THREE.Texture(m),e[o].sourceFile=h,c&&(e[o].repeat.set(c[0],c[1]),1!=c[0]&&(e[o].wrapS=THREE.RepeatWrapping),1!=c[1]&&(e[o].wrapT=THREE.RepeatWrapping)),_&&e[o].offset.set(_[0],_[1]),E&&(void 0!==(c={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping})[E[0]]&&(e[o].wrapS=c[E[0]]),void 0!==c[E[1]]&&(e[o].wrapT=c[E[1]])),f=e[o],p=t+"/"+h,(u=new Image).onload=function(){if(n(this.width)&&n(this.height))f.image=this;else{var e=Math.pow(2,Math.round(Math.log(this.width)/Math.LN2)),t=Math.pow(2,Math.round(Math.log(this.height)/Math.LN2));f.image.width=e,f.image.height=t,f.image.getContext("2d").drawImage(this,0,0,e,t)}f.needsUpdate=!0},u.src=p}function h(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]}if(_="MeshLambertMaterial",c={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,wireframe:e.wireframe},e.shading&&("Phong"==e.shading?_="MeshPhongMaterial":"Basic"==e.shading&&(_="MeshBasicMaterial")),e.blending&&("Additive"==e.blending?c.blending=THREE.AdditiveBlending:"Subtractive"==e.blending?c.blending=THREE.SubtractiveBlending:"Multiply"==e.blending&&(c.blending=THREE.MultiplyBlending)),(void 0!==e.transparent||e.opacity<1)&&(c.transparent=e.transparent),void 0!==e.depthTest&&(c.depthTest=e.depthTest),void 0!==e.vertexColors&&("face"==e.vertexColors?c.vertexColors=THREE.FaceColors:e.vertexColors&&(c.vertexColors=THREE.VertexColors)),e.colorDiffuse?c.color=h(e.colorDiffuse):e.DbgColor&&(c.color=e.DbgColor),e.colorSpecular&&(c.specular=h(e.colorSpecular)),e.colorAmbient&&(c.ambient=h(e.colorAmbient)),e.transparency&&(c.opacity=e.transparency),e.specularCoef&&(c.shininess=e.specularCoef),e.mapDiffuse&&t&&o(c,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap),e.mapLight&&t&&o(c,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap),e.mapNormal&&t&&o(c,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap),e.mapSpecular&&t&&o(c,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap),e.mapNormal){var c,_,E,f=THREE.ShaderUtils.lib.normal,p=THREE.UniformsUtils.clone(f.uniforms),u=c.color;_=c.specular,E=c.ambient;var m=c.shininess;p.tNormal.texture=c.normalMap,e.mapNormalFactor&&(p.uNormalScale.value=e.mapNormalFactor),c.map&&(p.tDiffuse.texture=c.map,p.enableDiffuse.value=!0),c.specularMap&&(p.tSpecular.texture=c.specularMap,p.enableSpecular.value=!0),c.lightMap&&(p.tAO.texture=c.lightMap,p.enableAO.value=!0),p.uDiffuseColor.value.setHex(u),p.uSpecularColor.value.setHex(_),p.uAmbientColor.value.setHex(E),p.uShininess.value=m,c.opacity&&(p.uOpacity.value=c.opacity),c=new THREE.MeshShaderMaterial({fragmentShader:f.fragmentShader,vertexShader:f.vertexShader,uniforms:p,lights:!0,fog:!0})}else c=new THREE[_](c);return c},constructor:THREE.Loader},THREE.JSONLoader=function(e){THREE.Loader.call(this,e)},THREE.JSONLoader.prototype=new THREE.Loader,THREE.JSONLoader.prototype.constructor=THREE.JSONLoader,THREE.JSONLoader.prototype.supr=THREE.Loader.prototype,THREE.JSONLoader.prototype.load=function(e){var t=this,n=e.model,o=e.callback,h=e.texture_path?e.texture_path:this.extractUrlbase(n),e=new Worker(n);e.onmessage=function(e){t.createModel(e.data,o,h),t.onLoadComplete()},this.onLoadStart(),e.postMessage((new Date).getTime())},THREE.JSONLoader.prototype.createModel=function(e,t,n){var o=new THREE.Geometry,h=void 0!==e.scale?1/e.scale:1;this.init_materials(o,e.materials,n),function(t){if(void 0===e.version||2!=e.version)console.error("Deprecated file format.");else{var n,h,c,_,E,f,p,u,m,$,g,v,T,y,R=e.faces;f=e.vertices;var x=e.normals,H=e.colors,b=0;for(n=0;n<e.uvs.length;n++)e.uvs[n].length&&b++;for(n=0;n<b;n++)o.faceUvs[n]=[],o.faceVertexUvs[n]=[];for(_=0,E=f.length;_<E;)(p=new THREE.Vertex).position.x=f[_++]*t,p.position.y=f[_++]*t,p.position.z=f[_++]*t,o.vertices.push(p);for(_=0,E=R.length;_<E;){if(f=1&(t=R[_++]),c=2&t,n=4&t,h=8&t,u=16&t,p=32&t,$=64&t,t&=128,f?((g=new THREE.Face4).a=R[_++],g.b=R[_++],g.c=R[_++],g.d=R[_++],f=4):((g=new THREE.Face3).a=R[_++],g.b=R[_++],g.c=R[_++],f=3),c&&(c=R[_++],g.materials=o.materials[c]),c=o.faces.length,n)for(n=0;n<b;n++)y=(v=e.uvs[n])[2*(m=R[_++])],m=v[2*m+1],o.faceUvs[n][c]=new THREE.UV(y,m);if(h)for(n=0;n<b;n++){for(h=0,v=e.uvs[n],T=[];h<f;h++)y=v[2*(m=R[_++])],m=v[2*m+1],T[h]=new THREE.UV(y,m);o.faceVertexUvs[n][c]=T}if(u&&(u=3*R[_++],(h=new THREE.Vector3).x=x[u++],h.y=x[u++],h.z=x[u],g.normal=h),p)for(n=0;n<f;n++)u=3*R[_++],(h=new THREE.Vector3).x=x[u++],h.y=x[u++],h.z=x[u],g.vertexNormals.push(h);if($&&(p=R[_++],p=new THREE.Color(H[p]),g.color=p),t)for(n=0;n<f;n++)p=R[_++],p=new THREE.Color(H[p]),g.vertexColors.push(p);o.faces.push(g)}}}(h),function(){var t,n,h,c;if(e.skinWeights)for(t=0,n=e.skinWeights.length;t<n;t+=2)h=e.skinWeights[t],c=e.skinWeights[t+1],o.skinWeights.push(new THREE.Vector4(h,c,0,0));if(e.skinIndices)for(t=0,n=e.skinIndices.length;t<n;t+=2)h=e.skinIndices[t],c=e.skinIndices[t+1],o.skinIndices.push(new THREE.Vector4(h,c,0,0));o.bones=e.bones,o.animation=e.animation}(),function(t){if(void 0!==e.morphTargets){var n,h,c,_,E,f,p,u,m;for(n=0,h=e.morphTargets.length;n<h;n++)for(o.morphTargets[n]={},o.morphTargets[n].name=e.morphTargets[n].name,o.morphTargets[n].vertices=[],u=o.morphTargets[n].vertices,m=e.morphTargets[n].vertices,c=0,_=m.length;c<_;c+=3)E=m[c]*t,f=m[c+1]*t,p=m[c+2]*t,u.push(new THREE.Vertex(new THREE.Vector3(E,f,p)))}if(void 0!==e.morphColors)for(n=0,h=e.morphColors.length;n<h;n++)for(o.morphColors[n]={},o.morphColors[n].name=e.morphColors[n].name,o.morphColors[n].colors=[],_=o.morphColors[n].colors,E=e.morphColors[n].colors,t=0,c=E.length;t<c;t+=3)(f=new THREE.Color(16755200)).setRGB(E[t],E[t+1],E[t+2]),_.push(f)}(h),function(){if(void 0!==e.edges){var t,n,h;for(t=0;t<e.edges.length;t+=2)n=e.edges[t],h=e.edges[t+1],o.edges.push(new THREE.Edge(o.vertices[n],o.vertices[h],n,h))}}(),o.computeCentroids(),o.computeFaceNormals(),this.hasNormals(o)&&o.computeTangents(),t(o)},THREE.BinaryLoader=function(e){THREE.Loader.call(this,e)},THREE.BinaryLoader.prototype=new THREE.Loader,THREE.BinaryLoader.prototype.constructor=THREE.BinaryLoader,THREE.BinaryLoader.prototype.supr=THREE.Loader.prototype,THREE.BinaryLoader.prototype={load:function(e){var t=e.model,n=e.callback,o=e.texture_path?e.texture_path:THREE.Loader.prototype.extractUrlbase(t),h=e.bin_path?e.bin_path:THREE.Loader.prototype.extractUrlbase(t),e=(new Date).getTime(),t=new Worker(t),c=this.showProgress?THREE.Loader.prototype.updateProgress:null;t.onmessage=function(e){THREE.BinaryLoader.prototype.loadAjaxBuffers(e.data.buffers,e.data.materials,n,h,o,c)},t.onerror=function(e){alert("worker.onerror: "+e.message+"\n"+e.data),e.preventDefault()},t.postMessage(e)},loadAjaxBuffers:function(e,t,n,o,h,c){var _=new XMLHttpRequest,E=o+"/"+e,f=0;_.onreadystatechange=function(){4==_.readyState?200==_.status||0==_.status?THREE.BinaryLoader.prototype.createBinModel(_.responseText,n,h,t):alert("Couldn't load ["+E+"] ["+_.status+"]"):3==_.readyState?c&&(0==f&&(f=_.getResponseHeader("Content-Length")),c({total:f,loaded:_.responseText.length})):2==_.readyState&&(f=_.getResponseHeader("Content-Length"))},_.open("GET",E,!0),_.overrideMimeType("text/plain; charset=x-user-defined"),_.setRequestHeader("Content-Type","text/plain"),_.send(null)},createBinModel:function(e,t,n,o){var h=function(t){function n(e,t){var n=E(e,t),o=E(e,t+1),h=E(e,t+2),c=E(e,t+3),_=(c<<1&255|h>>7)-127;return 0==(n|=(127&h)<<16|o<<8)&&-127==_?0:(1-2*(c>>7))*(1+11920928955078125e-23*n)*Math.pow(2,_)}function h(e,t){var n=E(e,t),o=E(e,t+1),h=E(e,t+2);return(E(e,t+3)<<24)+(h<<16)+(o<<8)+n}function c(e,t){var n=E(e,t);return(E(e,t+1)<<8)+n}function _(e,t){var n=E(e,t);return n>127?n-256:n}function E(e,t){return 255&e.charCodeAt(t)}function f(t){var n,o,_;n=h(e,t),o=h(e,t+T),_=h(e,t+y),t=c(e,t+R),THREE.BinaryLoader.prototype.f3(j,n,o,_,t)}function p(t){var n,o,_,E,f,p;n=h(e,t),o=h(e,t+T),_=h(e,t+y),E=c(e,t+R),f=h(e,t+x),p=h(e,t+H),t=h(e,t+b),THREE.BinaryLoader.prototype.f3n(j,Y,n,o,_,E,f,p,t)}function u(t){var n,o,_,E;n=h(e,t),o=h(e,t+w),_=h(e,t+S),E=h(e,t+C),t=c(e,t+M),THREE.BinaryLoader.prototype.f4(j,n,o,_,E,t)}function m(t){var n,o,_,E,f,p,u,m;n=h(e,t),o=h(e,t+w),_=h(e,t+S),E=h(e,t+C),f=c(e,t+M),p=h(e,t+A),u=h(e,t+L),m=h(e,t+P),t=h(e,t+V),THREE.BinaryLoader.prototype.f4n(j,Y,n,o,_,E,f,p,u,m,t)}function $(t){var n,o;n=h(e,t),o=h(e,t+z),t=h(e,t+F),THREE.BinaryLoader.prototype.uv3(j.faceVertexUvs[0],Z[2*n],Z[2*n+1],Z[2*o],Z[2*o+1],Z[2*t],Z[2*t+1])}function g(t){var n,o,c;n=h(e,t),o=h(e,t+U),c=h(e,t+k),t=h(e,t+B),THREE.BinaryLoader.prototype.uv4(j.faceVertexUvs[0],Z[2*n],Z[2*n+1],Z[2*o],Z[2*o+1],Z[2*c],Z[2*c+1],Z[2*t],Z[2*t+1])}var v,T,y,R,x,H,b,w,S,C,M,A,L,P,V,z,F,U,k,B,D,N,I,O,W,G,j=this,X=0,Y=[],Z=[];THREE.Geometry.call(this),THREE.Loader.prototype.init_materials(j,o,t),v={signature:e.substr(X,8),header_bytes:E(e,X+8),vertex_coordinate_bytes:E(e,X+9),normal_coordinate_bytes:E(e,X+10),uv_coordinate_bytes:E(e,X+11),vertex_index_bytes:E(e,X+12),normal_index_bytes:E(e,X+13),uv_index_bytes:E(e,X+14),material_index_bytes:E(e,X+15),nvertices:h(e,X+16),nnormals:h(e,X+16+4),nuvs:h(e,X+16+8),ntri_flat:h(e,X+16+12),ntri_smooth:h(e,X+16+16),ntri_flat_uv:h(e,X+16+20),ntri_smooth_uv:h(e,X+16+24),nquad_flat:h(e,X+16+28),nquad_smooth:h(e,X+16+32),nquad_flat_uv:h(e,X+16+36),nquad_smooth_uv:h(e,X+16+40)},X+=v.header_bytes,T=v.vertex_index_bytes,y=2*v.vertex_index_bytes,R=3*v.vertex_index_bytes,x=3*v.vertex_index_bytes+v.material_index_bytes,H=3*v.vertex_index_bytes+v.material_index_bytes+v.normal_index_bytes,b=3*v.vertex_index_bytes+v.material_index_bytes+2*v.normal_index_bytes,w=v.vertex_index_bytes,S=2*v.vertex_index_bytes,C=3*v.vertex_index_bytes,M=4*v.vertex_index_bytes,A=4*v.vertex_index_bytes+v.material_index_bytes,L=4*v.vertex_index_bytes+v.material_index_bytes+v.normal_index_bytes,P=4*v.vertex_index_bytes+v.material_index_bytes+2*v.normal_index_bytes,V=4*v.vertex_index_bytes+v.material_index_bytes+3*v.normal_index_bytes,z=v.uv_index_bytes,F=2*v.uv_index_bytes,U=v.uv_index_bytes,k=2*v.uv_index_bytes,B=3*v.uv_index_bytes,t=3*v.vertex_index_bytes+v.material_index_bytes,G=4*v.vertex_index_bytes+v.material_index_bytes,D=v.ntri_flat*t,N=v.ntri_smooth*(t+3*v.normal_index_bytes),I=v.ntri_flat_uv*(t+3*v.uv_index_bytes),O=v.ntri_smooth_uv*(t+3*v.normal_index_bytes+3*v.uv_index_bytes),W=v.nquad_flat*G,t=v.nquad_smooth*(G+4*v.normal_index_bytes),G=v.nquad_flat_uv*(G+4*v.uv_index_bytes),X+=function(t){for(var o,h,c,_=3*v.vertex_coordinate_bytes,E=t+v.nvertices*_;t<E;t+=_)o=n(e,t),h=n(e,t+v.vertex_coordinate_bytes),c=n(e,t+2*v.vertex_coordinate_bytes),THREE.BinaryLoader.prototype.v(j,o,h,c);return v.nvertices*_}(X),X+=function(t){for(var n,o,h,c=3*v.normal_coordinate_bytes,E=t+v.nnormals*c;t<E;t+=c)n=_(e,t),o=_(e,t+v.normal_coordinate_bytes),h=_(e,t+2*v.normal_coordinate_bytes),Y.push(n/127,o/127,h/127);return v.nnormals*c}(X),X+=function(t){for(var o,h,c=2*v.uv_coordinate_bytes,_=t+v.nuvs*c;t<_;t+=c)o=n(e,t),h=n(e,t+v.uv_coordinate_bytes),Z.push(o,h);return v.nuvs*c}(X),D=X+D,N=D+N,I=N+I,O=I+O,W=O+W,t=W+t,G=t+G,function(e){var t,n=3*v.vertex_index_bytes+v.material_index_bytes,o=n+3*v.uv_index_bytes,h=e+v.ntri_flat_uv*o;for(t=e;t<h;t+=o)f(t),$(t+n)}(N),function(e){var t,n=3*v.vertex_index_bytes+v.material_index_bytes+3*v.normal_index_bytes,o=n+3*v.uv_index_bytes,h=e+v.ntri_smooth_uv*o;for(t=e;t<h;t+=o)p(t),$(t+n)}(I),function(e){var t,n=4*v.vertex_index_bytes+v.material_index_bytes,o=n+4*v.uv_index_bytes,h=e+v.nquad_flat_uv*o;for(t=e;t<h;t+=o)u(t),g(t+n)}(t),function(e){var t,n=4*v.vertex_index_bytes+v.material_index_bytes+4*v.normal_index_bytes,o=n+4*v.uv_index_bytes,h=e+v.nquad_smooth_uv*o;for(t=e;t<h;t+=o)m(t),g(t+n)}(G),function(e){var t,n=3*v.vertex_index_bytes+v.material_index_bytes,o=e+v.ntri_flat*n;for(t=e;t<o;t+=n)f(t)}(X),function(e){var t,n=3*v.vertex_index_bytes+v.material_index_bytes+3*v.normal_index_bytes,o=e+v.ntri_smooth*n;for(t=e;t<o;t+=n)p(t)}(D),function(e){var t,n=4*v.vertex_index_bytes+v.material_index_bytes,o=e+v.nquad_flat*n;for(t=e;t<o;t+=n)u(t)}(O),function(e){var t,n=4*v.vertex_index_bytes+v.material_index_bytes+4*v.normal_index_bytes,o=e+v.nquad_smooth*n;for(t=e;t<o;t+=n)m(t)}(W),this.computeCentroids(),this.computeFaceNormals(),THREE.Loader.prototype.hasNormals(this)&&this.computeTangents()};h.prototype=new THREE.Geometry,h.prototype.constructor=h,t(new h(n))},v:function(e,t,n,o){e.vertices.push(new THREE.Vertex(new THREE.Vector3(t,n,o)))},f3:function(e,t,n,o,h){e.faces.push(new THREE.Face3(t,n,o,null,null,e.materials[h]))},f4:function(e,t,n,o,h,c){e.faces.push(new THREE.Face4(t,n,o,h,null,null,e.materials[c]))},f3n:function(e,t,n,o,h,c,_,E,f){var c=e.materials[c],p=t[3*E],u=t[3*E+1],E=t[3*E+2],m=t[3*f],$=t[3*f+1],f=t[3*f+2];e.faces.push(new THREE.Face3(n,o,h,[new THREE.Vector3(t[3*_],t[3*_+1],t[3*_+2]),new THREE.Vector3(p,u,E),new THREE.Vector3(m,$,f)],null,c))},f4n:function(e,t,n,o,h,c,_,E,f,p,u){var _=e.materials[_],m=t[3*f],$=t[3*f+1],f=t[3*f+2],g=t[3*p],v=t[3*p+1],p=t[3*p+2],T=t[3*u],y=t[3*u+1],u=t[3*u+2];e.faces.push(new THREE.Face4(n,o,h,c,[new THREE.Vector3(t[3*E],t[3*E+1],t[3*E+2]),new THREE.Vector3(m,$,f),new THREE.Vector3(g,v,p),new THREE.Vector3(T,y,u)],null,_))},uv3:function(e,t,n,o,h,c,_){var E=[];E.push(new THREE.UV(t,n)),E.push(new THREE.UV(o,h)),E.push(new THREE.UV(c,_)),e.push(E)},uv4:function(e,t,n,o,h,c,_,E,f){var p=[];p.push(new THREE.UV(t,n)),p.push(new THREE.UV(o,h)),p.push(new THREE.UV(c,_)),p.push(new THREE.UV(E,f)),e.push(p)},constructor:THREE.BinaryLoader},THREE.SceneLoader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){},this.callbackSync=function(){},this.callbackProgress=function(){}},THREE.SceneLoader.prototype={load:function(e,t){var n=this,o=new Worker(e);o.postMessage(0);var h=THREE.Loader.prototype.extractUrlbase(e);o.onmessage=function(e){function o(e,t){return"relativeToHTML"==t?e:h+"/"+e}function c(){for(m in L.objects)if(!k.objects[m]){if(void 0!==(y=L.objects[m]).geometry){if(b=k.geometries[y.geometry]){var e=!1;for(D=0,M=[];D<y.materials.length;D++)M[D]=k.materials[y.materials[D]],e=M[D]instanceof THREE.MeshShaderMaterial;e&&b.computeTangents(),R=y.position,r=y.rotation,q=y.quaternion,s=y.scale,q=0,0==M.length&&(M[0]=new THREE.MeshFaceMaterial),M.length>1&&(M=[new THREE.MeshFaceMaterial]),(object=new THREE.Mesh(b,M)).name=m,object.position.set(R[0],R[1],R[2]),q?(object.quaternion.set(q[0],q[1],q[2],q[3]),object.useQuaternion=!0):object.rotation.set(r[0],r[1],r[2]),object.scale.set(s[0],s[1],s[2]),object.visible=y.visible,k.scene.addObject(object),k.objects[m]=object,y.meshCollider&&(e=THREE.CollisionUtils.MeshColliderWBox(object),k.scene.collisions.colliders.push(e)),y.castsShadow&&(e=new THREE.ShadowVolume(b),k.scene.addChild(e),e.position=object.position,e.rotation=object.rotation,e.scale=object.scale),y.trigger&&"none"!=y.trigger.toLowerCase()&&(e={type:y.trigger,object:y},k.triggers[object.name]=e)}}else R=y.position,r=y.rotation,q=y.quaternion,s=y.scale,q=0,(object=new THREE.Object3D).name=m,object.position.set(R[0],R[1],R[2]),q?(object.quaternion.set(q[0],q[1],q[2],q[3]),object.useQuaternion=!0):object.rotation.set(r[0],r[1],r[2]),object.scale.set(s[0],s[1],s[2]),object.visible=void 0!==y.visible&&y.visible,k.scene.addObject(object),k.objects[m]=object,k.empties[m]=object,y.trigger&&"none"!=y.trigger.toLowerCase()&&(e={type:y.trigger,object:y},k.triggers[object.name]=e)}}function _(e){return function(t){k.geometries[e]=t,c(),V-=1,n.onLoadComplete(),f()}}function E(e){return function(t){k.geometries[e]=t}}function f(){n.callbackProgress({totalModels:F,totalTextures:U,loadedModels:F-V,loadedTextures:U-z},k),n.onLoadProgress(),0==V&&0==z&&t(k)}for(m in L=e.data,C=new THREE.BinaryLoader,P=new THREE.JSONLoader,z=V=0,k={scene:new THREE.Scene,geometries:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},triggers:{},empties:{}},e=!1,L.objects)if((y=L.objects[m]).meshCollider){e=!0;break}if(e&&(k.scene.collisions=new THREE.CollisionSystem),L.transform){e=L.transform.position,x=L.transform.rotation;var p,u,m,$,g,v,T,y,R,x,H,b,w,S,C,M,A,L,P,V,z,F,U,k,B=L.transform.scale;e&&k.scene.position.set(e[0],e[1],e[2]),x&&k.scene.rotation.set(x[0],x[1],x[2]),B&&k.scene.scale.set(B[0],B[1],B[2]),(e||x||B)&&k.scene.updateMatrix()}for(g in e=function(){z-=1,f(),n.onLoadComplete()},L.cameras)"perspective"==(x=L.cameras[g]).type?w=new THREE.Camera(x.fov,x.aspect,x.near,x.far):"ortho"==x.type&&((w=new THREE.Camera).projectionMatrix=THREE.Matrix4.makeOrtho(x.left,x.right,x.top,x.bottom,x.near,x.far)),R=x.position,x=x.target,w.position.set(R[0],R[1],R[2]),w.target.position.set(x[0],x[1],x[2]),k.cameras[g]=w;for($ in L.lights)w=void 0!==(g=L.lights[$]).color?g.color:16777215,x=void 0!==g.intensity?g.intensity:1,"directional"==g.type?(R=g.direction,(A=new THREE.DirectionalLight(w,x)).position.set(R[0],R[1],R[2]),A.position.normalize()):"point"==g.type?(R=g.position,d=g.distance,(A=new THREE.PointLight(w,x,d)).position.set(R[0],R[1],R[2])):"ambient"==g.type&&(A=new THREE.AmbientLight(w)),k.scene.addLight(A),k.lights[$]=A;for(v in L.fogs)"linear"==($=L.fogs[v]).type?S=new THREE.Fog(0,$.near,$.far):"exp2"==$.type&&(S=new THREE.FogExp2(0,$.density)),x=$.color,S.color.setRGB(x[0],x[1],x[2]),k.fogs[v]=S;for(p in k.cameras&&L.defaults.camera&&(k.currentCamera=k.cameras[L.defaults.camera]),k.fogs&&L.defaults.fog&&(k.scene.fog=k.fogs[L.defaults.fog]),x=L.defaults.bgcolor,k.bgColor=new THREE.Color,k.bgColor.setRGB(x[0],x[1],x[2]),k.bgColorAlpha=L.defaults.bgalpha,L.geometries)("bin_mesh"==(v=L.geometries[p]).type||"ascii_mesh"==v.type)&&(V+=1,n.onLoadStart());for(p in F=V,L.geometries)"cube"==(v=L.geometries[p]).type?(b=new THREE.CubeGeometry(v.width,v.height,v.depth,v.segmentsWidth,v.segmentsHeight,v.segmentsDepth,null,v.flipped,v.sides),k.geometries[p]=b):"plane"==v.type?(b=new THREE.PlaneGeometry(v.width,v.height,v.segmentsWidth,v.segmentsHeight),k.geometries[p]=b):"sphere"==v.type?(b=new THREE.SphereGeometry(v.radius,v.segmentsWidth,v.segmentsHeight),k.geometries[p]=b):"cylinder"==v.type?(b=new THREE.CylinderGeometry(v.numSegs,v.topRad,v.botRad,v.height,v.topOffset,v.botOffset),k.geometries[p]=b):"torus"==v.type?(b=new THREE.TorusGeometry(v.radius,v.tube,v.segmentsR,v.segmentsT),k.geometries[p]=b):"icosahedron"==v.type?(b=new THREE.IcosahedronGeometry(v.subdivisions),k.geometries[p]=b):"bin_mesh"==v.type?C.load({model:o(v.url,L.urlBaseType),callback:_(p)}):"ascii_mesh"==v.type?P.load({model:o(v.url,L.urlBaseType),callback:_(p)}):"embedded_mesh"==v.type&&(v=L.embeds[v.id])&&P.createModel(v,E(p),"");for(T in L.textures)if((p=L.textures[T]).url instanceof Array)for(z+=p.url.length,C=0;C<p.url.length;C++)n.onLoadStart();else z+=1,n.onLoadStart();for(T in U=z,L.textures){if(void 0!=(p=L.textures[T]).mapping&&void 0!=THREE[p.mapping]&&(p.mapping=new THREE[p.mapping]),p.url instanceof Array){C=[];for(var D=0;D<p.url.length;D++)C[D]=o(p.url[D],L.urlBaseType);C=THREE.ImageUtils.loadTextureCube(C,p.mapping,e)}else C=THREE.ImageUtils.loadTexture(o(p.url,L.urlBaseType),p.mapping,e),void 0!=THREE[p.minFilter]&&(C.minFilter=THREE[p.minFilter]),void 0!=THREE[p.magFilter]&&(C.magFilter=THREE[p.magFilter]),p.repeat&&(C.repeat.set(p.repeat[0],p.repeat[1]),1!=p.repeat[0]&&(C.wrapS=THREE.RepeatWrapping),1!=p.repeat[1]&&(C.wrapT=THREE.RepeatWrapping)),p.offset&&C.offset.set(p.offset[0],p.offset[1]),p.wrap&&(void 0!==(P={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping})[p.wrap[0]]&&(C.wrapS=P[p.wrap[0]]),void 0!==P[p.wrap[1]]&&(C.wrapT=P[p.wrap[1]]));k.textures[T]=C}for(u in L.materials){for(H in(T=L.materials[u]).parameters)"envMap"==H||"map"==H||"lightMap"==H?T.parameters[H]=k.textures[T.parameters[H]]:"shading"==H?T.parameters[H]="flat"==T.parameters[H]?THREE.FlatShading:THREE.SmoothShading:"blending"==H?T.parameters[H]=THREE[T.parameters[H]]?THREE[T.parameters[H]]:THREE.NormalBlending:"combine"==H?T.parameters[H]="MixOperation"==T.parameters[H]?THREE.MixOperation:THREE.MultiplyOperation:"vertexColors"==H&&("face"==T.parameters[H]?T.parameters[H]=THREE.FaceColors:T.parameters[H]&&(T.parameters[H]=THREE.VertexColors));void 0!==T.parameters.opacity&&T.parameters.opacity<1&&(T.parameters.transparent=!0),T.parameters.normalMap?(p=THREE.ShaderUtils.lib.normal,e=THREE.UniformsUtils.clone(p.uniforms),C=T.parameters.color,P=T.parameters.specular,v=T.parameters.ambient,S=T.parameters.shininess,e.tNormal.texture=k.textures[T.parameters.normalMap],T.parameters.normalMapFactor&&(e.uNormalScale.value=T.parameters.normalMapFactor),T.parameters.map&&(e.tDiffuse.texture=T.parameters.map,e.enableDiffuse.value=!0),T.parameters.lightMap&&(e.tAO.texture=T.parameters.lightMap,e.enableAO.value=!0),T.parameters.specularMap&&(e.tSpecular.texture=k.textures[T.parameters.specularMap],e.enableSpecular.value=!0),e.uDiffuseColor.value.setHex(C),e.uSpecularColor.value.setHex(P),e.uAmbientColor.value.setHex(v),e.uShininess.value=S,T.parameters.opacity&&(e.uOpacity.value=T.parameters.opacity),T=new THREE.MeshShaderMaterial({fragmentShader:p.fragmentShader,vertexShader:p.vertexShader,uniforms:e,lights:!0,fog:!0})):T=new THREE[T.type](T.parameters),k.materials[u]=T}c(),n.callbackSync(k)}},constructor:THREE.SceneLoader},THREE.UTF8Loader=function(){},THREE.UTF8Loader.prototype=new THREE.UTF8Loader,THREE.UTF8Loader.prototype.constructor=THREE.UTF8Loader,THREE.UTF8Loader.prototype={load:function(e){var t=new XMLHttpRequest,n=e.model,o=e.callback,h=void 0!==e.scale?e.scale:1,c=void 0!==e.offsetX?e.offsetX:0,_=void 0!==e.offsetY?e.offsetY:0,E=void 0!==e.offsetZ?e.offsetZ:0;t.onreadystatechange=function(){4==t.readyState?200==t.status||0==t.status?THREE.UTF8Loader.prototype.createModel(t.responseText,o,h,c,_,E):alert("Couldn't load ["+n+"] ["+t.status+"]"):3!=t.readyState&&2==t.readyState&&t.getResponseHeader("Content-Length")},t.open("GET",n,!0),t.send(null)},decompressMesh:function(e){var t=e.charCodeAt(0);t>=57344&&(t-=2048),t++;for(var n=new Float32Array(8*t),o=1,h=0;h<8;h++){for(var c=0,_=0;_<t;++_){var E=e.charCodeAt(_+o);c+=E>>1^-(1&E),n[8*_+h]=c}o+=t}for(t=e.length-o,c=new Uint16Array(t),h=_=0;h<t;h++)E=e.charCodeAt(h+o),c[h]=_-E,0==E&&_++;return[n,c]},createModel:function(e,t,n,o,h,c){var _=function(){var t=this;t.materials=[],THREE.Geometry.call(this);var _=THREE.UTF8Loader.prototype.decompressMesh(e),E=[],f=[];(function(e,_,E){for(var f,p,u,m=e.length;E<m;E+=8)f=e[E],p=e[E+1],u=e[E+2],f=f/16383*n,p=p/16383*n,u=u/16383*n,f+=o,p+=h,u+=c,THREE.UTF8Loader.prototype.v(t,f,p,u)})(_[0],8,0),function(e,t,n){for(var o,h,c=e.length;n<c;n+=8)o=e[n],h=e[n+1],o/=1023,h/=1023,f.push(o,h)}(_[0],8,3),function(e,t,n){for(var o,h,c,_=e.length;n<_;n+=8)o=e[n],h=e[n+1],c=e[n+2],o=(o-512)/511,h=(h-512)/511,c=(c-512)/511,E.push(o,h,c)}(_[0],8,5),function(e){var n,o,h,c,_,p,u,m=e.length;for(n=0;n<m;n+=3)o=e[n],h=e[n+1],c=e[n+2],THREE.UTF8Loader.prototype.f3n(t,E,o,h,c,0,o,h,c),_=f[2*o],o=f[2*o+1],p=f[2*h],h=f[2*h+1],u=f[2*c],c=f[2*c+1],THREE.UTF8Loader.prototype.uv3(t.faceVertexUvs[0],_,o,p,h,u,c)}(_[1]),this.computeCentroids(),this.computeFaceNormals()};_.prototype=new THREE.Geometry,_.prototype.constructor=_,t(new _)},v:function(e,t,n,o){e.vertices.push(new THREE.Vertex(new THREE.Vector3(t,n,o)))},f3n:function(e,t,n,o,h,c,_,E,f){var c=e.materials[c],p=t[3*E],u=t[3*E+1],E=t[3*E+2],m=t[3*f],$=t[3*f+1],f=t[3*f+2],_=new THREE.Vector3(t[3*_],t[3*_+1],t[3*_+2]),E=new THREE.Vector3(p,u,E),f=new THREE.Vector3(m,$,f);e.faces.push(new THREE.Face3(n,o,h,[_,E,f],null,c))},uv3:function(e,t,n,o,h,c,_){var E=[];E.push(new THREE.UV(t,n)),E.push(new THREE.UV(o,h)),E.push(new THREE.UV(c,_)),e.push(E)},constructor:THREE.UTF8Loader},THREE.MarchingCubes=function(e,t){THREE.Object3D.call(this),this.materials=t instanceof Array?t:[t],this.init=function(e){this.isolation=80,this.size=e,this.size2=this.size*this.size,this.size3=this.size2*this.size,this.halfsize=this.size/2,this.delta=2/this.size,this.yd=this.size,this.zd=this.size2,this.field=new Float32Array(this.size3),this.normal_cache=new Float32Array(3*this.size3),this.vlist=new Float32Array(36),this.nlist=new Float32Array(36),this.firstDraw=!0,this.maxCount=4096,this.count=0,this.hasNormal=this.hasPos=!1,this.positionArray=new Float32Array(3*this.maxCount),this.normalArray=new Float32Array(3*this.maxCount)},this.lerp=function(e,t,n){return e+(t-e)*n},this.VIntX=function(e,t,n,o,h,c,_,E,f,p){h=(h-f)/(p-f),f=this.normal_cache,t[o]=c+h*this.delta,t[o+1]=_,t[o+2]=E,n[o]=this.lerp(f[e],f[e+3],h),n[o+1]=this.lerp(f[e+1],f[e+4],h),n[o+2]=this.lerp(f[e+2],f[e+5],h)},this.VIntY=function(e,t,n,o,h,c,_,E,f,p){h=(h-f)/(p-f),f=this.normal_cache,t[o]=c,t[o+1]=_+h*this.delta,t[o+2]=E,t=e+3*this.yd,n[o]=this.lerp(f[e],f[t],h),n[o+1]=this.lerp(f[e+1],f[t+1],h),n[o+2]=this.lerp(f[e+2],f[t+2],h)},this.VIntZ=function(e,t,n,o,h,c,_,E,f,p){h=(h-f)/(p-f),f=this.normal_cache,t[o]=c,t[o+1]=_,t[o+2]=E+h*this.delta,t=e+3*this.zd,n[o]=this.lerp(f[e],f[t],h),n[o+1]=this.lerp(f[e+1],f[t+1],h),n[o+2]=this.lerp(f[e+2],f[t+2],h)},this.compNorm=function(e){var t=3*e;0==this.normal_cache[t]&&(this.normal_cache[t]=this.field[e-1]-this.field[e+1],this.normal_cache[t+1]=this.field[e-this.yd]-this.field[e+this.yd],this.normal_cache[t+2]=this.field[e-this.zd]-this.field[e+this.zd])},this.polygonize=function(e,t,n,o,h,c){var _=o+1,E=o+this.yd,f=o+this.zd,p=_+this.yd,u=_+this.zd,m=o+this.yd+this.zd,$=_+this.yd+this.zd,g=0,v=this.field[o],T=this.field[_],y=this.field[E],R=this.field[p],x=this.field[f],H=this.field[u],b=this.field[m],w=this.field[$];v<h&&(g|=1),T<h&&(g|=2),y<h&&(g|=8),R<h&&(g|=4),x<h&&(g|=16),H<h&&(g|=32),b<h&&(g|=128),w<h&&(g|=64);var S=THREE.edgeTable[g];if(0==S)return 0;var C=this.delta,M=e+C,A=t+C,C=n+C;for(1&S&&(this.compNorm(o),this.compNorm(_),this.VIntX(3*o,this.vlist,this.nlist,0,h,e,t,n,v,T)),2&S&&(this.compNorm(_),this.compNorm(p),this.VIntY(3*_,this.vlist,this.nlist,3,h,M,t,n,T,R)),4&S&&(this.compNorm(E),this.compNorm(p),this.VIntX(3*E,this.vlist,this.nlist,6,h,e,A,n,y,R)),8&S&&(this.compNorm(o),this.compNorm(E),this.VIntY(3*o,this.vlist,this.nlist,9,h,e,t,n,v,y)),16&S&&(this.compNorm(f),this.compNorm(u),this.VIntX(3*f,this.vlist,this.nlist,12,h,e,t,C,x,H)),32&S&&(this.compNorm(u),this.compNorm($),this.VIntY(3*u,this.vlist,this.nlist,15,h,M,t,C,H,w)),64&S&&(this.compNorm(m),this.compNorm($),this.VIntX(3*m,this.vlist,this.nlist,18,h,e,A,C,b,w)),128&S&&(this.compNorm(f),this.compNorm(m),this.VIntY(3*f,this.vlist,this.nlist,21,h,e,t,C,x,b)),256&S&&(this.compNorm(o),this.compNorm(f),this.VIntZ(3*o,this.vlist,this.nlist,24,h,e,t,n,v,x)),512&S&&(this.compNorm(_),this.compNorm(u),this.VIntZ(3*_,this.vlist,this.nlist,27,h,M,t,n,T,H)),1024&S&&(this.compNorm(p),this.compNorm($),this.VIntZ(3*p,this.vlist,this.nlist,30,h,M,A,n,R,w)),2048&S&&(this.compNorm(E),this.compNorm(m),this.VIntZ(3*E,this.vlist,this.nlist,33,h,e,A,n,y,b)),g<<=4,h=o=0;-1!=THREE.triTable[g+h];)t=(e=g+h)+1,n=e+2,this.posnormtriv(this.vlist,this.nlist,3*THREE.triTable[e],3*THREE.triTable[t],3*THREE.triTable[n],c),h+=3,o++;return o},this.posnormtriv=function(e,t,n,o,h,c){var _=3*this.count;this.positionArray[_]=e[n],this.positionArray[_+1]=e[n+1],this.positionArray[_+2]=e[n+2],this.positionArray[_+3]=e[o],this.positionArray[_+4]=e[o+1],this.positionArray[_+5]=e[o+2],this.positionArray[_+6]=e[h],this.positionArray[_+7]=e[h+1],this.positionArray[_+8]=e[h+2],this.normalArray[_]=t[n],this.normalArray[_+1]=t[n+1],this.normalArray[_+2]=t[n+2],this.normalArray[_+3]=t[o],this.normalArray[_+4]=t[o+1],this.normalArray[_+5]=t[o+2],this.normalArray[_+6]=t[h],this.normalArray[_+7]=t[h+1],this.normalArray[_+8]=t[h+2],this.hasNormal=this.hasPos=!0,this.count+=3,this.count>=this.maxCount-3&&c(this)},this.begin=function(){this.count=0,this.hasNormal=this.hasPos=!1},this.end=function(e){if(0!=this.count){for(var t=3*this.count;t<this.positionArray.length;t++)this.positionArray[t]=0;e(this)}},this.addBall=function(e,t,n,o,h){var c,_,E,f,p,u,m=this.size*Math.sqrt(o/h),$=n*this.size,g=t*this.size,v=e*this.size,T=Math.floor($-m);T<1&&(T=1),($=Math.floor($+m))>this.size-1&&($=this.size-1);var y=Math.floor(g-m);y<1&&(y=1),(g=Math.floor(g+m))>this.size-1&&(g=this.size-1);var R=Math.floor(v-m);for(R<1&&(R=1),(m=Math.floor(v+m))>this.size-1&&(m=this.size-1);T<$;T++)for(v=this.size2*T,p=(_=T/this.size-n)*_,_=y;_<g;_++)for(E=v+this.size*_,u=(c=_/this.size-t)*c,c=R;c<m;c++)(f=o/(1e-6+(f=c/this.size-e)*f+u+p)-h)>0&&(this.field[E+c]+=f)},this.addPlaneX=function(e,t){var n,o,h,c,_,E=this.size,f=this.yd,p=this.zd,u=this.field,m=E*Math.sqrt(e/t);for(m>E&&(m=E),n=0;n<m;n++)if(o=n/E,o*=o,(c=e/(1e-4+o)-t)>0)for(o=0;o<E;o++)for(h=0,_=n+o*f;h<E;h++)u[p*h+_]+=c},this.addPlaneY=function(e,t){var n,o,h,c,_,E,f=this.size,p=this.yd,u=this.zd,m=this.field,$=f*Math.sqrt(e/t);for($>f&&($=f),o=0;o<$;o++)if(n=o/f,n*=n,(c=e/(1e-4+n)-t)>0)for(n=0,_=o*p;n<f;n++)for(h=0,E=_+n;h<f;h++)m[u*h+E]+=c},this.addPlaneZ=function(e,t){var n,o,h,c,_,E;for(size=this.size,yd=this.yd,zd=this.zd,field=this.field,(dist=size*Math.sqrt(e/t))>size&&(dist=size),h=0;h<dist;h++)if(n=h/size,n*=n,(c=e/(1e-4+n)-t)>0)for(o=0,_=zd*h;o<size;o++)for(n=0,E=_+o*yd;n<size;n++)field[E+n]+=c},this.reset=function(){var e;for(e=0;e<this.size3;e++)this.normal_cache[3*e]=0,this.field[e]=0},this.render=function(e){this.begin();var t,n,o,h,c,_,E,f,p,u=this.size-2;for(h=1;h<u;h++)for(o=1,p=this.size2*h,E=(h-this.halfsize)/this.halfsize;o<u;o++)for(n=1,f=p+this.size*o,_=(o-this.halfsize)/this.halfsize;n<u;n++)c=(n-this.halfsize)/this.halfsize,t=f+n,this.polygonize(c,_,E,t,this.isolation,e);this.end(e)},this.generateGeometry=function(){var e=0,t=new THREE.Geometry,n=[];return this.render(function(o){var h,c,_,E,f,p,u,m;for(h=0;h<o.count;h++)f=(u=3*h)+1,m=u+2,c=o.positionArray[u],_=o.positionArray[f],E=o.positionArray[m],p=new THREE.Vector3(c,_,E),c=o.normalArray[u],_=o.normalArray[f],E=o.normalArray[m],(u=new THREE.Vector3(c,_,E)).normalize(),f=new THREE.Vertex(p),t.vertices.push(f),n.push(u);for(h=0,nfaces=o.count/3;h<nfaces;h++)f=(u=(e+h)*3)+1,m=u+2,p=n[u],c=n[f],_=n[m],u=new THREE.Face3(u,f,m,[p,c,_]),t.faces.push(u);e+=nfaces,o.count=0}),t},this.init(e)},THREE.MarchingCubes.prototype=new THREE.Object3D,THREE.MarchingCubes.prototype.constructor=THREE.MarchingCubes,THREE.edgeTable=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),THREE.triTable=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),THREE.Trident=function(e){function t(t){return new THREE.Mesh(new THREE.CylinderGeometry(30,.1,e.length/20,e.length/5),new THREE.MeshBasicMaterial({color:t}))}function n(e,t){var n=new THREE.Geometry;return n.vertices=[new THREE.Vertex,new THREE.Vertex(e)],new THREE.Line(n,new THREE.LineBasicMaterial({color:t}))}THREE.Object3D.call(this);var o,h=Math.PI/2,e=e||THREE.Trident.defaultParams;if(e!==THREE.Trident.defaultParams)for(o in THREE.Trident.defaultParams)e.hasOwnProperty(o)||(e[o]=THREE.Trident.defaultParams[o]);this.scale=new THREE.Vector3(e.scale,e.scale,e.scale),this.addChild(n(new THREE.Vector3(e.length,0,0),e.xAxisColor)),this.addChild(n(new THREE.Vector3(0,e.length,0),e.yAxisColor)),this.addChild(n(new THREE.Vector3(0,0,e.length),e.zAxisColor)),e.showArrows&&((o=t(e.xAxisColor)).rotation.y=-h,o.position.x=e.length,this.addChild(o),(o=t(e.yAxisColor)).rotation.x=h,o.position.y=e.length,this.addChild(o),(o=t(e.zAxisColor)).rotation.y=Math.PI,o.position.z=e.length,this.addChild(o))},THREE.Trident.prototype=new THREE.Object3D,THREE.Trident.prototype.constructor=THREE.Trident,THREE.Trident.defaultParams={xAxisColor:16711680,yAxisColor:65280,zAxisColor:255,showArrows:!0,length:100,scale:1},THREE.PlaneCollider=function(e,t){this.point=e,this.normal=t},THREE.SphereCollider=function(e,t){this.center=e,this.radius=t,this.radiusSq=t*t},THREE.BoxCollider=function(e,t){this.min=e,this.max=t,this.dynamic=!0,this.normal=new THREE.Vector3},THREE.MeshCollider=function(e,t){this.mesh=e,this.box=t,this.numFaces=this.mesh.geometry.faces.length,this.normal=new THREE.Vector3},THREE.CollisionSystem=function(){this.collisionNormal=new THREE.Vector3,this.colliders=[],this.hits=[]},THREE.Collisions=new THREE.CollisionSystem,THREE.CollisionSystem.prototype.merge=function(e){this.colliders=this.colliders.concat(e.colliders),this.hits=this.hits.concat(e.hits)},THREE.CollisionSystem.prototype.rayCastAll=function(e){e.direction.normalize(),this.hits.length=0;var t,n,o,h,c=0;for(t=0,n=this.colliders.length;t<n;t++)h=this.colliders[t],(o=this.rayCast(e,h))<Number.MAX_VALUE&&(h.distance=o,o>c?this.hits.push(h):this.hits.unshift(h),c=o);return this.hits},THREE.CollisionSystem.prototype.rayCastNearest=function(e){var t=this.rayCastAll(e);if(0==t.length)return null;for(var n=0;t[n]instanceof THREE.MeshCollider;){var o=this.rayMesh(e,t[n]);if(o.dist<Number.MAX_VALUE){t[n].distance=o.dist,t[n].faceIndex=o.faceIndex;break}n++}return n>t.length?null:t[n]},THREE.CollisionSystem.prototype.rayCast=function(e,t){return t instanceof THREE.PlaneCollider?this.rayPlane(e,t):t instanceof THREE.SphereCollider?this.raySphere(e,t):t instanceof THREE.BoxCollider?this.rayBox(e,t):t instanceof THREE.MeshCollider&&t.box?this.rayBox(e,t.box):void 0},THREE.CollisionSystem.prototype.rayMesh=function(e,t){for(var n,o=this.makeRayLocal(e,t.mesh),h=Number.MAX_VALUE,c=0;c<t.numFaces;c++){var _=t.mesh.geometry.faces[c],E=t.mesh.geometry.vertices[_.a].position,f=t.mesh.geometry.vertices[_.b].position,p=t.mesh.geometry.vertices[_.c].position,u=_ instanceof THREE.Face4?t.mesh.geometry.vertices[_.d].position:null;_ instanceof THREE.Face3?(_=this.rayTriangle(o,E,f,p,h,this.collisionNormal,t.mesh))<h&&(h=_,n=c,t.normal.copy(this.collisionNormal),t.normal.normalize()):_ instanceof THREE.Face4&&((_=this.rayTriangle(o,E,f,u,h,this.collisionNormal,t.mesh))<h&&(h=_,n=c,t.normal.copy(this.collisionNormal),t.normal.normalize()),(_=this.rayTriangle(o,f,p,u,h,this.collisionNormal,t.mesh))<h&&(h=_,n=c,t.normal.copy(this.collisionNormal),t.normal.normalize()))}return{dist:h,faceIndex:n}},THREE.CollisionSystem.prototype.rayTriangle=function(e,t,n,o,h,c,_){var E=THREE.CollisionSystem.__v1,f=THREE.CollisionSystem.__v2;if(c.set(0,0,0),E.sub(n,t),f.sub(o,n),c.cross(E,f),!((E=c.dot(e.direction))<0)){if(!_.doubleSided&&!_.flipSided)return Number.MAX_VALUE;c.multiplyScalar(-1),E*=-1}return(_=c.dot(t)-c.dot(e.origin))<=0&&_>=E*h&&(_/=E,(E=THREE.CollisionSystem.__v3).copy(e.direction),E.multiplyScalar(_),E.addSelf(e.origin),Math.abs(c.x)>Math.abs(c.y)?Math.abs(c.x)>Math.abs(c.z)?(e=E.y-t.y,c=n.y-t.y,h=o.y-t.y,E=E.z-t.z,n=n.z-t.z,o=o.z-t.z):(e=E.x-t.x,c=n.x-t.x,h=o.x-t.x,E=E.y-t.y,n=n.y-t.y,o=o.y-t.y):Math.abs(c.y)>Math.abs(c.z)?(e=E.x-t.x,c=n.x-t.x,h=o.x-t.x,E=E.z-t.z,n=n.z-t.z,o=o.z-t.z):(e=E.x-t.x,c=n.x-t.x,h=o.x-t.x,E=E.y-t.y,n=n.y-t.y,o=o.y-t.y),0!=(t=c*o-n*h)&&(o=(e*o-E*h)*(t=1/t))>=0&&(t*=c*E-n*e)>=0&&1-o-t>=0)?_:Number.MAX_VALUE},THREE.CollisionSystem.prototype.makeRayLocal=function(e,t){var n=THREE.CollisionSystem.__m;THREE.Matrix4.makeInvert(t.matrixWorld,n);var o=THREE.CollisionSystem.__r;return o.origin.copy(e.origin),o.direction.copy(e.direction),n.multiplyVector3(o.origin),n.rotateAxis(o.direction),o.direction.normalize(),o},THREE.CollisionSystem.prototype.rayBox=function(e,t){t.dynamic&&t.mesh&&t.mesh.matrixWorld?n=this.makeRayLocal(e,t.mesh):((n=THREE.CollisionSystem.__r).origin.copy(e.origin),n.direction.copy(e.direction));var n,o=0,h=0,c=0,_=0,E=0,f=0,p=!0;if(n.origin.x<t.min.x?(o=t.min.x-n.origin.x,o/=n.direction.x,p=!1,_=-1):n.origin.x>t.max.x&&(o=t.max.x-n.origin.x,o/=n.direction.x,p=!1,_=1),n.origin.y<t.min.y?(h=t.min.y-n.origin.y,h/=n.direction.y,p=!1,E=-1):n.origin.y>t.max.y&&(h=t.max.y-n.origin.y,h/=n.direction.y,p=!1,E=1),n.origin.z<t.min.z?(c=t.min.z-n.origin.z,c/=n.direction.z,p=!1,f=-1):n.origin.z>t.max.z&&(c=t.max.z-n.origin.z,c/=n.direction.z,p=!1,f=1),p)return -1;switch(p=0,h>o&&(p=1,o=h),c>o&&(p=2,o=c),p){case 0:if((E=n.origin.y+n.direction.y*o)<t.min.y||E>t.max.y||(n=n.origin.z+n.direction.z*o)<t.min.z||n>t.max.z)return Number.MAX_VALUE;t.normal.set(_,0,0);break;case 1:if((_=n.origin.x+n.direction.x*o)<t.min.x||_>t.max.x||(n=n.origin.z+n.direction.z*o)<t.min.z||n>t.max.z)return Number.MAX_VALUE;t.normal.set(0,E,0);break;case 2:if((_=n.origin.x+n.direction.x*o)<t.min.x||_>t.max.x||(E=n.origin.y+n.direction.y*o)<t.min.y||E>t.max.y)return Number.MAX_VALUE;t.normal.set(0,0,f)}return o},THREE.CollisionSystem.prototype.rayPlane=function(e,t){var n=e.direction.dot(t.normal),o=t.point.dot(t.normal);return n<0&&(n=(o-e.origin.dot(t.normal))/n)>0?n:Number.MAX_VALUE},THREE.CollisionSystem.prototype.raySphere=function(e,t){var n=t.center.clone().subSelf(e.origin);if(n.lengthSq<t.radiusSq)return -1;var o=n.dot(e.direction.clone());return o<=0?Number.MAX_VALUE:(n=t.radiusSq-(n.lengthSq()-o*o))>=0?Math.abs(o)-Math.sqrt(n):Number.MAX_VALUE},THREE.CollisionSystem.__v1=new THREE.Vector3,THREE.CollisionSystem.__v2=new THREE.Vector3,THREE.CollisionSystem.__v3=new THREE.Vector3,THREE.CollisionSystem.__nr=new THREE.Vector3,THREE.CollisionSystem.__m=new THREE.Matrix4,THREE.CollisionSystem.__r=new THREE.Ray,THREE.CollisionUtils={},THREE.CollisionUtils.MeshOBB=function(e){e.geometry.computeBoundingBox();var t=e.geometry.boundingBox,n=new THREE.Vector3(t.x[0],t.y[0],t.z[0]),t=new THREE.Vector3(t.x[1],t.y[1],t.z[1]),n=new THREE.BoxCollider(n,t);return n.mesh=e,n},THREE.CollisionUtils.MeshAABB=function(e){var t=THREE.CollisionUtils.MeshOBB(e);return t.min.addSelf(e.position),t.max.addSelf(e.position),t.dynamic=!1,t},THREE.CollisionUtils.MeshColliderWBox=function(e){return new THREE.MeshCollider(e,THREE.CollisionUtils.MeshOBB(e))},THREE.WebGLRenderer&&(THREE.AnaglyphWebGLRenderer=function(e){THREE.WebGLRenderer.call(this,e);var t,n,o,h=this,c=this.setSize,_=this.render,E=new THREE.Camera,f=new THREE.Camera,p=new THREE.Matrix4,u=new THREE.Matrix4;E.useTarget=f.useTarget=!1,E.matrixAutoUpdate=f.matrixAutoUpdate=!1;var e={minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat},m=new THREE.WebGLRenderTarget(512,512,e),$=new THREE.WebGLRenderTarget(512,512,e),g=new THREE.Camera(53,1,1,1e4);g.position.z=2,_material=new THREE.MeshShaderMaterial({uniforms:{mapLeft:{type:"t",value:0,texture:m},mapRight:{type:"t",value:1,texture:$}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D mapLeft;\nuniform sampler2D mapRight;\nvarying vec2 vUv;\nvoid main() {\nvec4 colorL, colorR;\nvec2 uv = vUv;\ncolorL = texture2D( mapLeft, uv );\ncolorR = texture2D( mapRight, uv );\ngl_FragColor = vec4( colorL.g * 0.7 + colorL.b * 0.3, colorR.g, colorR.b, colorL.a + colorR.a ) * 1.1;\n}"});var v=new THREE.Scene;v.addObject(new THREE.Mesh(new THREE.PlaneGeometry(2,2),_material)),this.setSize=function(e,t){c.call(h,e,t),m.width=e,m.height=t,$.width=e,$.height=t},this.render=function(e,c){if(c.update(null,!0),t!==c.aspect||n!==c.near||o!==c.fov){t=c.aspect,n=c.near,o=c.fov;var T,y=c.projectionMatrix.clone(),R=125/30*.5,x=R*n/125,H=n*Math.tan(o*Math.PI/360);p.n14=R,u.n14=-R,R=-H*t+x,T=H*t+x,y.n11=2*n/(T-R),y.n13=(T+R)/(T-R),E.projectionMatrix=y.clone(),R=-H*t-x,T=H*t-x,y.n11=2*n/(T-R),y.n13=(T+R)/(T-R),f.projectionMatrix=y.clone()}E.matrix=c.matrixWorld.clone().multiplySelf(u),E.update(null,!0),E.position.copy(c.position),E.near=n,E.far=c.far,_.call(h,e,E,m,!0),f.matrix=c.matrixWorld.clone().multiplySelf(p),f.update(null,!0),f.position.copy(c.position),f.near=n,f.far=c.far,_.call(h,e,f,$,!0),_.call(h,v,g)}}),THREE.WebGLRenderer&&(THREE.CrosseyedWebGLRenderer=function(e){THREE.WebGLRenderer.call(this,e),this.autoClear=!1;var t,n,o=this,h=this.setSize,c=this.render,_=new THREE.Camera,E=new THREE.Camera;o.separation=10,e&&void 0!==e.separation&&(o.separation=e.separation),new THREE.Camera(53,window.innerWidth/2/window.innerHeight,1,1e4).position.z=-10,this.setSize=function(e,c){h.call(o,e,c),t=e/2,n=c},this.render=function(e,h){this.clear(),_.fov=h.fov,_.aspect=.5*h.aspect,_.near=h.near,_.far=h.far,_.updateProjectionMatrix(),_.position.copy(h.position),_.target.position.copy(h.target.position),_.translateX(o.separation),E.projectionMatrix=_.projectionMatrix,E.position.copy(h.position),E.target.position.copy(h.target.position),E.translateX(-o.separation),this.setViewport(0,0,t,n),c.call(o,e,_),this.setViewport(t,0,t,n),c.call(o,e,E,!1)}});var Stats=function(){function e(e,t,n){var o,h,c;for(h=0;h<30;h++)for(o=0;o<73;o++)e[c=(o+74*h)*4]=e[c+4],e[c+1]=e[c+5],e[c+2]=e[c+6];for(h=0;h<30;h++)c=(73+74*h)*4,h<t?(e[c]=F[n].bg.r,e[c+1]=F[n].bg.g,e[c+2]=F[n].bg.b):(e[c]=F[n].fg.r,e[c+1]=F[n].fg.g,e[c+2]=F[n].fg.b)}var t,n,o,h,c,_,E,f,p,u,m,$,g,v,T=0,y=2,R=0,x=(new Date).getTime(),H=x,b=x,w=0,S=1e3,C=0,M=0,A=1e3,L=0,P=0,V=1e3,z=0,F={fps:{bg:{r:16,g:16,b:48},fg:{r:0,g:255,b:255}},ms:{bg:{r:16,g:48,b:16},fg:{r:0,g:255,b:0}},mb:{bg:{r:48,g:16,b:26},fg:{r:255,g:0,b:128}}};(t=document.createElement("div")).style.cursor="pointer",t.style.width="80px",t.style.opacity="0.9",t.style.zIndex="10001",t.addEventListener("click",function(){switch(++T==y&&(T=0),n.style.display="none",E.style.display="none",m.style.display="none",T){case 0:n.style.display="block";break;case 1:E.style.display="block";break;case 2:m.style.display="block"}},!1),(n=document.createElement("div")).style.backgroundColor="rgb("+Math.floor(F.fps.bg.r/2)+","+Math.floor(F.fps.bg.g/2)+","+Math.floor(F.fps.bg.b/2)+")",n.style.padding="2px 0px 3px 0px",t.appendChild(n),(o=document.createElement("div")).style.fontFamily="Helvetica, Arial, sans-serif",o.style.textAlign="left",o.style.fontSize="9px",o.style.color="rgb("+F.fps.fg.r+","+F.fps.fg.g+","+F.fps.fg.b+")",o.style.margin="0px 0px 1px 3px",o.innerHTML='<span style="font-weight:bold">FPS</span>',n.appendChild(o),(h=document.createElement("canvas")).width=74,h.height=30,h.style.display="block",h.style.marginLeft="3px",n.appendChild(h),(c=h.getContext("2d")).fillStyle="rgb("+F.fps.bg.r+","+F.fps.bg.g+","+F.fps.bg.b+")",c.fillRect(0,0,h.width,h.height),_=c.getImageData(0,0,h.width,h.height),(E=document.createElement("div")).style.backgroundColor="rgb("+Math.floor(F.ms.bg.r/2)+","+Math.floor(F.ms.bg.g/2)+","+Math.floor(F.ms.bg.b/2)+")",E.style.padding="2px 0px 3px 0px",E.style.display="none",t.appendChild(E),(f=document.createElement("div")).style.fontFamily="Helvetica, Arial, sans-serif",f.style.textAlign="left",f.style.fontSize="9px",f.style.color="rgb("+F.ms.fg.r+","+F.ms.fg.g+","+F.ms.fg.b+")",f.style.margin="0px 0px 1px 3px",f.innerHTML='<span style="font-weight:bold">MS</span>',E.appendChild(f),(h=document.createElement("canvas")).width=74,h.height=30,h.style.display="block",h.style.marginLeft="3px",E.appendChild(h),(p=h.getContext("2d")).fillStyle="rgb("+F.ms.bg.r+","+F.ms.bg.g+","+F.ms.bg.b+")",p.fillRect(0,0,h.width,h.height),u=p.getImageData(0,0,h.width,h.height);try{performance&&performance.memory&&performance.memory.totalJSHeapSize&&(y=3)}catch(U){}return(m=document.createElement("div")).style.backgroundColor="rgb("+Math.floor(F.mb.bg.r/2)+","+Math.floor(F.mb.bg.g/2)+","+Math.floor(F.mb.bg.b/2)+")",m.style.padding="2px 0px 3px 0px",m.style.display="none",t.appendChild(m),($=document.createElement("div")).style.fontFamily="Helvetica, Arial, sans-serif",$.style.textAlign="left",$.style.fontSize="9px",$.style.color="rgb("+F.mb.fg.r+","+F.mb.fg.g+","+F.mb.fg.b+")",$.style.margin="0px 0px 1px 3px",$.innerHTML='<span style="font-weight:bold">MB</span>',m.appendChild($),(h=document.createElement("canvas")).width=74,h.height=30,h.style.display="block",h.style.marginLeft="3px",m.appendChild(h),(g=h.getContext("2d")).fillStyle="#301010",g.fillRect(0,0,h.width,h.height),v=g.getImageData(0,0,h.width,h.height),{domElement:t,update:function(){R++,A=Math.min(A,M=(x=(new Date).getTime())-H),L=Math.max(L,M),e(u.data,Math.min(30,30-M/200*30),"ms"),f.innerHTML='<span style="font-weight:bold">'+M+" MS</span> ("+A+"-"+L+")",p.putImageData(u,0,0),H=x,x>b+1e3&&(S=Math.min(S,w=Math.round(1e3*R/(x-b))),C=Math.max(C,w),e(_.data,Math.min(30,30-w/100*30),"fps"),o.innerHTML='<span style="font-weight:bold">'+w+" FPS</span> ("+S+"-"+C+")",c.putImageData(_,0,0),3==y&&(V=Math.min(V,P=954e-9*performance.memory.usedJSHeapSize),z=Math.max(z,P),e(v.data,Math.min(30,30-P/2),"mb"),$.innerHTML='<span style="font-weight:bold">'+Math.round(P)+" MB</span> ("+Math.round(V)+"-"+Math.round(z)+")",g.putImageData(v,0,0)),b=x,R=0)}}};function initObjects(){var e=new THREE.PointLight(16699903);e.position.x=200,e.position.y=300,e.position.z=500,scene.addLight(e),geometry=new THREE.CubeGeometry(100,100,100),material=new THREE.MeshLambertMaterial({color:4687220}),meshContainer=new THREE.Object3D,scene.addObject(meshContainer),mesh=[];for(var t=0;t<1e3;t++){mesh[t]=new THREE.Mesh(geometry,material),mesh[t].rotation.x=360*Math.random()*Math.PI/180,mesh[t].rotation.y=360*Math.random()*Math.PI/180,mesh[t].rotation.z=360*Math.random()*Math.PI/180;var n=Math.ceil(3*Math.random());mesh[t].position.x=1==n?(Math.round(Math.random())?-1:1)*(400+2e3*Math.random()):(40-80*Math.random())*80,mesh[t].position.y=2==n?(Math.round(Math.random())?-1:1)*(400+2e3*Math.random()):(40-80*Math.random())*80,mesh[t].position.z=3==n?(Math.round(Math.random())?-1:1)*(400+2e3*Math.random()):(40-80*Math.random())*80,meshContainer.addChild(mesh[t])}scene.fog=new THREE.FogExp2(2635827,8e-4)}function animateObjects(){for(var e=0;e<1e3;e++)mesh[e].rotation.x+=.01,mesh[e].rotation.y+=.02;meshContainer.rotation.x-=.005}function init(){initRenderer(),initObjects(),initInfo(),initStats()}function render(){requestAnimationFrame(render),animateObjects(),renderer.render(scene,camera),stats.update()}function initRenderer(){container=document.createElement("div"),document.body.appendChild(container),camera=new THREE.Camera(75,window.innerWidth/window.innerHeight,1,1e4),scene=new THREE.Scene,(renderer=new THREE.WebGLRenderer).sortObjects=!1,renderer.setSize(window.innerWidth,window.innerHeight),container.appendChild(renderer.domElement)}function initStats(){(stats=new Stats).domElement.style.position="absolute",stats.domElement.style.top="0px",container.appendChild(stats.domElement)}function initInfo(){var e=document.createElement("div");e.style.position="absolute",e.style.top="10px",e.style.width="100%",e.style.textAlign="center",e.innerHTML='<h1>hello rain</h1>by <a href="https://github.com/Quinten" target="_blank">@Quinten</a><br />made with <a href="http://github.com/mrdoob/three.js" target="_blank">three.js</a>',container.appendChild(e)}init(),render();

//quinten.github.io 
